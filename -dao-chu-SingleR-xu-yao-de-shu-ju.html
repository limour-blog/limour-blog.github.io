<!DOCTYPE html><html lang="en" data-default-color-scheme="auto"><head><script>let sw=navigator.serviceWorker;sw.ready.then(()=>{sw.controller||location.reload()}),sw.register("/sw.js",{scope:"/"})</script><script src="/theme-inject/cdn.js"></script><script defer src="https://api.limour.top/vue/0d2f95c1-755d-436b-adf8-eee12a80ed32/script.js"></script><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="https://img.limour.top/2023/08/29/64ee07361815a.webp"><link rel="icon" href="https://img.limour.top/2023/08/29/64ee07361815a.webp"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Limour"><meta name="keywords" content=""><meta name="description" content="loom文件使用记录 随着单细胞数据量的增长，计算要求成指数增长，当数据量大于10万个细胞的时候，seurat包分析就显得非常有压力了，因为在实时内存中储存数据就变得非常困难，HDF5数据格式提供了高效的磁盘存储，而不是在内存中存储数据，这就将分析扩展到大规模数据集，甚至可以达到大于100万细胞的级别 ，Linnarson实验室开发了一种基于hdf5的数据结构，loom，可以方便地存储单细胞基因组"><title>【迁移】导出SingleR需要的数据 - Limour&#39;s Blog</title><link rel="stylesheet" href="/cdn/bootstrap/css/bootstrap.min.css"><link rel="stylesheet" href="/cdn/github-markdown-css/github-markdown.min.css"><link rel="stylesheet" href="/cdn/hint.css/hint.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/theme-inject/custom.css"><link rel="stylesheet" href="/theme-inject/iconfont.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"hexo.limour.top",root:"/",version:"1.9.8",typing:{enable:!1,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:"§"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!1,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"https://img.limour.top/inload.svg",onlypost:!1,offset_factor:.5},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},umami:{src:null,website_id:null,domains:null,start_time:"2024-01-01T00:00:00.000Z",token:null,api_server:null},woyaola:null,cnzz:null},search_path:"/local-search.xml",include_content_in_search:!0});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><link rel="canonical" href="https://hexo.limour.top/-dao-chu-SingleR-xu-yao-de-shu-ju"><meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="Limour's Blog" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="Limour's Blog" type="application/rss+xml"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Limour&#39;s Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="https://hexo.limour.top/" target="_self"><i class="iconfont icon-home-fill"></i> <span>Home</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>Archive1</span></a></li><li class="nav-item"><a class="nav-link" href="https://occdn.limour.top/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>Archive2</span></a></li><li class="nav-item"><a class="nav-link" href="https://b.limour.top/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>Archive3</span></a></li><li class="nav-item"><a class="nav-link" href="https://od.limour.top/" target="_self"><i class="iconfont icon-onedrive"></i> <span>Alist</span></a></li><li class="nav-item"><a class="nav-link" href="https://orcid.org/0000-0001-8897-1685" target="_self"><i class="iconfont icon-orcid"></i> <span>Orcid</span></a></li><li class="nav-item"><a class="nav-link" href="/links/" target="_self"><i class="iconfont icon-link-fill"></i> <span>Links</span></a></li><li class="nav-item"><a class="nav-link" href="/atom.xml" target="_self"><i class="iconfont icon-rss"></i> <span>RSS</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://img.limour.top/2023/08/29/64ee08e108638.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle">【迁移】导出SingleR需要的数据</span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Limour </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-10-04 17:20" pubdate>October 4, 2022 pm</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 732 words </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 7 mins</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">【迁移】导出SingleR需要的数据</h1><p id="updated-time" class="note note-info">Last updated on March 19, 2024 pm</p><div class="markdown-body"><h2 id="loom文件使用记录">loom文件使用记录</h2><p>随着单细胞数据量的增长，计算要求成指数增长，当数据量大于10万个细胞的时候，seurat包分析就显得非常有压力了，因为在实时内存中储存数据就变得非常困难，HDF5数据格式提供了高效的磁盘存储，而不是在内存中存储数据，这就将分析扩展到大规模数据集，甚至可以达到大于100万细胞的级别 ，Linnarson实验室开发了一种基于hdf5的数据结构，loom，可以方便地存储单细胞基因组数据集和元数据。他们发布了一个名为loompy的Python API来与loom文件交互，而<a href="https://hexo.limour.top/go/#aHR0cHM6Ly9zYXRpamFsYWIub3JnL2xvb21yL2xvb21yX3R1dG9yaWFs" rel="noopener external nofollow noreferrer">loomR</a>能基于R的与loom交互（<a href="https://hexo.limour.top/go/#aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC83MDY3ZTBlYzZlZDg=" rel="noopener external nofollow noreferrer">Merlin_cd6c</a>）</p><h3 id="安装补充包">安装补充包</h3><ul><li><p><a href="/ji-yu-NMF-fen-jie-de-jiang-wei-ju-lei">conda activate seurat</a></p></li><li><p>conda install -c conda-forge r-hdf5r -y</p></li><li><p># conda install -c bioconda r-loom=0.2.0.2 -y</p></li><li><p>wget <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL21vamF2ZWF6dXJlL2xvb21SL2FyY2hpdmUvcmVmcy9oZWFkcy9kZXZlbG9wLnppcA==" rel="noopener external nofollow noreferrer">https://github.com/mojaveazure/loomR/archive/refs/heads/develop.zip</a> -O loomR-develop.zip</p></li><li><p>devtools::install_local(‘loomR-develop.zip’)</p></li><li><p>conda install -c conda-forge binutils_impl_linux-64 -y</p></li><li><p>BiocManager::install(“hdf5r”)</p></li><li><p>conda create -n loom -c conda-forge loompy=3.0.6 -y</p></li><li><p>conda activate loom</p></li></ul><h3 id="下载数据">下载数据</h3><p><a href="https://hexo.limour.top/go/#aHR0cHM6Ly93d3cuaHVtYW5jZWxsYXRsYXMub3JnLw==" rel="noopener external nofollow noreferrer">The Human Cell Atlas</a> is an international collaborative consortium that charts the cell types in the healthy body, across time from development to adulthood, and eventually to old age. This enormous undertaking, larger even than the Human Genome Project, will transform our understanding of the 37.2 trillion cells in the human body.</p><p><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9kYXRhLmh1bWFuY2VsbGF0bGFzLm9yZy8=" rel="noopener external nofollow noreferrer">The HCA Data Portal</a> stores and provides single-cell data contributed by labs around the world. Anyone can contribute data, find data, or access community tools and applications.</p><ul><li><code>wget 'xxx' -O ProstateCellAtlas-human-prostate-gland-10xv2.loom</code></li></ul><p>类似的网站：<a href="https://hexo.limour.top/go/#aHR0cHM6Ly9jZWxseGdlbmUuY3ppc2NpZW5jZS5jb20v" rel="noopener external nofollow noreferrer">CZ CELLxGENE</a>；可以<a href="https://hexo.limour.top/go/#aHR0cHM6Ly9jZWxseGdlbmUuY3ppc2NpZW5jZS5jb20vZGF0YXNldHM=" rel="noopener external nofollow noreferrer">检索需要的数据集</a>，下载rds格式的文件</p><ul><li><code>curl -o local.rds &quot;xxx&quot;</code></li><li>mv local.rds cellxgene_Human_prostate.rds</li></ul><h3 id="使用记录">使用记录</h3><p>公共的集群是真难用，一堆包装半天装不上，磁盘IO慢的一批。。。。。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs R">conda activate seurat<br>.libPaths<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;&#x27;</span><span class="hljs-punctuation">)</span><br>sce <span class="hljs-operator">&lt;-</span> loomR<span class="hljs-operator">::</span>connect<span class="hljs-punctuation">(</span>filename <span class="hljs-operator">=</span> <span class="hljs-string">&quot;./HumanCellAtlas/ProstateCellAtlas/ProstateCellAtlas-human-prostate-gland-10xv2.loom&quot;</span><span class="hljs-punctuation">,</span> mode <span class="hljs-operator">=</span> <span class="hljs-string">&quot;r&quot;</span><span class="hljs-punctuation">,</span> skip.validate <span class="hljs-operator">=</span> <span class="hljs-built_in">T</span><span class="hljs-punctuation">)</span><br>mat <span class="hljs-operator">&lt;-</span> sce<span class="hljs-punctuation">[[</span><span class="hljs-string">&quot;matrix&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">]</span><br>gene <span class="hljs-operator">&lt;-</span> sce<span class="hljs-operator">$</span>row.attrs<span class="hljs-operator">$</span>Gene<span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><br><span class="hljs-comment"># barcode &lt;- sce$col.attrs$CellID[]</span><br>barcode <span class="hljs-operator">&lt;-</span> sce<span class="hljs-operator">$</span>col.attrs<span class="hljs-operator">$</span>cell_names<span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><br>mat <span class="hljs-operator">&lt;-</span> t<span class="hljs-punctuation">(</span>mat<span class="hljs-punctuation">)</span><br>colnames<span class="hljs-punctuation">(</span>mat<span class="hljs-punctuation">)</span><span class="hljs-operator">=</span> barcode<br>rownames<span class="hljs-punctuation">(</span>mat<span class="hljs-punctuation">)</span><span class="hljs-operator">=</span> gene<br>sce<span class="hljs-operator">$</span>close_all<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>sce <span class="hljs-operator">&lt;-</span> Seurat<span class="hljs-operator">::</span>CreateSeuratObject<span class="hljs-punctuation">(</span>counts <span class="hljs-operator">=</span> mat<span class="hljs-punctuation">,</span> project <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;prostate&#x27;</span><span class="hljs-punctuation">,</span> min.cells <span class="hljs-operator">=</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span> min.features <span class="hljs-operator">=</span> <span class="hljs-number">200</span><span class="hljs-punctuation">)</span><br>rm<span class="hljs-punctuation">(</span>mat<span class="hljs-punctuation">)</span><br>gc<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br><span class="hljs-comment">#             used   (Mb)  gc trigger     (Mb)    max used     (Mb)</span><br><span class="hljs-comment"># Ncells   3611333  192.9     6136950    327.8     6136950    327.8</span><br><span class="hljs-comment"># Vcells 287451723 2193.1 45703419996 348689.5 57126196661 435838.3</span><br>sce<br><span class="hljs-comment"># An object of class Seurat </span><br><span class="hljs-comment"># 39879 features across 128673 samples within 1 assay </span><br><span class="hljs-comment"># Active assay: RNA (39879 features, 0 variable features)</span><br></code></pre></td></tr></table></figure><h2 id="构造Pseudo-bulk的表达量矩阵加速SingleR运行">构造Pseudo-bulk的表达量矩阵加速SingleR运行</h2><p><a href="https://hexo.limour.top/go/#aHR0cHM6Ly93d3cuaHVtYW5jZWxsYXRsYXMub3JnLw==" rel="noopener external nofollow noreferrer">The Human Cell Atlas</a> 和 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9jZWxseGdlbmUuY3ppc2NpZW5jZS5jb20v" rel="noopener external nofollow noreferrer">CZ CELLxGENE</a> 的单细胞数据集有些metadata里有细胞类型注释。我们使用前面下载的数据集来构建一个SingleR的参考集。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs R">sce <span class="hljs-operator">&lt;-</span> readRDS<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;~/HumanCellAtlas/ProstateCellAtlas/cellxgene_Human_prostate.rds&#x27;</span><span class="hljs-punctuation">)</span><br>table<span class="hljs-punctuation">(</span>sce<span class="hljs-operator">$</span>tissue<span class="hljs-punctuation">)</span><br>sce <span class="hljs-operator">&lt;-</span> SeuratObject<span class="hljs-operator">::</span>UpdateSeuratObject<span class="hljs-punctuation">(</span>sce<span class="hljs-punctuation">)</span><br>saveRDS<span class="hljs-punctuation">(</span>sce<span class="hljs-operator">@</span>meta.data<span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;meta.rds&#x27;</span><span class="hljs-punctuation">)</span><br>sce<span class="hljs-operator">@</span>assays<span class="hljs-operator">$</span>RNA<span class="hljs-operator">@</span>counts<br>umi <span class="hljs-operator">&lt;-</span> sce<span class="hljs-operator">@</span>assays<span class="hljs-operator">$</span>RNA<span class="hljs-operator">@</span>counts<br>sce <span class="hljs-operator">&lt;-</span> Seurat<span class="hljs-operator">::</span>CreateSeuratObject<span class="hljs-punctuation">(</span>counts <span class="hljs-operator">=</span> umi<span class="hljs-punctuation">,</span> project <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;prostate&#x27;</span><span class="hljs-punctuation">,</span> min.cells <span class="hljs-operator">=</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span> min.features <span class="hljs-operator">=</span> <span class="hljs-number">200</span><span class="hljs-punctuation">)</span><br>sce<span class="hljs-operator">@</span>meta.data <span class="hljs-operator">&lt;-</span> readRDS<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;meta.rds&#x27;</span><span class="hljs-punctuation">)</span><br><span class="hljs-built_in">all</span><span class="hljs-punctuation">(</span>colnames<span class="hljs-punctuation">(</span>sce<span class="hljs-punctuation">)</span> <span class="hljs-operator">==</span> rownames<span class="hljs-punctuation">(</span>sce<span class="hljs-operator">@</span>meta.data<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>sce <span class="hljs-operator">&lt;-</span> subset<span class="hljs-punctuation">(</span>sce<span class="hljs-punctuation">,</span> tissue <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;prostate gland&#x27;</span><span class="hljs-punctuation">)</span><br>gc<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>table<span class="hljs-punctuation">(</span>sce<span class="hljs-operator">$</span>`Broad cell type`<span class="hljs-punctuation">)</span><br>table<span class="hljs-punctuation">(</span>sce<span class="hljs-operator">$</span>`Granular cell type`<span class="hljs-punctuation">)</span><br>table<span class="hljs-punctuation">(</span>sce<span class="hljs-operator">$</span>`Granular cell type`<span class="hljs-punctuation">)</span><br>table<span class="hljs-punctuation">(</span>sce<span class="hljs-operator">$</span>`Tissue composition`<span class="hljs-punctuation">)</span><br>table<span class="hljs-punctuation">(</span>sce<span class="hljs-operator">$</span>`Cell types level 2`<span class="hljs-punctuation">)</span><br>table<span class="hljs-punctuation">(</span>sce<span class="hljs-operator">$</span>`Cell types level 3`<span class="hljs-punctuation">)</span><br>sce<span class="hljs-operator">$</span>cell_t_1 <span class="hljs-operator">&lt;-</span> droplevels<span class="hljs-punctuation">(</span>sce<span class="hljs-operator">$</span>`Tissue composition`<span class="hljs-punctuation">)</span><br><span class="hljs-built_in">all</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">as.character</span><span class="hljs-punctuation">(</span>sce<span class="hljs-operator">$</span>cell_t_1<span class="hljs-punctuation">)</span> <span class="hljs-operator">==</span> <span class="hljs-built_in">as.character</span><span class="hljs-punctuation">(</span>sce<span class="hljs-operator">$</span>`Tissue composition`<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>sce<span class="hljs-operator">$</span>cell_t_2 <span class="hljs-operator">&lt;-</span> droplevels<span class="hljs-punctuation">(</span>sce<span class="hljs-operator">$</span>`Cell types level 2`<span class="hljs-punctuation">)</span><br>sce<span class="hljs-operator">$</span>cell_t_3 <span class="hljs-operator">&lt;-</span> droplevels<span class="hljs-punctuation">(</span>sce<span class="hljs-operator">$</span>`Cell types level 3`<span class="hljs-punctuation">)</span><br>sce <span class="hljs-operator">&lt;-</span>  Seurat<span class="hljs-operator">::</span>NormalizeData<span class="hljs-punctuation">(</span>sce<span class="hljs-punctuation">)</span><br>ref <span class="hljs-operator">&lt;-</span> <span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>ref<span class="hljs-operator">$</span>cell_t_1 <span class="hljs-operator">&lt;-</span> Seurat<span class="hljs-operator">::</span>AverageExpression<span class="hljs-punctuation">(</span>sce<span class="hljs-punctuation">,</span><br>                          group.by <span class="hljs-operator">=</span> <span class="hljs-string">&quot;cell_t_1&quot;</span><span class="hljs-punctuation">,</span><br>                          assays <span class="hljs-operator">=</span> <span class="hljs-string">&quot;RNA&quot;</span><span class="hljs-punctuation">)</span><span class="hljs-operator">$</span>RNA<br>ref<span class="hljs-operator">$</span>cell_t_2 <span class="hljs-operator">&lt;-</span> Seurat<span class="hljs-operator">::</span>AverageExpression<span class="hljs-punctuation">(</span>sce<span class="hljs-punctuation">,</span><br>                          group.by <span class="hljs-operator">=</span> <span class="hljs-string">&quot;cell_t_2&quot;</span><span class="hljs-punctuation">,</span><br>                          assays <span class="hljs-operator">=</span> <span class="hljs-string">&quot;RNA&quot;</span><span class="hljs-punctuation">)</span><span class="hljs-operator">$</span>RNA<br>ref<span class="hljs-operator">$</span>cell_t_3 <span class="hljs-operator">&lt;-</span> Seurat<span class="hljs-operator">::</span>AverageExpression<span class="hljs-punctuation">(</span>sce<span class="hljs-punctuation">,</span><br>                          group.by <span class="hljs-operator">=</span> <span class="hljs-string">&quot;cell_t_3&quot;</span><span class="hljs-punctuation">,</span><br>                          assays <span class="hljs-operator">=</span> <span class="hljs-string">&quot;RNA&quot;</span><span class="hljs-punctuation">)</span><span class="hljs-operator">$</span>RNA<br>saveRDS<span class="hljs-punctuation">(</span>ref<span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;singleR_prostate.rds&#x27;</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><h2 id="导出SingleR需要的数据">导出SingleR需要的数据</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs R">tp_samples <span class="hljs-operator">&lt;-</span> list.files<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;~/GEO/GSE193337&#x27;</span><span class="hljs-punctuation">)</span><br>tp_dir <span class="hljs-operator">&lt;-</span> file.path<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;~/GEO/GSE193337&#x27;</span><span class="hljs-punctuation">,</span> tp_samples<span class="hljs-punctuation">)</span><br><span class="hljs-built_in">names</span><span class="hljs-punctuation">(</span>tp_dir<span class="hljs-punctuation">)</span> <span class="hljs-operator">&lt;-</span> tp_samples<br>counts <span class="hljs-operator">&lt;-</span> Seurat<span class="hljs-operator">::</span>Read10X<span class="hljs-punctuation">(</span>data.dir <span class="hljs-operator">=</span> tp_dir<span class="hljs-punctuation">)</span><br>sce <span class="hljs-operator">&lt;-</span> Seurat<span class="hljs-operator">::</span>CreateSeuratObject<span class="hljs-punctuation">(</span>counts<span class="hljs-punctuation">,</span> project <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;prostate&#x27;</span><span class="hljs-punctuation">,</span><br>                            min.cells <span class="hljs-operator">=</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span> min.features <span class="hljs-operator">=</span> <span class="hljs-number">200</span><span class="hljs-punctuation">)</span><br>rm<span class="hljs-punctuation">(</span>counts<span class="hljs-punctuation">)</span><br>gc<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><br>table<span class="hljs-punctuation">(</span>sce<span class="hljs-operator">$</span>orig.ident<span class="hljs-punctuation">)</span><br>sce <span class="hljs-operator">&lt;-</span> Seurat<span class="hljs-operator">::</span>NormalizeData<span class="hljs-punctuation">(</span>sce<span class="hljs-punctuation">)</span><br>logumi <span class="hljs-operator">&lt;-</span> Seurat<span class="hljs-operator">::</span>GetAssayData<span class="hljs-punctuation">(</span>sce<span class="hljs-punctuation">,</span> slot<span class="hljs-operator">=</span><span class="hljs-string">&quot;data&quot;</span><span class="hljs-punctuation">)</span><br>saveRDS<span class="hljs-punctuation">(</span>logumi<span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;logumi.rds&#x27;</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/singler/" class="print-no-link">#SingleR</a></div></div><div class="license-box my-3"><div class="license-title"><div>【迁移】导出SingleR需要的数据</div><div>https://hexo.limour.top/-dao-chu-SingleR-xu-yao-de-shu-ju</div></div><div class="license-meta"><div class="license-meta-item"><div>Author</div><div>Limour</div></div><div class="license-meta-item license-meta-date"><div>Posted on</div><div>October 4, 2022</div></div><div class="license-meta-item license-meta-date"><div>Updated on</div><div>March 19, 2024</div></div><div class="license-meta-item"><div>Licensed under</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - Attribution"><i class="iconfont icon-cc-by"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - Non-commercial"><i class="iconfont icon-cc-nc"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - Share-alike"><i class="iconfont icon-cc-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/19-ji-lin-ba-yao-li-di-yi-ci-xiao-ce" title="【迁移】19级临八药理第一次小测"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">【迁移】19级临八药理第一次小测</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/gei-VMware-xu-ni-ji-jia-ying-pan" title="【迁移】给VMware虚拟机加硬盘"><span class="hidden-mobile">【迁移】给VMware虚拟机加硬盘</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="waline"></div><script type="text/javascript">Fluid.utils.loadComments("#waline",function(){Fluid.utils.createCssLink("https://cdn.staticfile.org/waline/2.15.5/waline.css"),Fluid.utils.createScript("https://cdn.staticfile.org/waline/2.15.5/waline.js",function(){var i=Object.assign({serverURL:"https://comments.limour.top",path:"window.location.pathname",meta:["nick","mail","link"],requiredMeta:["nick"],lang:"zh-CN",emoji:["https://jscdn.limour.top/gh/walinejs/emojis/weibo"],dark:'html[data-user-color-scheme="dark"]',wordLimit:0,pageSize:10},{el:"#waline",path:window.location.pathname});Waline.init(i),Fluid.utils.waitElementVisible("#waline .vcontent",()=>{var i="#waline .vcontent img:not(.vemoji)";Fluid.plugins.imageCaption(i),Fluid.plugins.fancyBox(i)})})})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>Table of Contents</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">Keyword</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a target="_blank" rel="nofollow noopener" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=43130202000203"><img src="https://img.limour.top/2023/08/27/64eadeb81d6a0.webp" srcset="https://img.limour.top/inload.svg" lazyload>湘公网安备43130202000203号 </a><a target="_blank" rel="nofollow noopener" href="https://beian.miit.gov.cn/">湘ICP备20008299号 </a><a target="_blank" rel="nofollow noopener" href="https://icp.gov.moe/?keyword=20210128">萌ICP备20210128号</a><br><a href="https://www.foreverblog.cn/" target="_blank"><img src="https://img.foreverblog.cn/logo_en_default.png" srcset="https://img.limour.top/inload.svg" lazyload alt="" style="width:auto;height:24px"></a><br><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/limour-blog/limour-blog.github.io" target="_blank" rel="nofollow noopener"><span>SRC</span></a> <i class="iconfont icon-love"></i> <a href="https://web.archive.org/web/20231130095837/https://effectiveacceleration.tech/" target="_blank" rel="nofollow noopener"><span>e/Acc</span></a></div></div></footer><script src="/cdn/nprogress/nprogress.min.js"></script><link rel="stylesheet" href="/cdn/nprogress/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="/cdn/jquery/jquery.min.js"></script><script src="/cdn/bootstrap/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("/cdn/tocbot/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){var t;"tocbot"in window&&(tocbot.refresh(),0!==(t=jQuery("#toc")).length)&&tocbot&&0<t.find(".toc-list-item").length&&t.css("visibility","visible")}))})</script><script src="/cdn/clipboard-js/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("/cdn/anchor-js/anchor.min.js",function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback(function(){if("anchors"in window){anchors.removeAll();var n,o=[];for(n of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))o.push(".markdown-body > "+n.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}})})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">Blog works best with JavaScript enabled</div></noscript><script defer src="/theme-inject/timeliness.js"></script></body></html>