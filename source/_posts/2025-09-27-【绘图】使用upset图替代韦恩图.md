---
title: 【绘图】使用Upset图替代韦恩图
urlname: replace-venn-diagram-with-upset-diagram
index_img: https://api.limour.top/randomImg?d=2025-09-27 08:40:36
date: 2025-09-27 16:40:36
tags: [Upset, 绘图]
---
## 配置环境
+ [基础编程环境](/-ji-lu--an-zhuang-sheng-xin-de-dai-ma-bian-xie-huan-jing)
```bash
conda create -n complexupset conda-forge::r-tidyverse conda-forge::r-irkernel conda-forge::r-complexupset -y
conda run -n complexupset Rscript -e "IRkernel::installspec(name='complexupset', displayname='r-complexupset')"
```
```R
install.packages('ggplot2movies') # 测试用的数据，可以不安装
```
## 使用示例
```R
require(ComplexUpset)
require(tidyverse)
require(RColorBrewer)
options(repr.plot.width=6, repr.plot.height=12)
RColorBrewer::display.brewer.all(type = "all")
```
```R
require(ggplot2movies)
movies = as.data.frame(ggplot2movies::movies)
genres <- colnames(movies)[18:24]
movies[genres] = (movies[genres] == 1)
# 仅用子集进行演示
movies[movies$mpaa == '', 'mpaa'] = NA
movies = na.omit(movies)#删除缺失值
t(head(movies[genres], 3))#倒置前三行进行查看

data <- movies[genres]
data  %>% head 
# 多维二分类变量数据，值为布尔类型，colnames为变量名
#   Action Animation Comedy Drama Documentary Romance Short
# 1  FALSE     FALSE   TRUE FALSE       FALSE    TRUE FALSE
# 2  FALSE     FALSE   TRUE FALSE       FALSE    TRUE FALSE
# 3  FALSE     FALSE   TRUE FALSE       FALSE   FALSE FALSE
# 4  FALSE     FALSE   TRUE  TRUE       FALSE    TRUE FALSE
# 5   TRUE     FALSE  FALSE FALSE       FALSE   FALSE FALSE
# 6  FALSE     FALSE  FALSE  TRUE       FALSE   FALSE FALSE
```
```R
options(repr.plot.width=6, repr.plot.height=6)
upset(
    data, 
    c("Action", "Comedy", "Drama", 'Romance'),
    name='genre',
    width_ratio=0.1, 
    height_ratio=0.382,
    min_size=10,
    set_sizes=FALSE,
    base_annotations=list(
        "Intersection size" = intersection_size(
            text=list(
                hjust = -0.1,
                angle = 45
            ),
            mapping = aes(fill = "bars_color")
        ) + scale_fill_manual(
            values = c("bars_color" = RColorBrewer::brewer.pal(3, 'Set1')[1]),
            guide = "none"
        ) + annotate(
                geom = 'text', 
                x=Inf, y=Inf,
                label = paste('Total:', nrow(data)),
                vjust=1, hjust=1
        ) + theme(panel.grid=element_blank())
    ),
    sort_intersections_by = c("cardinality", "degree"),
    stripes=RColorBrewer::brewer.pal(9, 'Set1')
)
```
![](https://img.limour.top/2025/09/27/68d7bb2be475e.webp)