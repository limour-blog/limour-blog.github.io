---
title: 【记录】独角数卡+BEpusdt搭建小店
urlname: dujiaoka-bepusdt
index_img: https://api.limour.top/randomImg?d=2026-02-03 14:40:44
date: 2026-02-03 22:40:44
tags: ['docker', 'ngpm']
---

## 搭建独角数卡
+ [反向代理](/Docker-bu-shu-Nginx-Proxy-Manager)
```bash
mkdir -p ~/app/shop && cd ~/app/shop 
```
+ 更改下面的 `MYSQL_PASSWORD` 后执行
```bash
cat > docker-compose.yml <<EOF
version: "3"
 
services:
  shop:
    image: ghcr.io/apocalypsor/dujiaoka:latest
    environment:
      - TZ=Asia/Shanghai
      # - INSTALL=false
      - INSTALL=true
      # - MODIFY=true
      - ADMIN_HTTPS=true
    volumes:
      - ./env.conf:/dujiaoka/.env
      - ./uploads:/dujiaoka/public/uploads
      - ./storage:/dujiaoka/storage
    restart: always
 
  shop-db:
    image: mariadb:focal
    restart: always
    environment:
      - MYSQL_ROOT_PASSWORD=changeyourpassword
      - MYSQL_DATABASE=dujiaoka
      - MYSQL_USER=dujiaoka
      - MYSQL_PASSWORD=changeyourpassword
    volumes:
      - ./mysql:/var/lib/mysql
 
  shop-redis:
    image: redis:alpine
    restart: always
    volumes:
      - ./redis:/data
 
networks:
  default:
    external: true
    name: ngpm
EOF
```
+ 更改下面的 `DB_PASSWORD` 为上面设置数据库的密码
```bash
cat > env.conf <<EOF
APP_NAME=璃墨的小卖部
APP_ENV=local
APP_KEY=base64:rKwRuI6eRpCw/9e2XZKKGj/Yx3iZy5e7+FQ6+aQl8Zg=
APP_DEBUG=true
APP_URL=https://shop.limour.eu.org

LOG_CHANNEL=stack

# 数据库配置
DB_CONNECTION=mysql
DB_HOST=shop-db
DB_PORT=3306
DB_DATABASE=dujiaoka
DB_USERNAME=dujiaoka
DB_PASSWORD=changeyourpassword

# redis配置
REDIS_HOST=shop-redis
REDIS_PASSWORD=
REDIS_PORT=6379

BROADCAST_DRIVER=log
SESSION_DRIVER=file
SESSION_LIFETIME=120

# 缓存配置
# file为磁盘文件  redis为内存级别
# redis为内存需要安装好redis服务端并配置
CACHE_DRIVER=redis

# 异步消息队列
# sync为同步  redis为异步
# 使用redis异步需要安装好redis服务端并配置
QUEUE_CONNECTION=redis

# 后台语言
## zh_CN 简体中文
## zh_TW 繁体中文
## en    英文
DUJIAO_ADMIN_LANGUAGE=zh_CN

# 后台登录地址
ADMIN_ROUTE_PREFIX=/admin

# 是否开启https (前端开启了后端也必须为true)
# 后台登录出现0err或者其他登录异常问题，大概率是开启了https而后台没有开启，把下面的false改为true即可
ADMIN_HTTPS=true
EOF
```
+ 启动容器
```bash
mkdir storage uploads && chmod -R 777 ./* && sudo docker-compose up -d
```
+ 端口映射

![](https://img.limour.top/2023/10/05/651d95446340c.webp)

+ 访问首页完成安装
+ 数据库地址填 `shop-db`，用户名密码为上面设置数据库的账户密码
+ Redis地址 填 `shop-redis`
+ 账号：`admin`
+ 密码：`admin`
+ 登陆完成后更改密码

+ 更改容器状态
```bash
cat > docker-compose.yml <<EOF
version: "3"
 
services:
  shop:
    image: ghcr.io/apocalypsor/dujiaoka:latest
    environment:
      - TZ=Asia/Shanghai
      - INSTALL=false
      - ADMIN_HTTPS=true
    volumes:
      - ./env.conf:/dujiaoka/.env
      - ./uploads:/dujiaoka/public/uploads
      - ./storage:/dujiaoka/storage
    restart: always
 
  shop-db:
    image: mariadb:focal
    restart: always
    environment:
      - MYSQL_ROOT_PASSWORD=changeyourpassword
      - MYSQL_DATABASE=dujiaoka
      - MYSQL_USER=dujiaoka
      - MYSQL_PASSWORD=changeyourpassword
    volumes:
      - ./mysql:/var/lib/mysql
 
  shop-redis:
    image: redis:alpine
    restart: always
    volumes:
      - ./redis:/data
 
networks:
  default:
    external: true
    name: ngpm
EOF
```
+ 更新状态
```bash
sudo docker-compose up -d
```

## 搭建BEpusdt

```bash
date # 确保服务器时间准确
mkdir -p ~/app/bepusd && cd ~/app/bepusd 
```
 
```bash
cat > docker-compose.yml <<EOF
version: "3"
 
services:
  bepusdt:
    image: v03413/bepusdt:latest
    environment:
      - TZ=Asia/Shanghai
    volumes:
      - ./storage:/var/lib/bepusdt
    restart: always
 
networks:
  default:
    external: true
    name: ngpm
EOF
```

```bash
sudo docker-compose up -d
```

+ 端口映射

![](https://img.limour.top/2026/02/03/698212b4703eb.webp)

+ 访问完成初次安装，记录下所有信息

+ 钱包新建几个子账户，记录地址填入

![](https://img.limour.top/2026/02/03/698214bab179e.webp)

## 两者对接
+ 检测[文档](https://github.com/v03413/BEpusdt/blob/main/docs/dujiaoka/dujiaoka.md)有无更新
+ 下载补丁，并检测要修补的文件路径
```bash
cd ~/app/shop 
wget -O EpusdtController.php https://raw.githubusercontent.com/v03413/dujiaoka/refs/heads/master/app/Http/Controllers/Pay/EpusdtController.php

docker-compose exec -it shop ls /dujiaoka/app/Http/Controllers/Pay/
```
+ 更改容器状态，应用补丁
```bash
cat > docker-compose.yml <<EOF
version: "3"
 
services:
  shop:
    image: ghcr.io/apocalypsor/dujiaoka:latest
    environment:
      - TZ=Asia/Shanghai
      - INSTALL=false
      - ADMIN_HTTPS=true
    volumes:
      - ./env.conf:/dujiaoka/.env
      - ./uploads:/dujiaoka/public/uploads
      - ./storage:/dujiaoka/storage
      - ./EpusdtController.php:/dujiaoka/app/Http/Controllers/Pay/EpusdtController.php
    restart: always
 
  shop-db:
    image: mariadb:focal
    restart: always
    environment:
      - MYSQL_ROOT_PASSWORD=changeyourpassword
      - MYSQL_DATABASE=dujiaoka
      - MYSQL_USER=dujiaoka
      - MYSQL_PASSWORD=changeyourpassword
    volumes:
      - ./mysql:/var/lib/mysql
 
  shop-redis:
    image: redis:alpine
    restart: always
    volumes:
      - ./redis:/data
 
networks:
  default:
    external: true
    name: ngpm
EOF
```
+ 更新状态
```bash
sudo docker-compose up -d
```
+ 按[文档](https://github.com/v03413/BEpusdt/blob/main/docs/dujiaoka/dujiaoka.md)完成剩下的配置

![](https://img.limour.top/2026/02/04/698220a19a575.webp)

+ 注意将回调添加到防火墙白名单中，以免订单失败