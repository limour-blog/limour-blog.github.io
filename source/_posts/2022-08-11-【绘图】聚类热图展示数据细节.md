---
title: 【绘图】聚类热图展示数据细节
urlname: cluster-heatmap-displays-data-details
index_img: https://api.limour.top/randomImg?d=2025-09-27 07:41:24
date: 2022-08-11 15:41:24
tags: [heatmap, 绘图]
---
## 配置环境
+ [基础编程环境](/-ji-lu--an-zhuang-sheng-xin-de-dai-ma-bian-xie-huan-jing)
```bash
mamba create -n complexheatmap bioconda::bioconductor-complexheatmap -y
conda install -n complexheatmap conda-forge::r-tidyverse conda-forge::r-irkernel conda-forge::r-circlize -y
conda run -n complexheatmap Rscript -e "IRkernel::installspec(name='complexheatmap', displayname='r-complexheatmap')"
```
## 使用示例
```R
require(circlize)
require(ComplexHeatmap)
require(tidyverse)
require(RColorBrewer)
options(repr.plot.width=6, repr.plot.height=12)
RColorBrewer::display.brewer.all(type = "all")
```
```R
data <- iris
data  %>% head
```
```R
# 定义连续变量的颜色映射
col_Petal.Width <- colorRamp2(
    c(0.2, 1.2, 2), 
    c(
        RColorBrewer::brewer.pal(9, 'YlGnBu')[5], 
        RColorBrewer::brewer.pal(9, 'YlOrRd')[1], 
        RColorBrewer::brewer.pal(9, 'YlOrRd')[7]
    )
)
# 定义其余变量的颜色映射
col_ANO = list(
    Species = c(
        "setosa" = RColorBrewer::brewer.pal(9, 'Set1')[1],
        "versicolor" = RColorBrewer::brewer.pal(9, 'Set1')[2],
        "virginica" = RColorBrewer::brewer.pal(9, 'Set1')[3]
    ),
    Petal.Width = col_Petal.Width
)
#定义注释信息
ha <- HeatmapAnnotation(
    Petal.Width = data$Petal.Width,
    Species = data$Species,
    col = col_ANO,
    show_annotation_name = TRUE
)
```
```R
mat <- as.matrix(data[1:4])
rownames(mat) <- NULL
mat_zs <- apply(t(mat), 1, scale)
colnames(mat_zs) <- colnames(mat)
mat <- t(mat_zs)

col_fun <- colorRamp2(
  c(seq(from = -2, to = 2, length.out = 11)), 
  RColorBrewer::brewer.pal(11, 'BrBG')
)

options(repr.plot.width=12, repr.plot.height=2)
Heatmap(mat, name = 'Z-Score', 
        top_annotation = ha, column_order = order(data$Petal.Width),
        col=col_fun)
```
![](https://img.limour.top/2025/09/27/68d7a0c7c4402.webp)