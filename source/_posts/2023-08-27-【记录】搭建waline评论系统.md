---
title: 【记录】搭建Waline评论系统
urlname: build-waline-comment-system
index_img: https://api.limour.top/randomImg?d=2026-01-17 11:34:38
date: 2023-08-27 19:34:38
tags: alist
---
## 部署
1. [在 Vercel 上部署 Waline](https://waline.js.org/guide/get-started)
2. AList 管理-设置-全局-自定义头部 中引入 Waline 样式
```html
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css" />
```
![](https://img.limour.top/2023/08/30/64ef3b54db28b.webp)

3. AList 管理-元信息 中引入 Waline 客户端
```html
#  <center> - 评论 Comments -
<div id="waline"></div>
<script type="module">
    import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
    init({
      el: '#waline',
      serverURL: 'https://comments.limour.top',
      pageSize: 3,
    });
</script>
```
![](https://img.limour.top/2023/08/30/64ef3b65d06fb.webp)
### Waline 邮件异步推送
[Waline 邮件异步推送 by 星辰日记](https://blog.xsot.cn/archives/waline-async-mail.html)
+ [搭建反代服务](/Docker-bu-shu-Nginx-Proxy-Manager)
```bash
mkdir -p ~/app/mailpush && cd ~/app/mailpush && nano docker-compose.yml
git clone --depth=1 https://github.com/soxft/waline-async-mail.git
cd waline-async-mail
nano config.example.yaml # 修改成自己的邮件服务
nano templates/guest.html && nano templates/owner.html # 修改成自己的邮件模板
docker build -t xsot/waline-async-mail . && docker image prune
cd ~/app/mailpush
sudo docker-compose up -d
```
```yml
version: "3"
services:
  waline-async-mail:
    image: xsot/waline-async-mail:latest
    volumes:
      - ./waline-async-mail/config.example.yaml:/app/config.yaml
    restart: always
 
networks:
  default:
    external: true
    name: ngpm
```
![注意 "waline-async-mail/" 后面有 "/"](https://img.limour.top/2023/09/23/650effa275900.webp)
+ 在环境变量中添加 `WEBHOOK`, 值为 `https://api.limour.top/mail/limour`
+ 在 Deployments 里，重新部署
+ [WEBHOOK说明](https://waline.js.org/reference/server/env.html#%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE)

### 附加 Waline 换 MongoDB
1. [MongoDB 官网](https://mongodb.com) 新建免费的 M0 数据库，地区选新加坡，放行 `0.0.0.0/0`
2. [Vercel](https://vercel.com) 上的 Waline 项目，Settings/Functions 里更改 Region 到新加坡
3. MongoDB 连接里记录下连接信息，选项如下
4. 选择 Drivers 作为连接方式，Driver 为 Node.js，Version为 `2.2.12 or later`
5. 进入 Waline 管理后台，导出数据
6. Vercel 里删除 LEAN 相关的环境变量，按 [说明](https://waline.js.org/guide/database.html#mongodb) 添加 MongoDB 的连接信息
7. Vercel/Deployments 里选择合适的分支，点旁边的三个点，选择 Redeploy
8. 进入 Waline 管理后台，重新注册后，导入数据