<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Limour&#39;s Blog</title>
    <link>https://hexo.limour.top/</link>
    
    <atom:link href="https://hexo.limour.top/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description></description>
    <pubDate>Sat, 17 Jan 2026 06:36:21 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>【宏观】投行对标普500走势的预测与回测</title>
      <link>https://hexo.limour.top/prediction-and-backtesting-of-sp-500-trend</link>
      <guid>https://hexo.limour.top/prediction-and-backtesting-of-sp-500-trend</guid>
      <pubDate>Sat, 17 Jan 2026 05:58:37 GMT</pubDate>
      
      <description>回顾过去十余年华尔街“最聪明大脑”的集体预言：各大投行年初对标普500的点位展望，最终都走向了怎样的结局？有人年年谨慎，却一次次被牛市冲昏剧本；有人极度乐观，却频频撞上意外黑天鹅；也有人在混乱中意外“蒙对”，却难以复制辉煌。</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="2026">2026</h2><ul><li>点位: 6878 -&gt; ?</li><li>PE:  29.1 -&gt; ?</li></ul><table><thead><tr><th>投行</th><th style="text-align:right">预测点位</th></tr></thead><tbody><tr><td>Oppenheimer</td><td style="text-align:right">8,100</td></tr><tr><td>Deutsche Bank</td><td style="text-align:right">8,000</td></tr><tr><td>Morgan Stanley</td><td style="text-align:right">7,800</td></tr><tr><td>Wells Fargo</td><td style="text-align:right">7,800</td></tr><tr><td>Citi</td><td style="text-align:right">7,700</td></tr><tr><td>Goldman Sachs</td><td style="text-align:right">7,600</td></tr><tr><td>KKR</td><td style="text-align:right">7,600</td></tr><tr><td>JPMorgan</td><td style="text-align:right">7,500</td></tr><tr><td>HSBC</td><td style="text-align:right">7,500</td></tr><tr><td>UBS</td><td style="text-align:right">7,500</td></tr><tr><td>Barclays</td><td style="text-align:right">7,400</td></tr><tr><td>Societe Generale</td><td style="text-align:right">7,300</td></tr><tr><td>Bank of America</td><td style="text-align:right">7,100</td></tr></tbody></table><h2 id="2025">2025</h2><ul><li>点位: 5903 -&gt; 6845</li><li>PE:  28.9 -&gt; 29.1</li></ul><table><thead><tr><th>投行</th><th style="text-align:right">预测点位</th></tr></thead><tbody><tr><td>Oppenheimer</td><td style="text-align:right">7,100</td></tr><tr><td>Wells Fargo</td><td style="text-align:right">7,007</td></tr><tr><td>Deutsche Bank</td><td style="text-align:right">7,000</td></tr><tr><td>Yardeni Research</td><td style="text-align:right">7,000</td></tr><tr><td>DataTrek Research</td><td style="text-align:right">6,840</td></tr><tr><td>Societe Generale</td><td style="text-align:right">6,750</td></tr><tr><td>BMO</td><td style="text-align:right">6,700</td></tr><tr><td>Bank of America</td><td style="text-align:right">6,666</td></tr><tr><td>Fundstrat</td><td style="text-align:right">6,600</td></tr><tr><td>Barclays</td><td style="text-align:right">6,600</td></tr><tr><td>RBC</td><td style="text-align:right">6,600</td></tr><tr><td>Ned Davis Research</td><td style="text-align:right">6,600</td></tr><tr><td>CFRA</td><td style="text-align:right">6,585</td></tr><tr><td>Morgan Stanley</td><td style="text-align:right">6,500</td></tr><tr><td>Goldman Sachs</td><td style="text-align:right">6,500</td></tr><tr><td>JPMorgan</td><td style="text-align:right">6,500</td></tr><tr><td>Citi</td><td style="text-align:right">6,500</td></tr><tr><td>UBS</td><td style="text-align:right">6,400</td></tr><tr><td>Stifel*</td><td style="text-align:right">5,500</td></tr><tr><td>BCA Research</td><td style="text-align:right">4,450</td></tr></tbody></table><h2 id="2024">2024</h2><ul><li>点位: 4745 -&gt; 5881</li><li>PE:  24.8 -&gt; 28.9</li></ul><table><thead><tr><th>投行</th><th style="text-align:right">预测点位</th></tr></thead><tbody><tr><td>Yardeni Research</td><td style="text-align:right">5,400</td></tr><tr><td>Fundstrat</td><td style="text-align:right">5,200</td></tr><tr><td>Oppenheimer</td><td style="text-align:right">5,200</td></tr><tr><td>Goldman Sachs</td><td style="text-align:right">5,100</td></tr><tr><td>Deutsche Bank</td><td style="text-align:right">5,100</td></tr><tr><td>BMO</td><td style="text-align:right">5,100</td></tr><tr><td>Bank of America</td><td style="text-align:right">5,000</td></tr><tr><td>RBC</td><td style="text-align:right">5,000</td></tr><tr><td>Federated Hermes</td><td style="text-align:right">5,000</td></tr><tr><td>NDR</td><td style="text-align:right">4,900</td></tr><tr><td>Stifel</td><td style="text-align:right">4,650</td></tr><tr><td>Morgan Stanley</td><td style="text-align:right">4,500</td></tr><tr><td>JPMorgan</td><td style="text-align:right">4,200</td></tr><tr><td>BCA Research</td><td style="text-align:right">3,300</td></tr></tbody></table><h2 id="2023">2023</h2><ul><li>点位: 3853 -&gt; 4769</li><li>PE:  20.1 -&gt; 24.8</li></ul><table><thead><tr><th>投行</th><th style="text-align:right">预测点位</th></tr></thead><tbody><tr><td>CFRA Research</td><td style="text-align:right">4,575</td></tr><tr><td>Deutsche Bank</td><td style="text-align:right">4,500</td></tr><tr><td>Wells Fargo</td><td style="text-align:right">4,300–4,500</td></tr><tr><td>Oppenheimer</td><td style="text-align:right">4,400</td></tr><tr><td>BMO</td><td style="text-align:right">4,300</td></tr><tr><td>Nuveen</td><td style="text-align:right">4,300</td></tr><tr><td>JPMorgan</td><td style="text-align:right">4,200</td></tr><tr><td>Jefferies</td><td style="text-align:right">4,200</td></tr><tr><td>RBC</td><td style="text-align:right">4,100</td></tr><tr><td>Credit Suisse</td><td style="text-align:right">4,050</td></tr><tr><td>BofA</td><td style="text-align:right">4,000</td></tr><tr><td>Goldman Sachs</td><td style="text-align:right">4,000</td></tr><tr><td>HSBC</td><td style="text-align:right">4,000</td></tr><tr><td>BlackRock</td><td style="text-align:right">3,930</td></tr><tr><td>Morgan Stanley</td><td style="text-align:right">3,900</td></tr><tr><td>UBS</td><td style="text-align:right">3,900</td></tr><tr><td>Citi</td><td style="text-align:right">3,900</td></tr><tr><td>Societe Generale</td><td style="text-align:right">3,800</td></tr><tr><td>Capital Economics</td><td style="text-align:right">3,800</td></tr><tr><td>Barclays</td><td style="text-align:right">3,675</td></tr></tbody></table><h2 id="2022">2022</h2><ul><li>点位: 4778 -&gt; 3839</li><li>PE:  26.4 -&gt; 20.1</li></ul><table><thead><tr><th>投行</th><th style="text-align:right">预测点位</th></tr></thead><tbody><tr><td>BMO Capital Markets</td><td style="text-align:right">5,300</td></tr><tr><td>Wells Fargo</td><td style="text-align:right">5,100-5,300</td></tr><tr><td>Goldman Sachs</td><td style="text-align:right">5,100</td></tr><tr><td>JPMorgan</td><td style="text-align:right">5,050</td></tr><tr><td>RBC Capital Markets</td><td style="text-align:right">5,050</td></tr><tr><td>UBS</td><td style="text-align:right">4,850</td></tr><tr><td>Bank of America</td><td style="text-align:right">4,600</td></tr><tr><td>Morgan Stanley</td><td style="text-align:right">4,400</td></tr></tbody></table>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/%E5%AE%8F%E8%A7%82/">宏观</category>
      
      
      <comments>https://hexo.limour.top/prediction-and-backtesting-of-sp-500-trend#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【故事】最后一道防线</title>
      <link>https://hexo.limour.top/the-last-line-of-defense</link>
      <guid>https://hexo.limour.top/the-last-line-of-defense</guid>
      <pubDate>Sat, 20 Dec 2025 16:28:20 GMT</pubDate>
      
        
        
      <description>&lt;figure class=&quot;highlight txt&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;t</description>
        
      
      
      
      <content:encoded><![CDATA[<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">灵感来源：《上海 46 岁独身女子昏迷后去世，其个人存款无法正常支付医疗费，保险无法理赔》<br>实现方式：https://app.safe.global/welcome<br></code></pre></td></tr></table></figure><h2 id="一、三十把钥匙">一、三十把钥匙</h2><p>2045年的灰城，钢铁与霓虹交织，人与人之间的距离却比任何时代都要远。</p><p>阿湛站在天台边缘，看着脚下流动的车灯。他右手无意识地摩挲着颈后的芯片接口，那是他与这个高度数字化世界的连接点。作为一名区块链安全审计师，他比大多数人更清楚这个世界的运行规则。</p><p>&quot;想好了吗？&quot;身后传来老邵的声音。</p><p>阿湛转过身，看着这位比他大十几岁的男人。老邵是&quot;最后一道防线&quot;的发起人，一个由三十人组成的互助小圈子。</p><p>&quot;想好了，&quot;阿湛点点头，“我审计过合约代码，没有漏洞。”</p><p>老邵笑了笑：“我不是问技术问题。我是问，你确定要加入吗？”</p><p>阿湛深吸一口气：&quot;在这座城市，我没有亲人。如果哪天我出了事，躺在医院里，或者…&quot;他顿了顿，“或者直接进了太平间，我不想成为又一个无人认领的’数据条目’。”</p><p>老邵递给他一个小小的硬件钱包：“这是你的钥匙，三十把中的第十七把。记住，我们的保险柜至少需要二十把钥匙才能打开。”</p><p>阿湛接过那枚冰凉的金属设备，看着上面闪烁的蓝光。这不是普通的钱包，而是一个多签授权设备，连接着一个部署在公链上的智能合约——一个由三十个人共同控制的数字保险柜。</p><p>&quot;多签是什么意思？&quot;阿湛问，虽然他作为技术人员已经知道答案，但他想听老邵用普通人的语言解释。</p><p>&quot;想象一个超级保险柜，&quot;老邵指着远处城市中央那座发光的数据中心，“里面放着我们每个人每月存入的一部分钱。但这个保险柜有三十把锁，分给我们三十个人。任何时候，只有当至少二十个人同意，插入他们的钥匙，保险柜才会打开，里面的钱才能被使用。”</p><p>&quot;而且，&quot;阿湛补充道，“每一次开锁，每一笔支出，都会被永久记录在区块链上，谁也无法篡改。”</p><p>老邵点点头：&quot;没错，这就是为什么我们叫它’最后一道防线’。当我们中的任何一个人陷入昏迷，需要紧急医疗费用，或者…&quot;他的声音低沉下来，“或者当我们中的某个人离开这个世界，需要有人为他收尸处理后事，这笔钱就会按照我们共同制定的规则，自动执行。”</p><p>阿湛握紧了手中的设备：“我加入。每月固定转入2000信用点，用于我们共同的安全网。”</p><p>&quot;欢迎加入，17号。&quot;老邵伸出手，与阿湛相握，“希望你永远不需要动用这笔钱。”</p><p>阿湛笑了：“但知道它在那里，就足够了。”</p><p>夜风吹过天台，带走了一些孤独感。在这个冰冷的数字世界里，他们正试图用最现代的技术，重建最古老的互助传统。</p><h2 id="二、预言机之眼">二、预言机之眼</h2><p>林姐是&quot;最后一道防线&quot;中的3号成员，一位四十多岁的医疗数据分析师。她每天的工作就是训练AI读取各种医疗影像，但她坚持保留着人类的判断力。</p><p>这天下午，她的神经接口突然震动。一条消息浮现在视网膜投影上：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs txt">【紧急通知】<br><br>成员17号（阿湛）进入危重ICU，<br>是否同意从互助钱包中划拨不超过50,000信用点的紧急医疗金到第七综合医院托管账户？<br><br>当前同意人数：0/20<br></code></pre></td></tr></table></figure><p>林姐的心一沉。她认识阿湛，那个总是安静但思维敏捷的年轻人。她立刻调出详细信息，验证这条消息的真实性。</p><p>信息来源是灰城医疗预言机网络——这是连接现实世界与区块链的桥梁。在技术行话中，预言机就是能够将现实世界的信息以可验证方式传递到区块链上的系统。灰城的医疗系统已经与多个区块链预言机服务对接，当患者状态符合特定条件时，预言机会自动向相关智能合约发送信号。</p><p>林姐仔细检查了签名：医院的数字证书、急救系统的时间戳、预言机的加密签名，都是有效的。这不是诈骗。</p><p>她毫不犹豫地按下&quot;同意&quot;按钮。她的硬件钱包自动激活，生成了一个加密签名，发送到区块链网络。在她的屏幕上，同意计数变成了&quot;1/20&quot;。</p><p>与此同时，全城各处，其他二十八个成员也收到了相同的通知。</p><p>小唐（8号成员）正在一场虚拟会议中。去年，他的父亲突发脑溢血，正是这个互助系统及时提供的资金，让老人得到了最好的治疗。他设置了&quot;危重事件自动同意上限3万&quot;，所以系统直接代他做了决定，将签名广播到网络。计数变成了&quot;2/20&quot;。</p><p>老周（22号成员）是个谨慎的人。他先检查了医院地址是否在白名单中，确认这不是一个钓鱼攻击。满意后，他也按下了同意按钮。“3/20”。</p><p>陈医生（5号成员）恰好在第七综合医院工作。他收到消息后，直接去ICU看了一眼。病床上的阿湛面色苍白，头部缠着厚厚的绷带，各种管子连接着他的身体。陈医生回到办公室，毫不犹豫地授权了自己的签名。“4/20”。</p><p>到了晚上十点，同意的人数已经达到了21个，超过了所需的阈值。智能合约自动执行：50,000信用点从多签钱包转移到了第七综合医院的医疗托管地址，并在区块链上留下了永久记录：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs txt">【紧急医疗资金释放】<br><br>受助人：17号成员阿湛<br>金额：50,000信用点<br>医疗机构：第七综合医院<br>批准人：[21个地址的加密签名列表]<br>时间戳：2045-09-17 22:03:47<br>交易哈希：0x7d8f...e5a2<br></code></pre></td></tr></table></figure><p>医院财务系统收到链上确认后，阿湛的病例立即被标记为&quot;资金已担保&quot;。医生们不再需要等待家属签字或支付押金，就可以进行一切必要的治疗。</p><p>在数字世界的某个角落，二十一把虚拟的钥匙同时转动，打开了保险柜，为一个昏迷不醒的年轻人撑起了一道生命防线。</p><h2 id="三、冰冷数据与温暖代码">三、冰冷数据与温暖代码</h2><p>阿湛躺在ICU的病床上，对外界发生的一切毫无知觉。他的意识漂浮在某个虚无的空间，既不是现实，也不是数字世界。</p><p>在医院的数据中心，他的生命体征以冰冷的数字流淌：心率、血压、脑电波、血氧饱和度…这些数据不仅显示在医护人员的屏幕上，还通过加密通道传输给医疗预言机网络，再由预言机转化为区块链上的事件信号。</p><p>第七综合医院的主治医生李教授站在病床前，查看着最新的扫描结果。阿湛的情况不容乐观：车祸造成的脑部损伤严重，虽然紧急手术减轻了颅内压，但他仍处于深度昏迷状态。</p><p>&quot;有联系到他的家人吗？&quot;李教授问一旁的护士。</p><p>&quot;系统显示他没有在灰城登记的直系亲属，&quot;护士回答，“但有一个特殊标记——他是’最后一道防线’互助网络的成员。系统已经通知了他的两位紧急联系人：一位是他的堂妹阿芙，住在南方；另一位是这个互助网络的01号成员，老邵。”</p><p>李教授点点头。他听说过这种基于区块链的互助网络，但这是他第一次亲眼见证它的运作。</p><p>“医疗费用呢？”</p><p>&quot;已经由互助网络的智能合约转入了医院托管账户，足够支付目前的治疗。&quot;护士调出财务界面，“看，这是区块链上的交易记录，二十一个人签名同意的。”</p><p>李教授看着屏幕上那串串复杂的加密签名，突然感到一种奇怪的情绪。在这个高度数字化的世界里，这些冰冷的代码和哈希值，竟然承载着如此温暖的人性关怀。</p><p>…</p><p>三天后，阿芙终于从南方赶到了灰城。她是阿湛为数不多的亲人，但平时联系并不多。</p><p>当她匆忙走进ICU时，看到的是一个陌生的中年男人站在阿湛床前。</p><p>“你是…”</p><p>&quot;老邵，&quot;男人转身，疲惫地笑了笑，“我是阿湛的朋友，也是他加入的互助网络的成员。”</p><p>阿芙听说过这个网络，但并不了解详情。老邵简单解释了&quot;最后一道防线&quot;的运作机制：三十个互不相识的人，通过区块链技术和多重签名钱包，为彼此建立了一道生命安全网。</p><p>&quot;就像三十个人共同掌管一个保险柜，&quot;老邵说，“只有当至少二十个人同意时，保险柜才会打开，里面的钱才能被用于特定目的——比如现在，为阿湛支付医疗费用。”</p><p>阿芙看着病床上的堂兄，眼泪夺眶而出：“谢谢你们…”</p><p>老邵摇摇头：“不必谢我们。这是阿湛自己的选择，也是他为自己准备的后路。他很聪明，知道在这座城市里，人与人之间的联系有多脆弱。”</p><p>阿芙擦干眼泪，问道：“他会好起来吗？”</p><p>老邵没有立即回答。他调出了一个界面，上面显示着阿湛的医疗数据和预后分析。</p><p>&quot;医生说情况不乐观，&quot;他最终说道，“但我们会尽一切努力。互助网络的资金会确保他得到最好的治疗，不管结果如何。”</p><p>他没有说出口的是，如果最坏的情况发生，&quot;最后一道防线&quot;还有另一项功能——确保每个成员都能有尊严地离开这个世界，不会成为城市太平间里无人认领的冷冰冰数字编号。</p><h2 id="四、二十把钥匙的告别">四、二十把钥匙的告别</h2><p>第五天凌晨，医院的系统发出了一条新的事件通知：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">【成员17号（阿湛）：临床死亡，经医院、城市户籍系统双重签名确认。】<br></code></pre></td></tr></table></figure><p>这条消息以加密形式广播到区块链网络，被&quot;最后一道防线&quot;的智能合约捕获。合约代码自动执行了预设的逻辑：冻结阿湛作为受款人的医疗类申请，同时启动&quot;身后事务资金申请通道&quot;。</p><p>老邵站在医院的走廊里，手指悬停在虚拟界面上。作为阿湛的紧急联系人，系统赋予他发起&quot;身后事务申请&quot;的权限。他深吸一口气，按下了确认键。</p><p>系统自动填入默认模板：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">逝者：17号成员阿湛<br>资金用途：遗体接运、冷藏、火化、骨灰保存6个月<br>服务机构：灰城公共殡葬服务中心<br>金额上限：20,000信用点<br></code></pre></td></tr></table></figure><p>这个申请被立即推送给其他29个成员。</p><p>林姐正准备上班，看到消息后，她停下了手中的一切。她记得阿湛在一次线下聚会中说过的话：&quot;我不怕死，只怕死后无人问津。&quot;她含着泪水，按下了&quot;同意&quot;按钮。</p><p>小唐收到消息时正在吃早餐。他放下餐具，回想起几个月前阿湛帮他修复过一个智能合约漏洞，分文未取。他立刻授权了自己的签名。</p><p>陈医生作为医院的内部人员，亲眼目睹了抢救过程。他知道医疗团队已经尽了最大努力。他在系统上写下一段话：&quot;作为医生，我确认我们尽了全力。作为朋友，我承诺会确保你的身后事务得到妥善处理。&quot;然后他也按下了同意键。</p><p>老周看到消息后，打开了他们小圈子的加密聊天室。里面已经有十几个人在表达悼念。他想起阿湛曾经审计过他们的合约代码，确保没有漏洞。现在，这个他帮助构建的系统，正在为他自己服务。老周默默地完成了签名。</p><p>不到12小时，同意的人数就达到了24个，远超所需的20个阈值。智能合约自动执行：20,000信用点从多签钱包转移到了灰城公共殡葬服务中心的账户，附带着不可篡改的备注：“本笔资金需用于：17号成员阿湛之遗体接运、冷藏、火化及骨灰妥善保管。”</p><p>同时，合约还按照预设，将骨灰保管权登记为两个顺位：第一顺位是阿湛的堂妹阿芙，第二顺位是互助圈的托管地址，用于在没有亲属认领的情况下代管骨灰。</p><p>殡葬服务中心的系统接收到区块链上的确认后，立即启动了自动化流程：专用车辆被派往第七综合医院，工作人员按照规定的程序和时间，将阿湛的遗体转运到殡仪馆。</p><p>所有这一切，都在数字世界和现实世界的交界处无缝运行，就像阿湛生前设计的那样。</p><p>…</p><p>两天后，阿芙来到灰城殡仪馆。她本以为要面对繁琐的手续和高昂的费用，却发现一切都已安排妥当。</p><p>&quot;您是阿湛先生的亲属？&quot;一位工作人员迎上来，“请跟我来。”</p><p>在一个安静的房间里，阿芙看到了装有堂兄骨灰的白色瓷盒。工作人员向她展示了一个屏幕，上面显示着一条区块链交易记录：一长串复杂的数据，代表着24个人的数字签名，证明在她手足无措的时候，有一群素不相识的人默默为她的堂兄完成了最后的告别仪式。</p><p>&quot;这是什么？&quot;阿芙指着那些数据问道。</p><p>&quot;这是’最后一道防线’，&quot;工作人员解释，“您堂兄生前加入的互助网络。这些签名代表着29个人共同决定，为他支付身后事务的费用。按照规定，实际花费13,500信用点，剩余的6,500信用点将在30天后退回到他们的共同账户，用于帮助下一个可能需要帮助的人。”</p><p>阿芙看着那串冰冷的数据，突然理解了什么是真正的互助——不是出于血缘的义务，而是基于共同价值观的自愿选择；不是依赖单一权威的慈善，而是分布式的、去中心化的人与人之间的守望相助。</p><p>她轻轻抚摸着骨灰盒，低声说道：“原来你并不孤单，堂兄。你找到了自己的部落。”</p><h2 id="五、代码中的温度">五、代码中的温度</h2><p>阿湛离世一个月后，&quot;最后一道防线&quot;的29个成员举行了一次特殊的线上会议。这不是普通的视频会议，而是一个部署在区块链上的去中心化自治组织(DAO)投票。</p><p>老邵作为01号成员，首先发言：“今天我们聚在一起，不仅是为了悼念17号成员阿湛，也是为了讨论我们这个小圈子的未来。”</p><p>屏幕上显示着三个提案：</p><ol><li>是否吸收新成员补足到30人？</li><li>是否调整多签阈值30/20？</li><li>是否增加&quot;长期昏迷&quot;的特殊规则？</li></ol><p>林姐提出了自己的看法：“关于第一个问题，我认为我们应该吸收新成员。阿湛离开了，但’最后一道防线’的理念应该继续。不过，新成员加入前，必须审计合约、了解全部历史记录，明确自己在参与什么。”</p><p>小唐补充道：“我同意。而且我们应该让新成员了解阿湛的故事，他不仅是我们中的一员，还是这个系统的技术贡献者。”</p><p>关于第二个问题，老周表达了自己的担忧：“我认为我们应该维持20的门槛。如果太低，安全性会受到影响；如果太高，在紧急情况下可能来不及集齐足够的签名。”</p><p>陈医生作为医疗专业人士，对第三个问题特别关注：“阿湛的情况让我们意识到一个问题：如果成员长期处于昏迷状态，我们需要一种既能持续支持又防止滥用的机制。我建议在下一个版本的合约中加入’长期护理金’申请流程，由医院预言机和两名指定亲属共同发起，额度小一些，但可以按月续批。”</p><p>讨论持续了几个小时，每个人都通过加密签名表达了自己的观点。最终，投票结果显示：</p><ol><li>同意吸收新成员：29票赞成，0票反对</li><li>维持现有多签阈值：25票赞成，4票反对</li><li>增加长期昏迷特殊规则：28票赞成，1票弃权</li></ol><p>老邵总结道：“根据投票结果，我们将启动新成员招募程序，并开始设计合约升级方案，加入长期护理金机制。这些更改将在下一个版本中实现，但前提是我们至少有20个人签名确认新合约。”</p><p>在会议即将结束时，林姐提出了一个特殊请求：“在我们升级合约之前，我想分享阿湛留在代码中的一段注释。这是他在审计合约时写下的，我认为它应该被保留在新版本中。”</p><p>屏幕上显示出一段文字：</p><p>“这一切代码和规则，只是我们在这个冷酷世界给彼此留的一点’保证’——保证在最脆弱的两种时刻：1. 你昏迷着，什么都不能做；2. 你已经离开了，什么都不知道；仍有一笔钱，会按你和大家早就写好的规则，安静而可靠地帮你撑一次。”</p><p>29个人沉默了片刻，然后一个接一个地按下了&quot;同意&quot;按钮，承诺将这段话永久保存在合约代码中，作为阿湛的精神遗产，也是这个小圈子的灵魂所在。</p><p>…</p><p>三个月后，&quot;最后一道防线&quot;迎来了新的30号成员——一位年轻的女性程序员小林。在加入仪式上，老邵向她展示了智能合约的核心逻辑：</p><p>&quot;这个多签钱包就像一个有三十把锁的保险柜，&quot;他解释道，“只有当至少二十个人同意时，里面的钱才能被用于两种情况：一是成员昏迷需要紧急医疗费用，二是成员去世需要处理身后事务。”</p><p>小林仔细阅读着合约代码，尤其是那段被特别标记的注释。她问道：“这是谁写的？”</p><p>&quot;17号成员，&quot;老邵回答，“他已经不在了，但他的话一直留在这里，提醒我们这个系统存在的意义。”</p><p>小林点点头，庄重地生成了自己的密钥对，并将公钥添加到多签合约中。系统自动记录了这一变更：</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs txt">【成员变更】<br><br>新增：30号成员小林<br>多签阈值：维持30/20<br>变更确认：已获得25个有效签名<br>时间戳：2046-01-15 10:30:22<br>交易哈希：0x9e3f...b7a1<br></code></pre></td></tr></table></figure><p>就这样，在阿湛离开的地方，新的生命加入了这个特殊的圈子。三十把虚拟的钥匙，三十个互不相识却彼此守望的灵魂，构成了这座冰冷城市中一道温暖的防线。</p><p>在数字与现实的交界处，他们用最现代的技术，重建了最古老的互助传统；用冰冷的代码，传递着最温暖的人性关怀。</p><p>这就是&quot;最后一道防线&quot;——当你最脆弱时，仍有二十个人愿意为你转动钥匙，打开那扇通往尊严的门。</p>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/%E6%95%85%E4%BA%8B/">故事</category>
      
      
      <comments>https://hexo.limour.top/the-last-line-of-defense#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【想法】基于双签钱包的零信任交易设计</title>
      <link>https://hexo.limour.top/design-of-zero-trust-transaction-based-on-dual-signature-wallet</link>
      <guid>https://hexo.limour.top/design-of-zero-trust-transaction-based-on-dual-signature-wallet</guid>
      <pubDate>Sun, 02 Nov 2025 14:52:37 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;情景&quot;&gt;情景&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;小A想4000U向小B购买1盎司实物黄金，小A、小B互相匿名&lt;/li&gt;
&lt;li&gt;双方约定，以小B向某双方安全的地点放置黄金，之后小A在安全的时间取走的方式交货&lt;/li&gt;
&lt;li&gt;通过以下方式可以保证小A拿到黄金后，不会拒绝</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="情景">情景</h2><ul><li>小A想4000U向小B购买1盎司实物黄金，小A、小B互相匿名</li><li>双方约定，以小B向某双方安全的地点放置黄金，之后小A在安全的时间取走的方式交货</li><li>通过以下方式可以保证小A拿到黄金后，不会拒绝向小B付款</li></ul><h2 id="设计">设计</h2><ol><li>双方约定一个双签钱包Y，需要双方共同签名才能取走资金</li><li>小A向Y存入风险押金X=400U，等待小B向Y存入X=400U</li><li>重复2，直到双签钱包总资金达到8000U，此时小A再向双签钱包存入4000U</li><li>小B放置黄金，并等待小A取走</li><li>小A取走黄金后，通过多签钱包构造转账，向小A转4000U且向小B转8000U，并进行签名</li><li>小B对交易进行签名，结束交易</li><li>通过控制风险押金X的值，小A可以在至多损失X的情况下完成交易</li></ol><h2 id="附加">附加</h2><ul><li>多签钱包构建工具 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9hcHAuc2FmZS5nbG9iYWwvd2VsY29tZQ==" rel="noopener external nofollow noreferrer">safe</a></li></ul>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/dex/">dex</category>
      
      
      <comments>https://hexo.limour.top/design-of-zero-trust-transaction-based-on-dual-signature-wallet#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【绘图】数据一致性分析和BA图</title>
      <link>https://hexo.limour.top/data-consistency-analysis-and-bland-altman-diagram</link>
      <guid>https://hexo.limour.top/data-consistency-analysis-and-bland-altman-diagram</guid>
      <pubDate>Sun, 26 Oct 2025 14:42:05 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;配置环境&quot;&gt;配置环境&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/-ji-lu--an-zhuang-sheng-xin-de-dai-ma-bian-xie-huan-jing&quot;&gt;基础编程环境&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;hi</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="配置环境">配置环境</h2><ul><li><a href="/-ji-lu--an-zhuang-sheng-xin-de-dai-ma-bian-xie-huan-jing">基础编程环境</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda create -n icc conda-forge::r-tidyverse conda-forge::r-irkernel conda-forge::r-lme4 conda-forge::r-psych conda-forge::r-blandaltmanleh -y<br>conda run -n icc Rscript -e <span class="hljs-string">&quot;IRkernel::installspec(name=&#x27;icc&#x27;, displayname=&#x27;r-icc&#x27;)&quot;</span><br></code></pre></td></tr></table></figure><h2 id="使用示例">使用示例</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs R">require<span class="hljs-punctuation">(</span>psych<span class="hljs-punctuation">)</span><br>require<span class="hljs-punctuation">(</span>BlandAltmanLeh<span class="hljs-punctuation">)</span><br>require<span class="hljs-punctuation">(</span>tidyverse<span class="hljs-punctuation">)</span><br>require<span class="hljs-punctuation">(</span>RColorBrewer<span class="hljs-punctuation">)</span><br>options<span class="hljs-punctuation">(</span>repr.plot.width<span class="hljs-operator">=</span><span class="hljs-number">6</span><span class="hljs-punctuation">,</span> repr.plot.height<span class="hljs-operator">=</span><span class="hljs-number">12</span><span class="hljs-punctuation">)</span><br>RColorBrewer<span class="hljs-operator">::</span>display.brewer.all<span class="hljs-punctuation">(</span>type <span class="hljs-operator">=</span> <span class="hljs-string">&quot;all&quot;</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">R1 <span class="hljs-operator">=</span> readr<span class="hljs-operator">::</span>read_tsv<span class="hljs-punctuation">(</span>na <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;/&#x27;</span><span class="hljs-punctuation">,</span> locale <span class="hljs-operator">=</span> locale<span class="hljs-punctuation">(</span>encoding <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;GBK&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> show_col_types <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">,</span><br>                                 file <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;./data/R1.tsv&#x27;</span><span class="hljs-punctuation">)</span><br>R2 <span class="hljs-operator">=</span> readr<span class="hljs-operator">::</span>read_tsv<span class="hljs-punctuation">(</span>na <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;/&#x27;</span><span class="hljs-punctuation">,</span> locale <span class="hljs-operator">=</span> locale<span class="hljs-punctuation">(</span>encoding <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;GBK&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> show_col_types <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">,</span><br>                                 file <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;./data/R2.tsv&#x27;</span><span class="hljs-punctuation">)</span><br>R1 <span class="hljs-operator">%&gt;%</span> head<br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs R"><span class="hljs-comment"># Single 衡量一次测量的可靠性 Average 最终结果是多次评分的平均值</span><br><span class="hljs-comment"># raters_absolute 每个对象由随机抽取的观察者评分</span><br><span class="hljs-comment"># random_raters 所有对象由同一组观察者的评分</span><br><span class="hljs-comment"># fixed_raters 所有对象由固定的观察者评分</span><br>f_check_icc_df <span class="hljs-operator">&lt;-</span> <span class="hljs-keyword">function</span><span class="hljs-punctuation">(</span>R1_<span class="hljs-punctuation">,</span> R2_<span class="hljs-punctuation">,</span> vars_<span class="hljs-punctuation">,</span> type<span class="hljs-operator">=</span><span class="hljs-string">&#x27;Single_fixed_raters&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span><br>    res <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>var <span class="hljs-operator">=</span> vars_<span class="hljs-punctuation">,</span> ICC <span class="hljs-operator">=</span> <span class="hljs-built_in">rep</span><span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>vars_<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <span class="hljs-built_in">F</span><span class="hljs-operator">=</span><span class="hljs-built_in">rep</span><span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>vars_<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> <br>                     p.value <span class="hljs-operator">=</span> <span class="hljs-built_in">rep</span><span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>vars_<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> lower<span class="hljs-operator">=</span><span class="hljs-built_in">rep</span><span class="hljs-punctuation">(</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>vars_<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span> upper<span class="hljs-operator">=</span><span class="hljs-built_in">rep</span><span class="hljs-punctuation">(</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-built_in">length</span><span class="hljs-punctuation">(</span>vars_<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>    <span class="hljs-keyword">for</span> <span class="hljs-punctuation">(</span>i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span><span class="hljs-operator">:</span>nrow<span class="hljs-punctuation">(</span>res<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">&#123;</span><br>        var <span class="hljs-operator">=</span> res<span class="hljs-operator">$</span>var<span class="hljs-punctuation">[</span>i<span class="hljs-punctuation">]</span><br>        data <span class="hljs-operator">=</span> data.frame<span class="hljs-punctuation">(</span>R1_<span class="hljs-punctuation">[[</span>var<span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> R2_<span class="hljs-punctuation">[[</span>var<span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><br>        result <span class="hljs-operator">&lt;-</span> psych<span class="hljs-operator">::</span>ICC<span class="hljs-punctuation">(</span>data<span class="hljs-punctuation">)</span><br>        result <span class="hljs-operator">&lt;-</span> result<span class="hljs-operator">$</span>results<span class="hljs-punctuation">[</span>type<span class="hljs-punctuation">,</span><span class="hljs-punctuation">]</span><br>        res<span class="hljs-punctuation">[</span>i<span class="hljs-punctuation">,</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;ICC&#x27;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;F&#x27;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;p.value&#x27;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;lower&#x27;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;upper&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">&lt;-</span> result<span class="hljs-punctuation">[</span><span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;ICC&#x27;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;F&#x27;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;p&#x27;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;lower bound&#x27;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;upper bound&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-built_in">return</span><span class="hljs-punctuation">(</span>res<span class="hljs-punctuation">)</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs R">vars <span class="hljs-operator">=</span> colnames<span class="hljs-punctuation">(</span>R1<span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-operator">-</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><br>ICC_result <span class="hljs-operator">&lt;-</span> f_check_icc_df<span class="hljs-punctuation">(</span>R1<span class="hljs-punctuation">,</span> R2<span class="hljs-punctuation">,</span> vars<span class="hljs-punctuation">)</span><br>ICC_result <span class="hljs-operator">%&gt;%</span> head<br>readr<span class="hljs-operator">::</span>write_tsv<span class="hljs-punctuation">(</span>x <span class="hljs-operator">=</span> ICC_result<span class="hljs-punctuation">,</span> file <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;./data/icc.tsv&#x27;</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs R">bland.altman.ggplot2 <span class="hljs-operator">&lt;-</span> <span class="hljs-keyword">function</span> <span class="hljs-punctuation">(</span>group1<span class="hljs-punctuation">,</span> group2<span class="hljs-punctuation">,</span> var_n<span class="hljs-punctuation">,</span> two <span class="hljs-operator">=</span> <span class="hljs-number">1.96</span><span class="hljs-punctuation">,</span> mode <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> conf.int <span class="hljs-operator">=</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> geom_count <span class="hljs-operator">=</span> <span class="hljs-literal">FALSE</span><span class="hljs-punctuation">)</span> <br><span class="hljs-punctuation">&#123;</span><br>    ba <span class="hljs-operator">&lt;-</span> BlandAltmanLeh<span class="hljs-operator">::</span>bland.altman.stats<span class="hljs-punctuation">(</span>group1 <span class="hljs-operator">=</span> group1<span class="hljs-punctuation">,</span> group2 <span class="hljs-operator">=</span> group2<span class="hljs-punctuation">,</span> <br>        two <span class="hljs-operator">=</span> two<span class="hljs-punctuation">,</span> mode <span class="hljs-operator">=</span> mode<span class="hljs-punctuation">,</span> conf.int <span class="hljs-operator">=</span> conf.int<span class="hljs-punctuation">)</span><br>    values <span class="hljs-operator">&lt;-</span> data.frame<span class="hljs-punctuation">(</span>m <span class="hljs-operator">=</span> ba<span class="hljs-operator">$</span>means<span class="hljs-punctuation">,</span> d <span class="hljs-operator">=</span> ba<span class="hljs-operator">$</span>diffs<span class="hljs-punctuation">)</span><br>    geom_my <span class="hljs-operator">&lt;-</span> <span class="hljs-keyword">if</span> <span class="hljs-punctuation">(</span>geom_count<span class="hljs-punctuation">)</span> <br>        ggplot2<span class="hljs-operator">::</span>geom_count<br>    <span class="hljs-keyword">else</span> ggplot2<span class="hljs-operator">::</span>geom_point<br>    m <span class="hljs-operator">&lt;-</span> <span class="hljs-literal">NULL</span><br>    d <span class="hljs-operator">&lt;-</span> <span class="hljs-literal">NULL</span><br>    p <span class="hljs-operator">&lt;-</span> ggplot2<span class="hljs-operator">::</span>ggplot<span class="hljs-punctuation">(</span>values<span class="hljs-punctuation">,</span> ggplot2<span class="hljs-operator">::</span>aes<span class="hljs-punctuation">(</span>x <span class="hljs-operator">=</span> m<span class="hljs-punctuation">,</span> y <span class="hljs-operator">=</span> d<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_my<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    geom_point<span class="hljs-punctuation">(</span>color <span class="hljs-operator">=</span> RColorBrewer<span class="hljs-operator">::</span>brewer.pal<span class="hljs-punctuation">(</span><span class="hljs-number">8</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;Set1&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-number">5</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> size <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    theme_minimal<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> labs<span class="hljs-punctuation">(</span>title <span class="hljs-operator">=</span> paste0<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;Inter-observer Agreement &quot;</span><span class="hljs-punctuation">,</span> var_n<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    ggplot2<span class="hljs-operator">::</span>xlab<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;Mean of measurements&quot;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> ggplot2<span class="hljs-operator">::</span>ylab<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;Difference&quot;</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    theme<span class="hljs-punctuation">(</span><br>        axis.title.x <span class="hljs-operator">=</span> element_text<span class="hljs-punctuation">(</span>size <span class="hljs-operator">=</span> <span class="hljs-number">16</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment"># X轴标题字体大小</span><br>        axis.title.y <span class="hljs-operator">=</span> element_text<span class="hljs-punctuation">(</span>size <span class="hljs-operator">=</span> <span class="hljs-number">16</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment"># Y轴标题字体大小</span><br>        axis.text.x <span class="hljs-operator">=</span> element_text<span class="hljs-punctuation">(</span>size <span class="hljs-operator">=</span> <span class="hljs-number">16</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment"># X轴刻度字体大小</span><br>        axis.text.y <span class="hljs-operator">=</span> element_text<span class="hljs-punctuation">(</span>size <span class="hljs-operator">=</span> <span class="hljs-number">16</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span>   <span class="hljs-comment"># Y轴刻度字体大小</span><br>        panel.border <span class="hljs-operator">=</span> element_rect<span class="hljs-punctuation">(</span>color <span class="hljs-operator">=</span> <span class="hljs-string">&quot;black&quot;</span><span class="hljs-punctuation">,</span> fill <span class="hljs-operator">=</span> <span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span> linewidth <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment"># 方形边框</span><br>        plot.title <span class="hljs-operator">=</span> element_text<span class="hljs-punctuation">(</span>size <span class="hljs-operator">=</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span> face <span class="hljs-operator">=</span> <span class="hljs-string">&quot;bold&quot;</span><span class="hljs-punctuation">,</span> hjust <span class="hljs-operator">=</span> <span class="hljs-number">0.5</span><span class="hljs-punctuation">)</span>  <span class="hljs-comment"># 居中加粗标题</span><br>    <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    ggplot2<span class="hljs-operator">::</span>geom_hline<span class="hljs-punctuation">(</span>yintercept <span class="hljs-operator">=</span> ba<span class="hljs-operator">$</span>lines<span class="hljs-punctuation">[</span><span class="hljs-string">&#x27;mean.diffs&#x27;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> linetype <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dashed&quot;</span><span class="hljs-punctuation">,</span> linewidth <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> RColorBrewer<span class="hljs-operator">::</span>brewer.pal<span class="hljs-punctuation">(</span><span class="hljs-number">8</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;Set1&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-number">8</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    ggplot2<span class="hljs-operator">::</span>geom_hline<span class="hljs-punctuation">(</span>yintercept <span class="hljs-operator">=</span> ba<span class="hljs-operator">$</span>lines<span class="hljs-punctuation">[</span><span class="hljs-string">&#x27;lower.limit&#x27;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> linetype <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dashed&quot;</span><span class="hljs-punctuation">,</span> linewidth <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> RColorBrewer<span class="hljs-operator">::</span>brewer.pal<span class="hljs-punctuation">(</span><span class="hljs-number">8</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;Set1&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-number">3</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> <br>    ggplot2<span class="hljs-operator">::</span>geom_hline<span class="hljs-punctuation">(</span>yintercept <span class="hljs-operator">=</span> ba<span class="hljs-operator">$</span>lines<span class="hljs-punctuation">[</span><span class="hljs-string">&#x27;upper.limit&#x27;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> linetype <span class="hljs-operator">=</span> <span class="hljs-string">&quot;dashed&quot;</span><span class="hljs-punctuation">,</span> linewidth <span class="hljs-operator">=</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> color <span class="hljs-operator">=</span> RColorBrewer<span class="hljs-operator">::</span>brewer.pal<span class="hljs-punctuation">(</span><span class="hljs-number">8</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;Set1&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span><br>    ggplot2<span class="hljs-operator">::</span>annotate<span class="hljs-punctuation">(</span><span class="hljs-string">&quot;rect&quot;</span><span class="hljs-punctuation">,</span> xmin <span class="hljs-operator">=</span> <span class="hljs-operator">-</span><span class="hljs-literal">Inf</span><span class="hljs-punctuation">,</span> xmax <span class="hljs-operator">=</span> <span class="hljs-literal">Inf</span><span class="hljs-punctuation">,</span> ymin <span class="hljs-operator">=</span> ba<span class="hljs-operator">$</span>lines<span class="hljs-punctuation">[</span><span class="hljs-string">&#x27;lower.limit&#x27;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> ymax <span class="hljs-operator">=</span> ba<span class="hljs-operator">$</span>lines<span class="hljs-punctuation">[</span><span class="hljs-string">&#x27;upper.limit&#x27;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>           alpha <span class="hljs-operator">=</span> <span class="hljs-number">0.2</span><span class="hljs-punctuation">,</span> fill <span class="hljs-operator">=</span> <span class="hljs-string">&quot;lightblue&quot;</span><span class="hljs-punctuation">)</span><br>    <br>    <span class="hljs-built_in">return</span><span class="hljs-punctuation">(</span>p<span class="hljs-punctuation">)</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs R">options<span class="hljs-punctuation">(</span>repr.plot.width<span class="hljs-operator">=</span><span class="hljs-number">6</span><span class="hljs-punctuation">,</span> repr.plot.height<span class="hljs-operator">=</span><span class="hljs-number">4</span><span class="hljs-punctuation">)</span><br>vars <span class="hljs-operator">=</span> colnames<span class="hljs-punctuation">(</span>R1<span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-operator">-</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><br><span class="hljs-keyword">for</span> <span class="hljs-punctuation">(</span>var <span class="hljs-keyword">in</span> vars<span class="hljs-punctuation">)</span><span class="hljs-punctuation">&#123;</span><br>    bap <span class="hljs-operator">&lt;-</span> bland.altman.ggplot2<span class="hljs-punctuation">(</span><br>        R1<span class="hljs-punctuation">[[</span>var<span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> R2<span class="hljs-punctuation">[[</span>var<span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> var_n<span class="hljs-operator">=</span>var<br>    <span class="hljs-punctuation">)</span><br>    print<span class="hljs-punctuation">(</span>bap<span class="hljs-punctuation">)</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="https://img.limour.top/2025/10/27/68fe4a5262f3b.webp" alt=""></p>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/%E7%BB%98%E5%9B%BE/">绘图</category>
      
      
      <comments>https://hexo.limour.top/data-consistency-analysis-and-bland-altman-diagram#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【记录】永续合约市场的实践经验</title>
      <link>https://hexo.limour.top/practical-experience-in-perpetual-contract-market</link>
      <guid>https://hexo.limour.top/practical-experience-in-perpetual-contract-market</guid>
      <pubDate>Tue, 30 Sep 2025 07:47:48 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&lt;img src=&quot;https://img.limour.top/2025/10/02/68de231bc3f8f.webp&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;无意义的呓语&quot;&gt;无意义的呓语&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;货币 = 对流动的共识的一种计数&lt;/li&gt;
&lt;l</description>
        
      
      
      
      <content:encoded><![CDATA[<p><img src="https://img.limour.top/2025/10/02/68de231bc3f8f.webp" alt=""></p><h2 id="无意义的呓语">无意义的呓语</h2><ol><li>货币 = 对流动的共识的一种计数</li><li>财富 = 累积起来的货币</li><li>赚取财富的唯一途径是创造价值</li><li>A天低买B天高卖 = 时间上的套利</li><li>A地低买B地高卖 = 空间上的套利</li><li>套利维护了某一维度上的平衡，维度可以是时间、空间、法规等等，这是一种价值的创造，因此能赚取财富</li></ol><h3 id="推论1">推论1</h3><ul><li>准备 <code>宽基指数ETF、黄金ETF、长期国债ETF、货币基金ETF</code>，25% 等比例建仓</li><li>当某个EFT占比达 35% 或 15% 时调仓，重新平衡为25%等比例仓位</li><li>重复上述过程，即可获得年化回报</li><li>宽基+长债对冲、宽基+货基对冲、黄金+货基对冲、长债+货基对冲</li><li>再平衡维护了以上四种对冲之间的平衡，创造了价值，因此赚取了套利财富</li><li>定投本身不能套利，加上再平衡策略才是套利</li></ul><h2 id="准备工作">准备工作</h2><ul><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly93d3cuYmluYW5jZS5jb20=" rel="noopener external nofollow noreferrer">中心化交易所</a> C2C入金</li><li>安装 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9tZXRhbWFzay5pbw==" rel="noopener external nofollow noreferrer">MetaMask</a> 钱包的浏览器插件</li><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9hcHAuaHlwZXJsaXF1aWQueHl6" rel="noopener external nofollow noreferrer">去中心化交易所</a> 进行合约交易</li><li>U卡进行出金消费</li><li>下单方式：<a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL0xpbW91ci1kZXYvY3J5cHRvX21vbml0b3IvdHJlZS9tYWluL2V4X3N0cmF0ZWd5" rel="noopener external nofollow noreferrer">TWAP</a></li></ul><h2 id="市场假设">市场假设</h2><ol><li>有效市场假设：价格反应了市场上的所有信息，长期主要趋势无法被操纵</li><li>价格分布假设：价格由供需关系和随机波动构成，供需关系服从偏态分布，可由<code>EMA</code>捕获</li><li>流动性假设：价格会向流动性高的地方游走，并短暂停留</li></ol><h2 id="盈利原理">盈利原理</h2><ol><li>局部概率优势：整体对庄家有利的游戏，在不洗牌的前提下，对庄家有利的牌出现频率越高，后续对玩家有利的牌出现频率越高</li><li>注意：概率优势具有非传递性，对于骰子<code>A=(3,3,3,3,3,3)</code>、<code>B=(6,5,2,2,2,2</code>)、<code>C=(4,4,4,4,1,1)</code>，计算可得，A胜B概率为66%，B胜C概率56%，C胜A概率为66%</li></ol><h2 id="复利有限">复利有限</h2><ol><li>胜率、盈亏比、开单频率构成不可能三角</li><li>所有策略存在管理资金的容量上限</li><li>策略资金容量有限，管理资金的增长满足 Logistic 曲线，保持一半策略资金容量能获得最大年化收益率。</li></ol><h2 id="仓位管理">仓位管理</h2><ul><li>以损定仓：止损不得超过总资金的2%，以此计算每次的仓位</li><li>考虑胜率50%，盈利900%，亏损90%的假设情景，则有</li><li>分批建仓，期望收益为 <code>0.5 * 9 + 0.5 * 0.1 &gt; 1</code></li><li>梭哈建仓，期望收益为 <code>1 * (9 ^ 0.5) * (0.1 ^ 0.5) &lt; 1</code></li></ul><h2 id="简单推论">简单推论</h2><ol><li>根据流动性假设，当期权名义金额不足以影响市场时，价格会向着使大多数期货合约止损的位置游走</li><li>根据流动性假设，当期权名义金额较大时，价格会向着当日期权最大痛点游走</li></ol><h2 id="策略构建-过时放弃">策略构建(过时放弃)</h2>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-53e29248" role="button" aria-expanded="false" aria-controls="collapse-53e29248">        <div class="fold-arrow">▶</div>点开查看折叠的代码      </div>      <div class="fold-collapse collapse" id="collapse-53e29248">        <div class="fold-content">          <ul><li>根据有效市场假设，选日线级别</li><li>根据价格分布假设，构建多EMA均线系统捕获供需关系</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//@version=6</span><br><span class="hljs-title function_">indicator</span>(<span class="hljs-string">&quot;副图指标&quot;</span>, overlay=<span class="hljs-literal">false</span>, max_boxes_count = <span class="hljs-number">500</span>)<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">TradingView</span>/ta/<span class="hljs-number">10</span><br><br>ma1 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">3</span>)<br>ma2 = ta.<span class="hljs-title function_">dema</span>(hlcc4, <span class="hljs-number">5</span>)<br>ma3 = ta.<span class="hljs-title function_">dema</span>(hlcc4, <span class="hljs-number">7</span>)<br>ma4 = ta.<span class="hljs-title function_">dema</span>(hlcc4, <span class="hljs-number">11</span>)<br>ma5 = ta.<span class="hljs-title function_">dema</span>(hlcc4, <span class="hljs-number">13</span>)<br>ma6 = ta.<span class="hljs-title function_">dema</span>(hlcc4, <span class="hljs-number">17</span>)<br><span class="hljs-title function_">plot</span>(ma1, color = color.<span class="hljs-property">aqua</span>)<br><span class="hljs-title function_">plot</span>(ma2, color = color.<span class="hljs-property">aqua</span>)<br><span class="hljs-title function_">plot</span>(ma3, color = color.<span class="hljs-property">aqua</span>)<br><span class="hljs-title function_">plot</span>(ma4, color = color.<span class="hljs-property">aqua</span>)<br><span class="hljs-title function_">plot</span>(ma5, color = color.<span class="hljs-property">aqua</span>)<br><span class="hljs-title function_">plot</span>(ma6, color = color.<span class="hljs-property">aqua</span>)<br><br>ma7 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">19</span>)<br>ma8 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">23</span>)<br>ma9 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">29</span>)<br>ma10 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">31</span>)<br>ma11 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">37</span>)<br>ma12 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">41</span>)<br><span class="hljs-title function_">plot</span>(ma7, color = color.<span class="hljs-property">red</span>)<br><span class="hljs-title function_">plot</span>(ma8, color = color.<span class="hljs-property">red</span>)<br><span class="hljs-title function_">plot</span>(ma9, color = color.<span class="hljs-property">red</span>)<br><span class="hljs-title function_">plot</span>(ma10, color = color.<span class="hljs-property">orange</span>)<br><span class="hljs-title function_">plot</span>(ma11, color = color.<span class="hljs-property">orange</span>)<br><span class="hljs-title function_">plot</span>(ma12, color = color.<span class="hljs-property">orange</span>)<br><br><br>ma13 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">43</span>)<br>ma14 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">47</span>)<br>ma15 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">53</span>)<br>ma16 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">59</span>)<br>ma17 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">61</span>)<br>ma18 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">67</span>)<br><span class="hljs-title function_">plot</span>(ma13, color = color.<span class="hljs-property">yellow</span>)<br><span class="hljs-title function_">plot</span>(ma14, color = color.<span class="hljs-property">yellow</span>)<br><span class="hljs-title function_">plot</span>(ma15, color = color.<span class="hljs-property">yellow</span>)<br><span class="hljs-title function_">plot</span>(ma16, color = color.<span class="hljs-property">green</span>)<br><span class="hljs-title function_">plot</span>(ma17, color = color.<span class="hljs-property">green</span>)<br><span class="hljs-title function_">plot</span>(ma18, color = color.<span class="hljs-property">green</span>)<br><br><br>ma19 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">71</span>)<br>ma20 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">73</span>)<br>ma21 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">79</span>)<br>ma22 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">83</span>)<br>ma23 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">89</span>)<br>ma24 = ta.<span class="hljs-title function_">ema</span>(hlcc4, <span class="hljs-number">97</span>)<br><span class="hljs-title function_">plot</span>(ma19, color = color.<span class="hljs-property">blue</span>)<br><span class="hljs-title function_">plot</span>(ma20, color = color.<span class="hljs-property">blue</span>)<br><span class="hljs-title function_">plot</span>(ma21, color = color.<span class="hljs-property">blue</span>)<br><span class="hljs-title function_">plot</span>(ma22, color = color.<span class="hljs-property">purple</span>)<br><span class="hljs-title function_">plot</span>(ma23, color = color.<span class="hljs-property">purple</span>)<br><span class="hljs-title function_">plot</span>(ma24, color = color.<span class="hljs-property">purple</span>)<br><br>[bb_middle, bb_upper, bb_lower] = ta.<span class="hljs-title function_">bb</span>(hlcc4, <span class="hljs-number">42</span>, <span class="hljs-number">2</span>)<br><br>ema15l = ta.<span class="hljs-title function_">ema</span>(low, <span class="hljs-number">15</span>)<br>ema15h = ta.<span class="hljs-title function_">ema</span>(high, <span class="hljs-number">15</span>)<br>ema15 = ema15l &gt; bb_middle ? ema15l : ema15h &lt; bb_middle ? <span class="hljs-attr">ema15h</span>: bb_middle<br><br>bb_lower := hlcc4 &gt; bb_middle ? ema15 : bb_lower<br>bb_upper := hlcc4 &lt; bb_middle ? ema15 : bb_upper<br><br><span class="hljs-title function_">plot</span>(bb_lower, title = <span class="hljs-string">&#x27;bb_l&#x27;</span>, color = color.<span class="hljs-title function_">rgb</span>(<span class="hljs-number">105</span>, <span class="hljs-number">214</span>, <span class="hljs-number">72</span>, <span class="hljs-number">35</span>), force_overlay = <span class="hljs-literal">true</span>, linewidth = <span class="hljs-number">2</span>)<br><span class="hljs-title function_">plot</span>(bb_upper, title = <span class="hljs-string">&#x27;bb_u&#x27;</span>, color = color.<span class="hljs-title function_">rgb</span>(<span class="hljs-number">149</span>, <span class="hljs-number">42</span>, <span class="hljs-number">190</span>, <span class="hljs-number">35</span>), force_overlay = <span class="hljs-literal">true</span>, linewidth = <span class="hljs-number">2</span>)<br><span class="hljs-title function_">plot</span>(ema15, title = <span class="hljs-string">&#x27;ema15&#x27;</span>, color = color.<span class="hljs-property">blue</span>, force_overlay = <span class="hljs-literal">true</span>, linewidth = <span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><ul><li>根据价格分布假设，构建均线发散系统捕获随机波动导致的超买超卖</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js">maArray = array.<span class="hljs-title function_">from</span>(ma1, ma2, ma3, ma4, ma5, ma6, ma7, ma8, ma9, ma10, ma11, ma12, ma13, ma14, ma15, ma16, ma17, ma18, ma19, ma20, ma21, ma22, ma23, ma24)<br><br>maMin = array.<span class="hljs-title function_">min</span>(maArray)<br>maMax = array.<span class="hljs-title function_">max</span>(maArray)<br><br><span class="hljs-title function_">plot</span>(math.<span class="hljs-title function_">abs</span>(close - open), title=<span class="hljs-string">&quot;vix&quot;</span>, style=plot.<span class="hljs-property">style_columns</span>, color=close &gt; open ? color.<span class="hljs-property">lime</span> : color.<span class="hljs-property">red</span>)<br><br>mavix = (maMax - maMin)<br><span class="hljs-title function_">plot</span>(mavix,  <span class="hljs-string">&quot;MAVIX&quot;</span>, color=color.<span class="hljs-property">olive</span>)<br>mavixma = ta.<span class="hljs-title function_">ema</span>(mavix, <span class="hljs-number">9</span>)<br><span class="hljs-title function_">plot</span>(mavixma, <span class="hljs-string">&quot;MAVIX_Signal&quot;</span>, color=color.<span class="hljs-property">blue</span>)<br><br><span class="hljs-title function_">plot</span>(ta.<span class="hljs-title function_">atr</span>(<span class="hljs-number">200</span>), <span class="hljs-string">&quot;ATR&quot;</span>, color=color.<span class="hljs-property">aqua</span>)<br><br>qq_t = <span class="hljs-title function_">time</span>(timeframe.<span class="hljs-property">period</span>)<br>qq_day = <span class="hljs-title function_">dayofweek</span>(qq_t)<br>qq_isWeekend = (qq_day == dayofweek.<span class="hljs-property">saturday</span> or qq_day == dayofweek.<span class="hljs-property">sunday</span>)<br><span class="hljs-title function_">barcolor</span>(qq_isWeekend ? color.<span class="hljs-property">gray</span> : na)<br></code></pre></td></tr></table></figure>        </div>      </div>    </div><h2 id="策略">策略</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs js"><br><span class="hljs-comment">//@version=6</span><br><span class="hljs-title function_">indicator</span>(<span class="hljs-string">&quot;大道至简&quot;</span>, overlay=<span class="hljs-literal">false</span>, max_boxes_count = <span class="hljs-number">500</span>)<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">TradingView</span>/ta/<span class="hljs-number">10</span><br><br>[kc_mid, kc_up_1, kc_down_1] = ta.<span class="hljs-title function_">kc</span>(close, <span class="hljs-number">50</span>, <span class="hljs-number">2.75</span>)<br><br>kc_down_1l = <span class="hljs-title function_">plot</span>(kc_down_1, title = <span class="hljs-string">&#x27;kc_down_1&#x27;</span>, color = color.<span class="hljs-title function_">rgb</span>(<span class="hljs-number">105</span>, <span class="hljs-number">214</span>, <span class="hljs-number">72</span>, <span class="hljs-number">35</span>), force_overlay = <span class="hljs-literal">true</span>, linewidth = <span class="hljs-number">2</span>)<br>kc_up_1l = <span class="hljs-title function_">plot</span>(kc_up_1, title = <span class="hljs-string">&#x27;kc_up_1&#x27;</span>, color = color.<span class="hljs-title function_">rgb</span>(<span class="hljs-number">149</span>, <span class="hljs-number">42</span>, <span class="hljs-number">190</span>, <span class="hljs-number">35</span>), force_overlay = <span class="hljs-literal">true</span>, linewidth = <span class="hljs-number">2</span>)<br>kc_midl2 = <span class="hljs-title function_">plot</span>(ta.<span class="hljs-title function_">ema</span>(high, <span class="hljs-number">50</span>), title = <span class="hljs-string">&#x27;kc_mid_h&#x27;</span>, color = color.<span class="hljs-property">blue</span>, force_overlay = <span class="hljs-literal">true</span>, linewidth = <span class="hljs-number">1</span>)<br>kc_midl3 = <span class="hljs-title function_">plot</span>(ta.<span class="hljs-title function_">ema</span>(low, <span class="hljs-number">50</span>), title = <span class="hljs-string">&#x27;kc_mid_l&#x27;</span>, color = color.<span class="hljs-property">blue</span>, force_overlay = <span class="hljs-literal">true</span>, linewidth = <span class="hljs-number">1</span>)<br><br>[kc_mid2, kc_up_2, kc_down_2] = ta.<span class="hljs-title function_">kc</span>(close, <span class="hljs-number">50</span>, <span class="hljs-number">3.75</span>)<br>[kc_mid4, kc_up_14, kc_down_14] = ta.<span class="hljs-title function_">kc</span>(low, <span class="hljs-number">50</span>, <span class="hljs-number">3.75</span>)<br><br>kc_down_2l = <span class="hljs-title function_">plot</span>(kc_down_14, title = <span class="hljs-string">&#x27;kc_down_2&#x27;</span>, color = color.<span class="hljs-title function_">rgb</span>(<span class="hljs-number">105</span>, <span class="hljs-number">214</span>, <span class="hljs-number">72</span>, <span class="hljs-number">35</span>), force_overlay = <span class="hljs-literal">true</span>, linewidth = <span class="hljs-number">2</span>)<br>kc_up_2l = <span class="hljs-title function_">plot</span>(kc_up_2, title = <span class="hljs-string">&#x27;kc_up_2&#x27;</span>, color = color.<span class="hljs-title function_">rgb</span>(<span class="hljs-number">149</span>, <span class="hljs-number">42</span>, <span class="hljs-number">190</span>, <span class="hljs-number">35</span>), force_overlay = <span class="hljs-literal">true</span>, linewidth = <span class="hljs-number">2</span>)<br><br><br><span class="hljs-title function_">fill</span>(kc_up_1l, kc_up_2l, color = color.<span class="hljs-title function_">new</span>(color.<span class="hljs-property">red</span>, <span class="hljs-number">90</span>))<br><span class="hljs-title function_">fill</span>(kc_down_1l, kc_down_2l, color = color.<span class="hljs-title function_">new</span>(color.<span class="hljs-property">lime</span>, <span class="hljs-number">90</span>))<br><span class="hljs-title function_">fill</span>(kc_midl2, kc_midl3, color = color.<span class="hljs-title function_">new</span>(color.<span class="hljs-property">aqua</span>, <span class="hljs-number">90</span>))<br><br><span class="hljs-comment">// Inputs</span><br>float  sourceInput  = input.<span class="hljs-title function_">source</span>(close, <span class="hljs-string">&quot;Source&quot;</span>)<br>int    fastLenInput = input.<span class="hljs-title function_">int</span>(<span class="hljs-number">12</span>, <span class="hljs-string">&quot;Fast length&quot;</span>,   <span class="hljs-number">1</span>)<br>int    slowLenInput = input.<span class="hljs-title function_">int</span>(<span class="hljs-number">26</span>, <span class="hljs-string">&quot;Slow length&quot;</span>,   <span class="hljs-number">1</span>)<br>int    sigLenInput  = input.<span class="hljs-title function_">int</span>(<span class="hljs-number">9</span>,  <span class="hljs-string">&quot;Signal length&quot;</span>, <span class="hljs-number">1</span>)<br><br><span class="hljs-comment">// Calculate and plot the MACD, signal, and histogram values.</span><br>float maFast = ta.<span class="hljs-title function_">ema</span>(sourceInput, fastLenInput)<br>float maSlow = ta.<span class="hljs-title function_">ema</span>(sourceInput, slowLenInput)<br>float macd   = maFast - maSlow<br>float signal = ta.<span class="hljs-title function_">sma</span>(macd, sigLenInput)<br>float hist   = <span class="hljs-number">2</span> * (macd - signal)<br>color hColor = hist &gt;= <span class="hljs-number">0</span> ? hist &gt; hist[<span class="hljs-number">1</span>] ? #26a69a : #b2dfdb : hist &gt; hist[<span class="hljs-number">1</span>] ? #ffcdd2 : #ff5252<br><br><span class="hljs-title function_">hline</span>(<span class="hljs-number">0</span>, <span class="hljs-string">&quot;Zero&quot;</span>, #787b8680)<br><span class="hljs-title function_">plot</span>(hist, <span class="hljs-string">&quot;Histogram&quot;</span>, hColor, style = plot.<span class="hljs-property">style_columns</span>)<br><span class="hljs-title function_">plot</span>(macd, <span class="hljs-string">&quot;MACD&quot;</span>, color = color.<span class="hljs-property">orange</span>)<br><span class="hljs-title function_">plot</span>(signal, <span class="hljs-string">&quot;Signal line&quot;</span>, color.<span class="hljs-property">navy</span>)<br></code></pre></td></tr></table></figure><h2 id="做多规则">做多规则</h2><h3 id="抄底规则">抄底规则</h3><ul><li>合约只能顺势，抄底爆仓风险大，请用现货定投策略</li></ul><h3 id="追涨规则">追涨规则</h3><ul><li>待补充</li></ul><h2 id="做空规则">做空规则</h2><h3 id="摸顶规则">摸顶规则</h3><ul><li>合约只能顺势，摸顶爆仓风险大，请分批出售定投的现货</li></ul><h3 id="杀跌规则">杀跌规则</h3><ul><li>待补充</li></ul><h2 id="交易心理">交易心理</h2><ol><li>快涨慢跌(快跌慢涨)无需止损，快涨快跌(快跌快涨)立即止损</li><li>高位放量无需止损，高位缩量立即止损</li><li>底部单日放量看多不做多</li><li>对手盘：下单时的贪心、扛单时的侥幸、追单时的冲动、踏空时的不甘</li></ol>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/dex/">dex</category>
      
      
      <comments>https://hexo.limour.top/practical-experience-in-perpetual-contract-market#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【绘图】使用Upset图替代韦恩图</title>
      <link>https://hexo.limour.top/replace-venn-diagram-with-upset-diagram</link>
      <guid>https://hexo.limour.top/replace-venn-diagram-with-upset-diagram</guid>
      <pubDate>Sat, 27 Sep 2025 08:40:36 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;配置环境&quot;&gt;配置环境&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/-ji-lu--an-zhuang-sheng-xin-de-dai-ma-bian-xie-huan-jing&quot;&gt;基础编程环境&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;hi</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="配置环境">配置环境</h2><ul><li><a href="/-ji-lu--an-zhuang-sheng-xin-de-dai-ma-bian-xie-huan-jing">基础编程环境</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda create -n complexupset conda-forge::r-tidyverse conda-forge::r-irkernel conda-forge::r-complexupset -y<br>conda run -n complexupset Rscript -e <span class="hljs-string">&quot;IRkernel::installspec(name=&#x27;complexupset&#x27;, displayname=&#x27;r-complexupset&#x27;)&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs R">install.packages<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;ggplot2movies&#x27;</span><span class="hljs-punctuation">)</span> <span class="hljs-comment"># 测试用的数据，可以不安装</span><br></code></pre></td></tr></table></figure><h2 id="使用示例">使用示例</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs R">require<span class="hljs-punctuation">(</span>ComplexUpset<span class="hljs-punctuation">)</span><br>require<span class="hljs-punctuation">(</span>tidyverse<span class="hljs-punctuation">)</span><br>require<span class="hljs-punctuation">(</span>RColorBrewer<span class="hljs-punctuation">)</span><br>options<span class="hljs-punctuation">(</span>repr.plot.width<span class="hljs-operator">=</span><span class="hljs-number">6</span><span class="hljs-punctuation">,</span> repr.plot.height<span class="hljs-operator">=</span><span class="hljs-number">12</span><span class="hljs-punctuation">)</span><br>RColorBrewer<span class="hljs-operator">::</span>display.brewer.all<span class="hljs-punctuation">(</span>type <span class="hljs-operator">=</span> <span class="hljs-string">&quot;all&quot;</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs R">require<span class="hljs-punctuation">(</span>ggplot2movies<span class="hljs-punctuation">)</span><br>movies <span class="hljs-operator">=</span> as.data.frame<span class="hljs-punctuation">(</span>ggplot2movies<span class="hljs-operator">::</span>movies<span class="hljs-punctuation">)</span><br>genres <span class="hljs-operator">&lt;-</span> colnames<span class="hljs-punctuation">(</span>movies<span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-number">18</span><span class="hljs-operator">:</span><span class="hljs-number">24</span><span class="hljs-punctuation">]</span><br>movies<span class="hljs-punctuation">[</span>genres<span class="hljs-punctuation">]</span> <span class="hljs-operator">=</span> <span class="hljs-punctuation">(</span>movies<span class="hljs-punctuation">[</span>genres<span class="hljs-punctuation">]</span> <span class="hljs-operator">==</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><br><span class="hljs-comment"># 仅用子集进行演示</span><br>movies<span class="hljs-punctuation">[</span>movies<span class="hljs-operator">$</span>mpaa <span class="hljs-operator">==</span> <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;mpaa&#x27;</span><span class="hljs-punctuation">]</span> <span class="hljs-operator">=</span> <span class="hljs-literal">NA</span><br>movies <span class="hljs-operator">=</span> na.omit<span class="hljs-punctuation">(</span>movies<span class="hljs-punctuation">)</span><span class="hljs-comment">#删除缺失值</span><br>t<span class="hljs-punctuation">(</span>head<span class="hljs-punctuation">(</span>movies<span class="hljs-punctuation">[</span>genres<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-number">3</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-comment">#倒置前三行进行查看</span><br><br>data <span class="hljs-operator">&lt;-</span> movies<span class="hljs-punctuation">[</span>genres<span class="hljs-punctuation">]</span><br>data  <span class="hljs-operator">%&gt;%</span> head <br><span class="hljs-comment"># 多维二分类变量数据，值为布尔类型，colnames为变量名</span><br><span class="hljs-comment">#   Action Animation Comedy Drama Documentary Romance Short</span><br><span class="hljs-comment"># 1  FALSE     FALSE   TRUE FALSE       FALSE    TRUE FALSE</span><br><span class="hljs-comment"># 2  FALSE     FALSE   TRUE FALSE       FALSE    TRUE FALSE</span><br><span class="hljs-comment"># 3  FALSE     FALSE   TRUE FALSE       FALSE   FALSE FALSE</span><br><span class="hljs-comment"># 4  FALSE     FALSE   TRUE  TRUE       FALSE    TRUE FALSE</span><br><span class="hljs-comment"># 5   TRUE     FALSE  FALSE FALSE       FALSE   FALSE FALSE</span><br><span class="hljs-comment"># 6  FALSE     FALSE  FALSE  TRUE       FALSE   FALSE FALSE</span><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs R">options<span class="hljs-punctuation">(</span>repr.plot.width<span class="hljs-operator">=</span><span class="hljs-number">6</span><span class="hljs-punctuation">,</span> repr.plot.height<span class="hljs-operator">=</span><span class="hljs-number">6</span><span class="hljs-punctuation">)</span><br>upset<span class="hljs-punctuation">(</span><br>    data<span class="hljs-punctuation">,</span> <br>    <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">&quot;Action&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;Comedy&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;Drama&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;Romance&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;genre&#x27;</span><span class="hljs-punctuation">,</span><br>    width_ratio<span class="hljs-operator">=</span><span class="hljs-number">0.1</span><span class="hljs-punctuation">,</span> <br>    height_ratio<span class="hljs-operator">=</span><span class="hljs-number">0.382</span><span class="hljs-punctuation">,</span><br>    min_size<span class="hljs-operator">=</span><span class="hljs-number">10</span><span class="hljs-punctuation">,</span><br>    set_sizes<span class="hljs-operator">=</span><span class="hljs-literal">FALSE</span><span class="hljs-punctuation">,</span><br>    base_annotations<span class="hljs-operator">=</span><span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span><br>        <span class="hljs-string">&quot;Intersection size&quot;</span> <span class="hljs-operator">=</span> intersection_size<span class="hljs-punctuation">(</span><br>            text<span class="hljs-operator">=</span><span class="hljs-built_in">list</span><span class="hljs-punctuation">(</span><br>                hjust <span class="hljs-operator">=</span> <span class="hljs-operator">-</span><span class="hljs-number">0.1</span><span class="hljs-punctuation">,</span><br>                angle <span class="hljs-operator">=</span> <span class="hljs-number">45</span><br>            <span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>            mapping <span class="hljs-operator">=</span> aes<span class="hljs-punctuation">(</span>fill <span class="hljs-operator">=</span> <span class="hljs-string">&quot;bars_color&quot;</span><span class="hljs-punctuation">)</span><br>        <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> scale_fill_manual<span class="hljs-punctuation">(</span><br>            values <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">&quot;bars_color&quot;</span> <span class="hljs-operator">=</span> RColorBrewer<span class="hljs-operator">::</span>brewer.pal<span class="hljs-punctuation">(</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;Set1&#x27;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>            guide <span class="hljs-operator">=</span> <span class="hljs-string">&quot;none&quot;</span><br>        <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> annotate<span class="hljs-punctuation">(</span><br>                geom <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;text&#x27;</span><span class="hljs-punctuation">,</span> <br>                x<span class="hljs-operator">=</span><span class="hljs-literal">Inf</span><span class="hljs-punctuation">,</span> y<span class="hljs-operator">=</span><span class="hljs-literal">Inf</span><span class="hljs-punctuation">,</span><br>                label <span class="hljs-operator">=</span> paste<span class="hljs-punctuation">(</span><span class="hljs-string">&#x27;Total:&#x27;</span><span class="hljs-punctuation">,</span> nrow<span class="hljs-punctuation">(</span>data<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>                vjust<span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span> hjust<span class="hljs-operator">=</span><span class="hljs-number">1</span><br>        <span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme<span class="hljs-punctuation">(</span>panel.grid<span class="hljs-operator">=</span>element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>    <span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    sort_intersections_by <span class="hljs-operator">=</span> <span class="hljs-built_in">c</span><span class="hljs-punctuation">(</span><span class="hljs-string">&quot;cardinality&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;degree&quot;</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    stripes<span class="hljs-operator">=</span>RColorBrewer<span class="hljs-operator">::</span>brewer.pal<span class="hljs-punctuation">(</span><span class="hljs-number">9</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&#x27;Set1&#x27;</span><span class="hljs-punctuation">)</span><br><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><p><img src="https://img.limour.top/2025/09/27/68d7bb2be475e.webp" alt=""></p>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/%E7%BB%98%E5%9B%BE/">绘图</category>
      
      <category domain="https://hexo.limour.top/tags/upset/">Upset</category>
      
      
      <comments>https://hexo.limour.top/replace-venn-diagram-with-upset-diagram#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【绘图】云雨图比较两组的分布差异</title>
      <link>https://hexo.limour.top/distribution-differences-using-raincloud-chart</link>
      <guid>https://hexo.limour.top/distribution-differences-using-raincloud-chart</guid>
      <pubDate>Sat, 27 Sep 2025 05:09:19 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;配置环境&quot;&gt;配置环境&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/-ji-lu--an-zhuang-sheng-xin-de-dai-ma-bian-xie-huan-jing&quot;&gt;基础编程环境&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;hi</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="配置环境">配置环境</h2><ul><li><a href="/-ji-lu--an-zhuang-sheng-xin-de-dai-ma-bian-xie-huan-jing">基础编程环境</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda create -n raincloud conda-forge::r-tidyverse conda-forge::r-irkernel conda-forge::r-gghalves conda-forge::r-ggbeeswarm -y<br><span class="hljs-comment"># conda install -n raincloud conda-forge::r-ggbeeswarm -y</span><br>conda run -n raincloud Rscript -e <span class="hljs-string">&quot;IRkernel::installspec(name=&#x27;raincloud&#x27;, displayname=&#x27;r-raincloud&#x27;)&quot;</span><br></code></pre></td></tr></table></figure><h2 id="使用示例">使用示例</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs R">require<span class="hljs-punctuation">(</span>ggplot2<span class="hljs-punctuation">)</span><br>require<span class="hljs-punctuation">(</span>gghalves<span class="hljs-punctuation">)</span><br>require<span class="hljs-punctuation">(</span>ggbeeswarm<span class="hljs-punctuation">)</span><br>require<span class="hljs-punctuation">(</span>tidyverse<span class="hljs-punctuation">)</span><br>require<span class="hljs-punctuation">(</span>RColorBrewer<span class="hljs-punctuation">)</span><br>options<span class="hljs-punctuation">(</span>repr.plot.width<span class="hljs-operator">=</span><span class="hljs-number">6</span><span class="hljs-punctuation">,</span> repr.plot.height<span class="hljs-operator">=</span><span class="hljs-number">12</span><span class="hljs-punctuation">)</span><br>RColorBrewer<span class="hljs-operator">::</span>display.brewer.all<span class="hljs-punctuation">(</span>type <span class="hljs-operator">=</span> <span class="hljs-string">&quot;all&quot;</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs R">data <span class="hljs-operator">&lt;-</span> iris<br>data  <span class="hljs-operator">%&gt;%</span> head<br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs R">p <span class="hljs-operator">&lt;-</span> ggplot<span class="hljs-punctuation">(</span>data<span class="hljs-punctuation">,</span> aes<span class="hljs-punctuation">(</span><br>    x <span class="hljs-operator">=</span> Species<span class="hljs-punctuation">,</span><br>    y <span class="hljs-operator">=</span> Sepal.Length<span class="hljs-punctuation">,</span><br>    fill <span class="hljs-operator">=</span> Species<span class="hljs-punctuation">,</span><br>    color <span class="hljs-operator">=</span> Species<br><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>p_color <span class="hljs-operator">&lt;-</span> RColorBrewer<span class="hljs-operator">::</span>brewer.pal<span class="hljs-punctuation">(</span><span class="hljs-number">3</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;Dark2&quot;</span><span class="hljs-punctuation">)</span> <br>p <span class="hljs-operator">&lt;-</span> p <span class="hljs-operator">+</span> scale_color_manual<span class="hljs-punctuation">(</span>values<span class="hljs-operator">=</span>rev<span class="hljs-punctuation">(</span>p_color<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> scale_fill_manual<span class="hljs-punctuation">(</span>values<span class="hljs-operator">=</span>rev<span class="hljs-punctuation">(</span>p_color<span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br></code></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs R">p1 <span class="hljs-operator">&lt;-</span> p <span class="hljs-operator">+</span> geom_half_violin<span class="hljs-punctuation">(</span><br>    nudge <span class="hljs-operator">=</span> <span class="hljs-number">0.08</span><span class="hljs-punctuation">,</span> <br>    side <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;R&#x27;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment"># side：显示哪一侧， &quot;I&quot;代表左侧，&quot;R&quot;代表右侧，默认&quot;I&quot;；</span><br>    trim <span class="hljs-operator">=</span> <span class="hljs-built_in">T</span><span class="hljs-punctuation">,</span> <span class="hljs-comment"># trim：小提琴图尾部的数据修整，默认为&quot;T&quot;,表示将尾部修整到数据范围；&quot;F&quot;表示不修剪尾部；</span><br>    alpha <span class="hljs-operator">=</span> <span class="hljs-number">0.9</span><br><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_beeswarm<span class="hljs-punctuation">(</span><br>    aes<span class="hljs-punctuation">(</span>x <span class="hljs-operator">=</span> <span class="hljs-built_in">as.numeric</span><span class="hljs-punctuation">(</span>Species<span class="hljs-punctuation">)</span> <span class="hljs-operator">-</span> <span class="hljs-number">0.08</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">,</span><br>    side <span class="hljs-operator">=</span> <span class="hljs-operator">-</span><span class="hljs-number">1L</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment"># side：显示哪一侧， &quot;-1L&quot;代表左侧，&quot;1L&quot;代表右侧；</span><br>    size <span class="hljs-operator">=</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span> shape <span class="hljs-operator">=</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span> alpha <span class="hljs-operator">=</span> <span class="hljs-number">0.8</span><br><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> geom_boxplot<span class="hljs-punctuation">(</span><br>    outlier.shape <span class="hljs-operator">=</span> <span class="hljs-literal">NA</span><span class="hljs-punctuation">,</span> <span class="hljs-comment"># 隐藏离群点；</span><br>    width <span class="hljs-operator">=</span> <span class="hljs-number">0.1</span><span class="hljs-punctuation">,</span><br>    alpha <span class="hljs-operator">=</span> <span class="hljs-number">0.5</span><br><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> coord_flip<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme_bw<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-operator">+</span> theme<span class="hljs-punctuation">(</span>panel.grid<span class="hljs-operator">=</span>element_blank<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">)</span><br>options<span class="hljs-punctuation">(</span>repr.plot.width<span class="hljs-operator">=</span><span class="hljs-number">12</span><span class="hljs-punctuation">,</span> repr.plot.height<span class="hljs-operator">=</span><span class="hljs-number">9</span><span class="hljs-punctuation">)</span><br>p1<br></code></pre></td></tr></table></figure><p><img src="https://img.limour.top/2025/09/27/68d78281b0a1b.webp" alt=""></p>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/raincloud/">raincloud</category>
      
      <category domain="https://hexo.limour.top/tags/%E7%BB%98%E5%9B%BE/">绘图</category>
      
      
      <comments>https://hexo.limour.top/distribution-differences-using-raincloud-chart#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【记录】安装 Win11 IoT LTSC</title>
      <link>https://hexo.limour.top/install-win11-iot-ltsc</link>
      <guid>https://hexo.limour.top/install-win11-iot-ltsc</guid>
      <pubDate>Sun, 08 Jun 2025 03:52:51 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&lt;code&gt;Windows IoT LTSC&lt;/code&gt;版本十年支持，对硬件无限制，对 TPM 没有强制要求，适用于工业自动化系统、医疗仪器等固定用途执行关键业务功能的设备。&lt;/p&gt;
&lt;h2 id=&quot;下载&quot;&gt;下载&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https:</description>
        
      
      
      
      <content:encoded><![CDATA[<p><code>Windows IoT LTSC</code>版本十年支持，对硬件无限制，对 TPM 没有强制要求，适用于工业自动化系统、医疗仪器等固定用途执行关键业务功能的设备。</p><h2 id="下载">下载</h2><ul><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9hcmNoaXZlLm9yZy9kZXRhaWxzL3RpbnktMTEtaW90LWx0c2M=" rel="noopener external nofollow noreferrer">tiny-11-iot-ltsc</a></li><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly93d3cudm13YXJlLmNvbS9wcm9kdWN0cy9kZXNrdG9wLWh5cGVydmlzb3Ivd29ya3N0YXRpb24tYW5kLWZ1c2lvbg==" rel="noopener external nofollow noreferrer">VMware</a></li></ul><h2 id="安装">安装</h2><ul><li>新建一个空白虚拟机，类型选 <code>Win10</code>，这样不用选 TPM</li><li>ios镜像路径选下载好的 <code>tiny-11-iot-ltsc.iso</code>，断网完成安装</li><li>完成后，ios镜像路径更换为VMware安装目录下对应的<code>.iso</code></li><li>启动系统后点击 <code>虚拟机-更新 VMware tools</code></li></ul><h2 id="精简空间">精简空间</h2><ul><li>删除保留的储存空间 <code>dism.exe /online /set-reservedstoragestate /state:disabled</code></li><li>删除休眠文件 <code>powercfg -h off</code></li><li>关闭虚拟内存</li><li>关机，压缩磁盘，进行快照</li></ul><h2 id="关闭防火墙和实时保护">关闭防火墙和实时保护</h2><ul><li>win+r <code>gpedit.msc</code></li><li><code>计算机配置-&gt;管理模板-&gt;Windows组件-&gt;Microsoft Defender防病毒</code></li><li>在右侧窗格中双击 <code>关闭Microsoft Defender防病毒选项</code></li><li><code>Windows组件-&gt;Microsoft Defender防病毒-&gt;实时保护</code></li><li>在右侧窗格中双击 <code>关闭实时保护</code></li><li><code>设置-&gt;安全中心-&gt;防火墙网络保护</code>，关闭域、专用、公用三项防火墙</li><li>关机，进行快照</li></ul><h2 id="关闭加密">关闭加密</h2><ul><li>管理员运行 <code>manage-bde -status</code>，确认完全解密</li></ul><h2 id="激活-可选">激活(可选)</h2><ul><li><code>irm https://get.activated.win | iex</code></li></ul><h2 id="锚定时间-可选">锚定时间(可选)</h2><ul><li>修改<code>虚拟机设置-选项-VMware Tools</code>关闭时间同步</li><li>修改 <code>.vmx</code> 文件，按下面的配置锚定时间</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vmx">tools.syncTime = &quot;FALSE&quot;<br>time.synchronize.continue = &quot;FALSE&quot;<br>time.synchronize.restore = &quot;FALSE&quot;<br>time.synchronize.resume.disk = &quot;FALSE&quot;<br>time.synchronize.shrink = &quot;FALSE&quot;<br>time.synchronize.tools.startup = &quot;FALSE&quot;<br>rtc.startTime = 1733011200 <br></code></pre></td></tr></table></figure><h2 id="驱动-可选">驱动(可选)</h2><ul><li>对系统进行快照</li><li>驱动大师更新全部驱动，备份驱动到U盘</li><li><code>dism /online /export-driver /destination:D:\Drivers</code></li><li>还原到上一次快照</li><li>在设备管理器里安装离线的驱动</li></ul>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/win/">win</category>
      
      
      <comments>https://hexo.limour.top/install-win11-iot-ltsc#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【记录】ServiceWorker实现前端资源高可用</title>
      <link>https://hexo.limour.top/service-worker-resource-high-availability</link>
      <guid>https://hexo.limour.top/service-worker-resource-high-availability</guid>
      <pubDate>Thu, 20 Feb 2025 07:46:29 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;JsDelivr 被墙后博客主题换用了国内的CDN，现在想让博客能根据连通性的不同，自动选择最快的 CDN 服务。搜索了一下，有一个 &lt;a href=&quot;https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL0V0aGVyR</description>
        
      
      
      
      <content:encoded><![CDATA[<p>JsDelivr 被墙后博客主题换用了国内的CDN，现在想让博客能根据连通性的不同，自动选择最快的 CDN 服务。搜索了一下，有一个 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL0V0aGVyRHJlYW0vZnJlZWNkbg==" rel="noopener external nofollow noreferrer">freecdn</a> 项目，使用 Service Worker 来反代 CDN 链接，但写得太复杂了，小博客只想要个简单的，因此依葫芦画瓢，简单改造了一下主题。<br>目前博客首次打开时会自动测试最快返回的 CDN，使用其作为默认的 CDN；这也带来了额外的好处，失效的 CDN 会被自动切换到其他可用的 CDN。相比<a href="https://hexo.limour.top/go/#aHR0cHM6Ly9zb3VsdGVhcnkuY29tLzIwMTkvMDUvMTQvc2ltcGxlLXBvbGljaWVzLW1ha2UtZnJvbnQtZW5kLXJlc291cmNlcy1oaWdobHktYXZhaWxhYmxlLmh0bWw=" rel="noopener external nofollow noreferrer">简单策略让前端资源实现高可用</a>，Service Worker 方案可以透明接入，无需额外修改。</p><h2 id="引入-sw-js">引入 sw.js</h2><ul><li>编辑 HEXO 项目的 <code>/scripts</code> 目录，新建 <code>CDN.js</code>，内容如下</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// freecdn</span><br>hexo.<span class="hljs-property">extend</span>.<span class="hljs-property">injector</span>.<span class="hljs-title function_">register</span>(<span class="hljs-string">&#x27;head_begin&#x27;</span>, <span class="hljs-string">`</span><br><span class="hljs-string">&lt;script&gt;</span><br><span class="hljs-string">const sw = navigator.serviceWorker;</span><br><span class="hljs-string">sw.ready.then(() =&gt; &#123;if(!sw.controller)&#123;location.reload();&#125;&#125;);</span><br><span class="hljs-string">sw.register(&#x27;/sw.js&#x27;, &#123;scope: &#x27;/&#x27;&#125;);</span><br><span class="hljs-string">&lt;/script&gt;</span><br><span class="hljs-string">`</span>);<br></code></pre></td></tr></table></figure><ul><li><code>head_begin</code> 会将 <code>&lt;script&gt;</code> 插入到页面 <code>&lt;head&gt;</code> 后的第一行，确保第一时间加载 <code>sw.js</code></li><li>注意作用域 <code>scope</code>，必须为 <code>/</code>，这个不仅代表请求的地址，也代表发出的请求页面</li><li><code>/sw.js</code> 必须位于 <code>scope</code> 的同级目录，不能是子目录；全站需要开启 <code>https</code></li></ul><h2 id="创建-sw-js">创建 sw.js</h2><ul><li>编辑 HEXO 项目的 <code>/source</code> 目录，新建 <code>sw.js</code>，内容如下</li></ul>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-dcdac752" role="button" aria-expanded="false" aria-controls="collapse-dcdac752">        <div class="fold-arrow">▶</div>点开查看折叠的代码      </div>      <div class="fold-collapse collapse" id="collapse-dcdac752">        <div class="fold-content">          <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> cdn_regex = <span class="hljs-regexp">/.*\/cdn\/(.+?)\//</span>;<br><span class="hljs-keyword">const</span> cdn_list = &#123;<br><span class="hljs-string">&quot;anchor-js&quot;</span>: [<br><span class="hljs-string">&quot;https://cdn1/npm/anchor-js@4.3.1/&quot;</span>,<br><span class="hljs-string">&quot;https://cdn2/npm/anchor-js@4.3.1/&quot;</span>,<br><span class="hljs-string">&quot;https://lib.baomitu.com/anchor-js/5.0.0/&quot;</span>,<br>],<br><span class="hljs-string">&quot;github-markdown-css&quot;</span>: [<br><span class="hljs-string">&quot;https://cdn1/npm/github-markdown-css@4.0.0/&quot;</span>,<br><span class="hljs-string">&quot;https://cdn2/npm/github-markdown-css@4.0.0/&quot;</span>,<br><span class="hljs-string">&quot;https://lib.baomitu.com/github-markdown-css/4.0.0/&quot;</span>,<br>],<br><span class="hljs-string">&quot;jquery&quot;</span>: [<br><span class="hljs-string">&quot;https://cdn1/npm/jquery@3.6.4/dist/&quot;</span>,<br><span class="hljs-string">&quot;https://cdn2/npm/jquery@3.6.4/dist/&quot;</span>,<br><span class="hljs-string">&quot;https://lib.baomitu.com/jquery/3.6.4/&quot;</span>,<br>],<br><span class="hljs-string">&quot;bootstrap&quot;</span>: [<br><span class="hljs-string">&quot;https://cdn1/npm/bootstrap@4.6.1/dist/&quot;</span>,<br><span class="hljs-string">&quot;https://cdn2/npm/bootstrap@4.6.1/dist/&quot;</span>,<br><span class="hljs-string">&quot;https://lib.baomitu.com/twitter-bootstrap/4.6.1/&quot;</span>,<br>],<br><span class="hljs-string">&quot;tocbot&quot;</span>: [<br><span class="hljs-string">&quot;https://cdn1/npm/tocbot@4.20.1/dist/&quot;</span>,<br><span class="hljs-string">&quot;https://cdn2/npm/tocbot@4.20.1/dist/&quot;</span>,<br><span class="hljs-string">&quot;https://lib.baomitu.com/tocbot/4.20.1/&quot;</span>,<br>],<br><span class="hljs-string">&quot;nprogress&quot;</span>: [<br><span class="hljs-string">&quot;https://cdn1/npm/nprogress@0.2.0/&quot;</span>,<br><span class="hljs-string">&quot;https://cdn2/npm/nprogress@0.2.0/&quot;</span>,<br><span class="hljs-string">&quot;https://lib.baomitu.com/nprogress/0.2.0/&quot;</span>,<br>],<br><span class="hljs-string">&quot;katex&quot;</span>: [<br><span class="hljs-string">&quot;https://cdn1/npm/katex@0.16.21/dist/&quot;</span>,<br><span class="hljs-string">&quot;https://cdn2/npm/katex@0.16.21/dist/&quot;</span>,<br><span class="hljs-string">&quot;https://lib.baomitu.com/KaTeX/0.16.2/&quot;</span>,<br>],<br><span class="hljs-string">&quot;clipboard-js&quot;</span>: [<br><span class="hljs-string">&quot;https://cdn1/npm/clipboard-js@0.3.6/&quot;</span>,<br><span class="hljs-string">&quot;https://cdn2/npm/clipboard-js@0.3.6/&quot;</span>,<br><span class="hljs-string">&quot;https://lib.baomitu.com/clipboard.js/2.0.11/&quot;</span>,<br>],<br><span class="hljs-string">&quot;hint.css&quot;</span>: [<br><span class="hljs-string">&quot;https://cdn1/npm/hint.css@2.7.0/&quot;</span>,<br><span class="hljs-string">&quot;https://cdn2/npm/hint.css@2.7.0/&quot;</span>,<br><span class="hljs-string">&quot;https://lib.baomitu.com/hint.css/2.7.0/&quot;</span>,<br>]<br>&#125;;<br><span class="hljs-keyword">const</span> cdn_index = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getFastestUrl</span>(<span class="hljs-params">urls</span>) &#123;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">testUrl</span> = (<span class="hljs-params">one</span>) =&gt; &#123;<br><span class="hljs-keyword">const</span> url = one[<span class="hljs-number">0</span>];<br><span class="hljs-keyword">const</span> id = one[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">const</span> startTime = performance.<span class="hljs-title function_">now</span>();<br><span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(url, &#123;<span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-attr">cache</span>: <span class="hljs-string">&#x27;no-cache&#x27;</span>&#125;)<br>.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> &#123;<br><span class="hljs-keyword">return</span> &#123;url, id, <span class="hljs-attr">time</span>: performance.<span class="hljs-title function_">now</span>() - startTime&#125;;<br>&#125;)<br>.<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">() =&gt;</span> &#123;&#125;));<br>&#125;<br><span class="hljs-keyword">const</span> promises = urls.<span class="hljs-title function_">map</span>(testUrl);<br><span class="hljs-keyword">const</span> fastest = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>(promises);<br><span class="hljs-keyword">return</span> fastest;<br>&#125;<br><span class="hljs-keyword">const</span> urls = [<br>[<span class="hljs-string">&#x27;https://cdn2/npm/anchor-js@4.3.1/anchor.min.js&#x27;</span>, <span class="hljs-number">1</span>],<br>[<span class="hljs-string">&#x27;https://cdn1/npm/anchor-js@4.3.1/anchor.min.js&#x27;</span>, <span class="hljs-number">0</span>],<br>[<span class="hljs-string">&#x27;https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js&#x27;</span>, <span class="hljs-number">2</span>]<br>];<br>    <span class="hljs-title function_">getFastestUrl</span>(urls).<span class="hljs-title function_">then</span>( <span class="hljs-function">(<span class="hljs-params">fastest</span>) =&gt;</span> &#123;<br>        caches.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;freecdn.limour&#x27;</span>).<span class="hljs-title function_">then</span>( <span class="hljs-function">(<span class="hljs-params">cache</span>) =&gt;</span> &#123;<br>            <span class="hljs-title function_">resolve</span>(fastest.<span class="hljs-property">id</span>);<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;最快的 URL:&#x27;</span>, fastest);<br>        &#125;);<br>    &#125;);<br>&#125;);<br><br>oninstall = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;self.<span class="hljs-title function_">skipWaiting</span>();&#125;;<br><br>onactivate = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>e.<span class="hljs-title function_">waitUntil</span>(clients.<span class="hljs-title function_">claim</span>());<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cdn_list);<br>&#125;;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">cdn_redirect</span>(<span class="hljs-params">url, resolve</span>) &#123;<br><span class="hljs-keyword">const</span> key = url.<span class="hljs-property">pathname</span>.<span class="hljs-title function_">match</span>(cdn_regex)[<span class="hljs-number">1</span>];<br><span class="hljs-keyword">const</span> newUrl = url.<span class="hljs-property">href</span>.<span class="hljs-title function_">replace</span>(cdn_regex, cdn_list[key][<span class="hljs-keyword">await</span> cdn_index]);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(newUrl);<br><span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">Response</span>.<span class="hljs-title function_">redirect</span>(newUrl, <span class="hljs-number">301</span>));<br>&#125;<br><br>onfetch = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(e.<span class="hljs-property">request</span>.<span class="hljs-property">url</span>);<br>    <span class="hljs-keyword">if</span> (cdn_regex.<span class="hljs-title function_">test</span>(url.<span class="hljs-property">pathname</span>)) &#123;<br>        e.<span class="hljs-title function_">respondWith</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>( <span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>            <span class="hljs-title function_">cdn_redirect</span>(url, resolve)<br>        &#125;<br>        ))<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>        </div>      </div>    </div><ul><li>请将 <code>cdn1</code> 和 <code>cdn2</code> 替换为合适的 CDN，比如 <code>fastly.jsdelivr.net</code> 或 <code>gcore.jsdelivr.net</code></li></ul><h2 id="修改博客资源地址">修改博客资源地址</h2><ul><li>修改 <code>_config.fluid.yml</code> 中的 <code>static_prefix</code></li><li>将资源地址改为 <code>/cdn/&lt;key&gt;/</code></li></ul><h2 id="更新博客">更新博客</h2><ul><li>完成以上操作后，正常生成并部署博客。</li></ul><h2 id="附加-butterfly-主题">附加 butterfly 主题</h2><ul><li>引入 <code>sw.js</code> 不变</li><li><code>sw.js</code> 修改 <code>cdn_list</code> 如下</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> cdn_list = &#123;<br><span class="hljs-string">&quot;custom&quot;</span>: [<br><span class="hljs-string">&quot;https://s4.zstatic.net/ajax/libs/&quot;</span>,<br><span class="hljs-string">&quot;https://cdnjs.cloudflare.com/ajax/libs/&quot;</span>,<br><span class="hljs-string">&quot;https://lib.baomitu.com/&quot;</span>,<br><span class="hljs-string">&quot;https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/&quot;</span>,<br>],<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>sw.js</code> 修改 <code>urls</code> 如下</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> urls = [<br>[<span class="hljs-string">&#x27;https://s4.zstatic.net/ajax/libs/anchor-js/5.0.0/anchor.min.js&#x27;</span>, <span class="hljs-number">0</span>],<br>[<span class="hljs-string">&#x27;https://cdnjs.cloudflare.com/ajax/libs/anchor-js/5.0.0/anchor.min.js&#x27;</span>, <span class="hljs-number">1</span>],<br>[<span class="hljs-string">&#x27;https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js&#x27;</span>, <span class="hljs-number">2</span>],<br>[<span class="hljs-string">&#x27;https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/anchor-js/5.0.0/anchor.min.js&#x27;</span>, <span class="hljs-number">3</span>]<br>];<br></code></pre></td></tr></table></figure><ul><li>修改 butterfly 的配置文件</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">CDN:</span><br>  <span class="hljs-attr">internal_provider:</span> <span class="hljs-string">local</span><br>  <span class="hljs-attr">third_party_provider:</span> <span class="hljs-string">custom</span><br>  <span class="hljs-attr">version:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">custom_format:</span> <span class="hljs-string">/cdn/custom/$&#123;cdnjs_name&#125;/$&#123;version&#125;/$&#123;min_cdnjs_file&#125;</span><br></code></pre></td></tr></table></figure>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/hexo/">hexo</category>
      
      
      <comments>https://hexo.limour.top/service-worker-resource-high-availability#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【记录】打包便携版Python</title>
      <link>https://hexo.limour.top/portable-python-package</link>
      <guid>https://hexo.limour.top/portable-python-package</guid>
      <pubDate>Fri, 17 Jan 2025 01:40:21 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;内网电脑是 win7，且不想改变电脑的环境设置，因此打包一个便携版的 Python 来自用。&lt;/p&gt;
&lt;h2 id=&quot;准备文件&quot;&gt;准备文件&lt;/h2&gt;
&lt;p&gt;从 &lt;a href=&quot;https://hexo.limour.top/go/#aHR0cHM6Ly93d3cucHl0</description>
        
      
      
      
      <content:encoded><![CDATA[<p>内网电脑是 win7，且不想改变电脑的环境设置，因此打包一个便携版的 Python 来自用。</p><h2 id="准备文件">准备文件</h2><p>从 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly93d3cucHl0aG9uLm9yZy9kb3dubG9hZHMvcmVsZWFzZS9weXRob24tMzgxMC8=" rel="noopener external nofollow noreferrer">python-3810</a> 下载最后支持 win7 的编译好的文件</p><ul><li>python-3.8.10-amd64.exe</li><li>python-3.8.10-embed-amd64.zip</li></ul><h2 id="KB2533623-更新">KB2533623 更新</h2><ul><li>安装 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly93d3cubWljcm9zb2Z0LmNvbS96aC1jbi9kb3dubG9hZC9kZXRhaWxzLmFzcHg/aWQ9NDc0NDI=" rel="noopener external nofollow noreferrer">KB3063858</a></li><li>重启 win7 虚拟机，再运行 python-3.8.10-amd64.exe</li><li>取消勾选 <code>install launcher</code>， 从 <code>Custmoize installation</code>  继续</li><li>只勾选 <code>pip</code> 和 <code>tcl/tk</code>，取消其他所有勾选，继续</li><li>选一个临时目录A，取消所有勾选，再勾上<code>Precompile standard lib</code>，继续</li></ul><h2 id="pip-安装需要的包">pip 安装需要的包</h2><ul><li>打开目录A的 Scripts 文件夹，地址栏输入 cmd</li><li><code>pip install httpx lxml -i https://mirrors.tuna.tsinghua.edu.cn/pypi/web/simple</code></li><li>安装完成后测试安装的包正常运行</li></ul><h2 id="构造便携版">构造便携版</h2><ul><li>将 <code>Lib/site-packages</code> 移动到目录A内，重命名为 <code>mods</code></li><li>将 <code>Lib/tkinter</code> 移动到 <code>mods</code> 目录内</li><li>将 python-3.8.10-embed-amd64.zip 中的 python38.zip 放到目录A内</li><li>目录A内创建名为 <code>python38._pth</code> 的文本文件，其内容如下</li></ul><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs txt">DLLs<br>python38.zip<br>.<br>site-packages.zip<br>mods<br></code></pre></td></tr></table></figure><ul><li>移除 <code>Lib、libs、include、Scripts、Tools</code> 等文件夹，</li><li>只保留 <code>DLLs</code>、<code>mods</code>、<code>tcl</code> 这三个文件夹，同时创建 <code>site-packages.zip</code> 文件</li><li>进入 <code>mods</code> 文件夹，删除不必须的包，然后将包一个一个移入 <code>site-packages.zip</code></li><li>每移动一个测试安装的包是否正常运行，不能则保留在 <code>mods</code> 文件夹</li><li>直到所有包都测试完毕，此时碎片文件数量达到最优</li></ul><h2 id="测试便携版">测试便携版</h2><ul><li>将目录A打包成 python-3.8.10-amd64.zip</li><li>将虚拟机回滚到初始快照，安装 KB3063858 更新后重启</li><li>解压 python-3.8.10-amd64.zip，测试是否可用</li></ul><h2 id="附加-改用-PyQt-的版本">附加 改用 PyQt 的版本</h2><ul><li><a href="https://od.limour.top/archives/dist/python">PyStand-py38-pyqt5-lite.zip</a></li><li>后续添加包 <code>conda create -n temp conda-forge::python=3.8.10 conda-forge::beautifulsoup4</code></li><li>然后进 <code>%userprofile%\miniconda3\envs\temp\Lib\site-packages</code> 复制对应的包到 <code>mods</code> 目录下</li><li>如果缺失了 <code>api-ms</code> 相关的 DLL，可以去 <code>Python-Win7-X64_httpx.zip</code> 中复制补全</li></ul><h2 id="打包好的成品">打包好的成品</h2><ul><li><a href="https://od.limour.top/archives/dist/python">Python-Win7-X64_httpx.zip</a></li><li>该成品可以在重装后只安装了 KB3063858 一个更新的 Win7 系统中无依赖运行</li><li>同时可以使用 <code>tkinter</code>、<code>httpx</code> 和 <code>lxml</code> 这三个模块和所有python内置的模块</li><li>配合 <a href="https://od.limour.top/archives/dist/chrome">Chrome-Win7-X64.zip</a> 便携版，可以方便内网抓包写小脚本。</li></ul><h2 id="附加-kivy">附加 kivy</h2><ul><li>安卓：<a href="https://od.limour.top/archives/dist/python">launcher-arm64-v8a-debug.apk</a></li><li>Win：<a href="https://od.limour.top/archives/dist/python">launcher-x64-windows.zip</a></li></ul>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/windows/">Windows</category>
      
      
      <comments>https://hexo.limour.top/portable-python-package#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【记录】重装系统后的操作</title>
      <link>https://hexo.limour.top/operation-after-reinstalling-the-system</link>
      <guid>https://hexo.limour.top/operation-after-reinstalling-the-system</guid>
      <pubDate>Mon, 30 Dec 2024 16:54:58 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;用了几年，笔记本系统又该重置了，每次重置后都要做一大堆操作，这里记录一下，方便以后参考。&lt;/p&gt;
&lt;h2 id=&quot;激活系统&quot;&gt;激活系统&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;OpenWrt 开启 KMS 插件&lt;/li&gt;
&lt;li&gt;新系统以管理员权限执行下面的命令&lt;/li&gt;
&lt;/ul&gt;
</description>
        
      
      
      
      <content:encoded><![CDATA[<p>用了几年，笔记本系统又该重置了，每次重置后都要做一大堆操作，这里记录一下，方便以后参考。</p><h2 id="激活系统">激活系统</h2><ul><li>OpenWrt 开启 KMS 插件</li><li>新系统以管理员权限执行下面的命令</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">slmgr /upk<br>slmgr /ipk W269N<span class="hljs-literal">-WFGWX-YVC9B-4J6C9-T83GX</span><br>slmgr /skms <span class="hljs-number">192.168</span>.<span class="hljs-number">88.1</span><br>slmgr /ato<br><span class="hljs-built_in">set-executionpolicy</span> remotesigned<br></code></pre></td></tr></table></figure><ul><li>重复检查 <code>Windows 更新</code> 安装重启，直到不再有新的更新</li></ul><h2 id="系统优化">系统优化</h2><ul><li>关闭虚拟内存：<code>高级系统设置-性能-高级-虚拟内存</code> 修改为无</li><li><a href="./resolve-the-power-consumption-issue-of-windows-laptop-shutdown">解决关机耗电问题</a></li></ul><h2 id="基础软件">基础软件</h2><ul><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL2NsYXNoLXZlcmdlLXJldi9jbGFzaC12ZXJnZS1yZXYvcmVsZWFzZXM=" rel="noopener external nofollow noreferrer">基础上网工具</a></li><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL25vdGVwYWQtcGx1cy1wbHVzL25vdGVwYWQtcGx1cy1wbHVz" rel="noopener external nofollow noreferrer">notepad++</a></li><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9hcHBzLm1pY3Jvc29mdC5jb20vZGV0YWlsLzlwMXd4cGtiNjhreA==" rel="noopener external nofollow noreferrer">Snipaste</a></li><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly93d3cuNy16aXAub3JnLw==" rel="noopener external nofollow noreferrer">7zip</a></li><li>将常用软件的安装目录添加的 <code>Windows 安全中心</code> 的排除项里，以免影响性能</li></ul><h2 id="恢复博客">恢复博客</h2><ul><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXQtc2NtLmNvbS9kb3dubG9hZHMvd2lu" rel="noopener external nofollow noreferrer">git</a></li><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9jb2RlLnZpc3VhbHN0dWRpby5jb20v" rel="noopener external nofollow noreferrer">VS Code</a></li><li><a href="./-ji-lu--an-zhuang-conda-bing-geng-huan-qing-hua-yuan">conda</a></li><li>在 <code>Anaconda Prompt</code> 中执行 <code>conda init</code></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs powershell">git config <span class="hljs-literal">--global</span> user.name <span class="hljs-string">&quot;Limour&quot;</span><br>git config <span class="hljs-literal">--global</span> user.email <span class="hljs-string">&quot;limour@limour.top&quot;</span><br>git clone <span class="hljs-literal">-b</span> main <span class="hljs-literal">--single-branch</span> https://github.com/limour<span class="hljs-literal">-blog</span>/limour<span class="hljs-literal">-blog</span>.github.io.git<br><span class="hljs-comment"># 在 VS Code 中 打开 limour-blog.github.io 文件夹</span><br>conda create <span class="hljs-literal">-n</span> node conda<span class="hljs-literal">-forge</span>::nodejs<br>conda activate node<br>npm config <span class="hljs-built_in">set</span> registry https://registry.npmmirror.com<br>npm i hexo<span class="hljs-literal">-cli</span> <span class="hljs-literal">-g</span><br>npm install<br></code></pre></td></tr></table></figure><ul><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9pbWFnZW1hZ2ljay5vcmcvc2NyaXB0L2Rvd25sb2FkLnBocA==" rel="noopener external nofollow noreferrer">imagemagick</a></li><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL0xpbW91ci1kZXYvUXVpY2tlcg==" rel="noopener external nofollow noreferrer">Quicker</a></li></ul><h2 id="安装微信">安装微信</h2><ul><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL3NhbmRib3hpZS1wbHVzL1NhbmRib3hpZS9yZWxlYXNlcw==" rel="noopener external nofollow noreferrer">sandboxie</a>，安装驱动时需要临时关闭实时防护</li><li><code>右键沙盒-沙盒设置-恢复</code> 移除 <code>快速恢复</code> 中的文件夹，关闭 <code>直接恢复</code> 中的启用</li><li><code>沙盒设置-资源访问-文件访问-阻止访问</code> 添加沙盒目录和 <code>OneDrive</code> 目录</li><li>下载微信安装包，右键在沙箱中运行，勾上 UAC 管理员权限，安装完毕后登录一次再退出</li><li><code>文件访问-阻止访问</code> 添加 <code>C:\Sandbox\</code> 目录</li><li><code>配置-系统设置-添加快捷方式图标</code> 勾上 UAC ，在程序里选择微信，此后可以从桌面的快捷方式启动沙盒内的微信</li><li><code>文件访问-只写访问</code> 添加 <code>%AppData%\</code> 和 <code>%Local AppData%\</code> 目录</li><li><code>沙盒设置-限制-降低权限</code> 勾上 <code>降低管理员和超级用户组的权限</code></li></ul><h2 id="笔记管理">笔记管理</h2><ul><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL3N1bWF0cmFwZGZyZWFkZXIvc3VtYXRyYXBkZi9yZWxlYXNlcw==" rel="noopener external nofollow noreferrer">sumatrapdf</a></li><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly93d3cuem90ZXJvLm9yZy8=" rel="noopener external nofollow noreferrer">zotero</a></li><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL2wwbzAvdGFyYQ==" rel="noopener external nofollow noreferrer">Tara</a> 插件，导入之前导出的备份</li></ul><h2 id="恢复虚拟机">恢复虚拟机</h2><ul><li>去博通官网下载 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly93d3cudm13YXJlLmNvbS9wcm9kdWN0cy9kZXNrdG9wLWh5cGVydmlzb3Ivd29ya3N0YXRpb24tYW5kLWZ1c2lvbg==" rel="noopener external nofollow noreferrer">VMware</a></li><li>直接恢复之前备份的整个虚拟机，之后所有操作都靠虚拟机快照进行，摆脱重装烦恼</li></ul>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/win/">win</category>
      
      
      <comments>https://hexo.limour.top/operation-after-reinstalling-the-system#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【记录】将旧手机变成云手机</title>
      <link>https://hexo.limour.top/convert-old-phone-to-cloud-phone</link>
      <guid>https://hexo.limour.top/convert-old-phone-to-cloud-phone</guid>
      <pubDate>Wed, 25 Dec 2024 13:04:41 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;准备工作&quot;&gt;准备工作&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;./force-enable-adb-wireless-debugging&quot;&gt;ADB 调试&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;scrcpy-方案&quot;&gt;scrcpy 方案&lt;/h2&gt;
&lt;ul</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="准备工作">准备工作</h2><ul><li><a href="./force-enable-adb-wireless-debugging">ADB 调试</a></li></ul><h2 id="scrcpy-方案">scrcpy 方案</h2><ul><li>下载 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL0dlbnltb2JpbGUvc2NyY3B5L3JlbGVhc2Vz" rel="noopener external nofollow noreferrer">scrcpy</a></li><li>也可以<a href="./WebSocket-based-intranet-penetration-tool">内网穿透</a>，那么修改下面的 IP 和端口为穿透后的 IP 和端口</li><li>使用 <code>scrcpy</code> 目录下的 adb 执行 <code>.\adb.exe connect 192.168.110.105:35555</code></li><li>执行 <code>.\scrcpy.exe --new-display --no-vd-destroy-content</code></li></ul><p><img src="https://img.limour.top/2024/12/25/676c0984bff5f.webp" alt=""></p><ul><li>修改 <code>scrcpy-console.bat</code> 如下，则可关闭物理屏幕</li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmd">@<span class="hljs-built_in">echo</span> off<br>scrcpy --turn-screen-off --new-display --no-vd-destroy-content --<span class="hljs-built_in">pause</span>-on-<span class="hljs-keyword">exit</span>=<span class="hljs-keyword">if</span>-error %*<br></code></pre></td></tr></table></figure><h3 id="私密远程访问">私密远程访问</h3><ul><li><a href="./-ji-lu--an-zhuang-npsfrp-fu-wu-duan-yu-ke-hu-duan">部署 nps 服务端</a></li><li>下载 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL3lpc2llci9ucHMvcmVsZWFzZXM=" rel="noopener external nofollow noreferrer">npc</a></li><li>下载 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL2dvLWdvc3QvZ29zdC9yZWxlYXNlcw==" rel="noopener external nofollow noreferrer">gost</a></li><li>nps 服务端新增客户端，记录 ip 和 vkey</li><li>电脑执行以下命令使手机连接到服务器</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell">adb disconnect<br>adb connect <span class="hljs-number">192.168</span>.<span class="hljs-number">110.50</span>:<span class="hljs-number">35555</span> <span class="hljs-comment"># 手机的内网 ip</span><br><br>adb shell<br>mkdir <span class="hljs-literal">-p</span> /sdcard/npc<br><span class="hljs-built_in">cat</span> &gt; /sdcard/npc/run_npc.sh &lt;&lt;EOF<br><span class="hljs-comment">#!/data/data/com.termux/files/usr/bin/bash</span><br>npc <span class="hljs-literal">-server</span>=&lt;ip&gt;:<span class="hljs-number">8025</span> <span class="hljs-literal">-vkey</span>=&lt;vkey&gt; <span class="hljs-literal">-tls_enable</span>=true<br>EOF<br><br>adb push <span class="hljs-string">&quot;G:\apk\work\npc&quot;</span> /sdcard/npc<br></code></pre></td></tr></table></figure><ul><li>手机 Termux 执行以下命令启动客户端</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mv</span> storage/shared/npc/npc /data/data/com.termux/files/usr/bin/<br><span class="hljs-built_in">chmod</span> +x /data/data/com.termux/files/usr/bin/npc<br><span class="hljs-built_in">mv</span> storage/shared/npc/run_npc.sh .  <span class="hljs-comment"># 有个点，表示当前目录</span><br><span class="hljs-built_in">chmod</span> +x run_npc.sh<br>./run_npc.sh<br></code></pre></td></tr></table></figure><ul><li>nps 服务端新增TCP隧道，记录端口，比如 <code>40992</code></li><li>电脑执行以下命令建立测试用私密连接</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">.\gost.exe <span class="hljs-literal">-L</span>=<span class="hljs-string">&quot;tcp://:3554/nps:40992&quot;</span> <span class="hljs-operator">-F</span>=<span class="hljs-string">&quot;ss://chacha20-ietf-poly1305:password@nps.blog.com:8337&quot;</span><br></code></pre></td></tr></table></figure><ul><li>电脑执行以下命令连接手机</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">adb disconnect<br>adb connect <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">3554</span><br>adb devices<br></code></pre></td></tr></table></figure><ul><li>确认成功，则关闭测试用私密连接</li><li>修改 <code>scrcpy-console.bat</code> 如下</li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cmd">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-built_in">start</span> &quot;scrcpy-gost&quot; <span class="hljs-built_in">cmd</span> /c gost -L=&quot;tcp://:<span class="hljs-number">3554</span>/nps:<span class="hljs-number">40992</span>&quot; -F=&quot;ss://chacha20-ietf-poly1305:password@nps.blog.com:<span class="hljs-number">8337</span>&quot;<br>timeout /t <span class="hljs-number">3</span> /nobreak &gt;<span class="hljs-built_in">nul</span><br>adb disconnect<br>adb connect <span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">3554</span><br>scrcpy -Sw -m <span class="hljs-number">1024</span> -b <span class="hljs-number">3</span>M --max-fps=<span class="hljs-number">6</span> --<span class="hljs-built_in">pause</span>-on-<span class="hljs-keyword">exit</span>=<span class="hljs-keyword">if</span>-error %*<br></code></pre></td></tr></table></figure><h3 id="安卓访问">安卓访问</h3><ul><li>主力手机安装 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9odWdnaW5nZmFjZS5jby9kYXRhc2V0cy9MaW1vdXIvYXJjaHZpZS9ibG9iL21haW4vc2NyY3B5LWFuZHJvaWQuYXBr" rel="noopener external nofollow noreferrer">scrcpy-android</a></li><li>下载 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL0xpbW91ci1kZXYvRGlzcGxheVRvZ2dsZS9yZWxlYXNlcw==" rel="noopener external nofollow noreferrer">DisplayToggle.dex</a></li><li>电脑执行以下命令测试前台熄屏功能</li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmd">adb push &quot;C:\Users\limou\Downloads\DisplayToggle.dex&quot; /sdcard/DisplayToggle.dex<br>adb shell CLASSPATH=/sdcard/DisplayToggle.dex app_process / DisplayToggle <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><ul><li>手机 Termux 执行以下命令开启前台熄屏功能</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">cat</span> &gt; /data/data/<span class="hljs-keyword">com</span>.termux/<span class="hljs-keyword">files</span>/usr/bin/<span class="hljs-keyword">display</span>.<span class="hljs-keyword">sh</span> &lt;&lt;EOF<br>#!/data/data/<span class="hljs-keyword">com</span>.termux/<span class="hljs-keyword">files</span>/usr/bin/bash<br>rish -<span class="hljs-keyword">c</span> <span class="hljs-string">&quot;CLASSPATH=/sdcard/DisplayToggle.dex app_process / DisplayToggle 0&quot;</span><br>EOF<br>chmod +<span class="hljs-keyword">x</span> /data/data/<span class="hljs-keyword">com</span>.termux/<span class="hljs-keyword">files</span>/usr/bin/<span class="hljs-keyword">display</span>.<span class="hljs-keyword">sh</span><br><span class="hljs-keyword">display</span>.<span class="hljs-keyword">sh</span><br></code></pre></td></tr></table></figure><ul><li>之后主力手机通过 scrcpy-android 连接到旧手机后，termux 执行 <code>display.sh</code> 即可熄屏</li></ul><h2 id="Droidvnc-方案">Droidvnc 方案</h2><ul><li>下载 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL2JrMTM4L2Ryb2lkVk5DLU5HL3JlbGVhc2Vz" rel="noopener external nofollow noreferrer">droidvnc-ng</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">adb install -t <span class="hljs-string">&#x27;droidvnc-ng-2.8.0.apk&#x27;</span><br></code></pre></td></tr></table></figure><ul><li>关闭 <code>droidvnc-ng</code> 电池优化，并在自启动里手动管理允许所有启动方式</li><li><code>PackageViewer</code> 获取 <code>droidvnc-ng</code> 的包名为 <code>net.christianbeier.droidvnc_ng</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看 droidvnc_ng 的所有服务，自行判断哪个是无障碍服务</span><br><span class="hljs-comment"># 比如 `net.christianbeier.droidvnc_ng/.InputService`</span><br><span class="hljs-comment"># 一般是有 `android.permission.BIND_ACCESSIBILITY_SERVICE` 权限的那个</span><br>adb shell dumpsys activity services net.christianbeier.droidvnc_ng<br><span class="hljs-comment"># 或者手动开启一次无障碍服务，然后直接找到对应的服务</span><br><span class="hljs-comment"># 比如 `net.christianbeier.droidvnc_ng/net.christianbeier.droidvnc_ng.InputService`</span><br>adb shell settings get secure enabled_accessibility_services<br><span class="hljs-comment"># 执行下面的命令进行保活</span><br>adb shell pm grant net.christianbeier.droidvnc_ng/net.christianbeier.droidvnc_ng.InputService android.permission.BIND_ACCESSIBILITY_SERVICE<br>adb shell pm grant net.christianbeier.droidvnc_ng/net.christianbeier.droidvnc_ng.InputService android.permission.WRITE_SECURE_SETTINGS<br>adb shell settings put secure enabled_accessibility_services net.christianbeier.droidvnc_ng/net.christianbeier.droidvnc_ng.InputService<br><span class="hljs-comment"># 验证无障碍服务打开情况</span><br>adb shell settings get secure enabled_accessibility_services<br></code></pre></td></tr></table></figure><ul><li>浏览器访问 <code>http://192.168.110.105:5800/vnc.html?autoconnect=true&amp;autoscale=1&amp;show_dot=true&amp;port=5900</code> 即可</li><li>内网穿透后可远程使用</li></ul><h2 id="附加-变NAS">附加 变NAS</h2><ul><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL2ppbmczMzIvQUxpc3RGbHV0dGVyL3JlbGVhc2Vz" rel="noopener external nofollow noreferrer">AListFlutter</a></li><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL2RldmdpYW5sdS9BcmlhMkFuZHJvaWQvcmVsZWFzZXM=" rel="noopener external nofollow noreferrer">Aria2Android</a></li><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9wbGF5Lmdvb2dsZS5jb20vc3RvcmUvYXBwcy9kZXRhaWxzP2lkPWNvbS5sb25lbHljYXRnYW1lcy5YcGxvcmU=" rel="noopener external nofollow noreferrer">X-plore</a></li></ul>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/novnc/">novnc</category>
      
      
      <comments>https://hexo.limour.top/convert-old-phone-to-cloud-phone#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【记录】强行开启 ADB 的无线调试功能</title>
      <link>https://hexo.limour.top/force-enable-adb-wireless-debugging</link>
      <guid>https://hexo.limour.top/force-enable-adb-wireless-debugging</guid>
      <pubDate>Wed, 25 Dec 2024 11:44:49 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;某无法 root 的X之光手机阉割了无线调试功能，因此只能曲线救国，尝试通过其他方法开启无线调试功能。&lt;/p&gt;
&lt;h2 id=&quot;准备工作&quot;&gt;准备工作&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;下载 &lt;a href=&quot;https://hexo.limour.top/go/#aHR0cHM6</description>
        
      
      
      
      <content:encoded><![CDATA[<p>某无法 root 的X之光手机阉割了无线调试功能，因此只能曲线救国，尝试通过其他方法开启无线调试功能。</p><h2 id="准备工作">准备工作</h2><ul><li>下载 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vdG9vbHMvcmVsZWFzZXMvcGxhdGZvcm0tdG9vbHM=" rel="noopener external nofollow noreferrer">ADB</a></li><li>下载 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL1Jpa2thQXBwcy9TaGl6dWt1L3JlbGVhc2Vz" rel="noopener external nofollow noreferrer">Shizuku</a></li><li>下载 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL3Rlcm11eC90ZXJtdXgtYXBw" rel="noopener external nofollow noreferrer">Termux</a></li><li>下载 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL01hWWlGZWkxOTk1L1BhY2thZ2VWaWV3ZXIvcmVsZWFzZXM=" rel="noopener external nofollow noreferrer">PackageViewer</a></li></ul><h2 id="安装-Shizuku">安装 Shizuku</h2><ul><li>开启 USB 调试，并允许仅充电时调试</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">adb devices<br>.\adb.exe install <span class="hljs-literal">-t</span> <span class="hljs-string">&#x27;.\termux.apk&#x27;</span><br>.\adb.exe install <span class="hljs-literal">-t</span> <span class="hljs-string">&#x27;.\shizuku.apk&#x27;</span><br>.\adb.exe install <span class="hljs-literal">-t</span> <span class="hljs-string">&#x27;.\packageviewer.apk&#x27;</span><br><br>adb shell<br>sh /storage/emulated/<span class="hljs-number">0</span>/Android/<span class="hljs-keyword">data</span>/moe.shizuku.privileged.api/start.sh<br></code></pre></td></tr></table></figure><ul><li>关闭 <code>termux</code> 和 <code>Shizuku</code> 的电池优化，并在自启动里手动管理允许所有启动方式</li><li>在 <code>Shizuku-在终端应用中使用Shizuku</code> 中导出 <code>rish</code> 文件到 <code>termux</code></li><li>在  <code>termux</code> 中运行下列命令</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">pkg up <br>pkg install nmap android-tools<br>termux-setup-storage<br>termux-wake-lock<br><br>sed -i <span class="hljs-string">&#x27;s/ID=&quot;PKG&quot;/ID=&quot;com.termux&quot;/&#x27;</span> rish<br><span class="hljs-built_in">chmod</span> +x rish<br><span class="hljs-built_in">mv</span> rish ~/../usr/bin/<br><span class="hljs-built_in">mv</span> rish_shizuku.dex ~/../usr/bin/<br></code></pre></td></tr></table></figure><ul><li>在 <code>termux</code> 中运行 <code>rish</code> 进入<code>adb shell</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs adb">pm grant com.termux android.permission.WRITE_SECURE_SETTINGS<br></code></pre></td></tr></table></figure><h2 id="开启无线调试">开启无线调试</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs adb">getprop service.adb.tcp.port<br># 为空说明没有开启无线调试<br>setprop service.adb.tcp.port 35555<br># 开启无线调试到 tcp 35555 端口<br></code></pre></td></tr></table></figure><ul><li>此时并没有生效，去开发者里关闭ADB并重新打开</li><li>然后会发现 <code>Shizuku</code> 的 ADB 掉了，但是没有关系</li><li>重新到 <code>Shizuku</code> 界面会发现多了一个通过无线调试启动的选项</li><li>点击启动，然后允许调试即可恢复 <code>Shizuku</code> 的 ADB</li></ul><h2 id="后台保活">后台保活</h2><ul><li>需要安卓版本为 12 12L 13 之一</li><li>将下面的脚本保存为 <code>AcBat.sh</code>，放到 <code>Download</code> 目录</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment">#!sh</span><br><br><span class="hljs-comment"># 定义颜色</span><br>RED=<span class="hljs-string">&#x27;\033[31m&#x27;</span><br>GREEN=<span class="hljs-string">&#x27;\033[32m&#x27;</span><br>YELLOW=<span class="hljs-string">&#x27;\033[33m&#x27;</span><br>BLUE=<span class="hljs-string">&#x27;\033[34m&#x27;</span><br>NC=<span class="hljs-string">&#x27;\033[0m&#x27;</span> <span class="hljs-comment"># No Color</span><br><br><span class="hljs-comment"># 检测 Android 版本</span><br><span class="hljs-function"><span class="hljs-title">get_android_version</span></span>() &#123;<br>  <span class="hljs-built_in">local</span> version=$(getprop ro.build.version.release)<br>  <span class="hljs-built_in">echo</span> <span class="hljs-variable">$version</span><br>&#125;<br><br><span class="hljs-comment"># 检测是否有 GMS</span><br><span class="hljs-function"><span class="hljs-title">has_gms</span></span>() &#123;<br>  <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;[ -d &quot;/system/priv-app/GoogleServicesFramework&quot; ] || [ -d &quot;/system/app/GoogleServicesFramework&quot; ]&#x27;</span>; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">return</span> 0<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">return</span> 1<br>  <span class="hljs-keyword">fi</span><br>&#125;<br><br><span class="hljs-comment"># 激活函数</span><br><span class="hljs-function"><span class="hljs-title">activate</span></span>() &#123;<br>  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;GREEN&#125;</span>激活中...<span class="hljs-variable">$&#123;NC&#125;</span>&quot;</span><br>  <span class="hljs-built_in">local</span> android_version=$(get_android_version)<br>  <br>  <span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$android_version</span>&quot;</span> == <span class="hljs-string">&quot;12L&quot;</span> ]] || [[ <span class="hljs-string">&quot;<span class="hljs-variable">$android_version</span>&quot;</span> == <span class="hljs-string">&quot;13&quot;</span> ]]; <span class="hljs-keyword">then</span><br>    settings put global settings_enable_monitor_phantom_procs <span class="hljs-literal">false</span><br>  <span class="hljs-keyword">elif</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$android_version</span>&quot;</span> == <span class="hljs-string">&quot;12&quot;</span> ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">if</span> has_gms; <span class="hljs-keyword">then</span><br>      device_config set_sync_disabled_for_tests persistent<br>      device_config put activity_manager max_phantom_processes 2147483647<br>    <span class="hljs-keyword">else</span><br>      device_config put activity_manager max_phantom_processes 2147483647<br>    <span class="hljs-keyword">fi</span><br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;RED&#125;</span>不支持的 Android 版本: $android_version<span class="hljs-variable">$&#123;NC&#125;</span>&quot;</span><br>    <span class="hljs-built_in">return</span><br>  <span class="hljs-keyword">fi</span><br>  <br>  <span class="hljs-built_in">sleep</span> 1  <span class="hljs-comment"># 等待设置生效</span><br>  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;GREEN&#125;</span>激活成功。<span class="hljs-variable">$&#123;NC&#125;</span>&quot;</span><br>&#125;<br><br><span class="hljs-comment"># 取消激活函数</span><br><span class="hljs-function"><span class="hljs-title">deactivate</span></span>() &#123;<br>  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;RED&#125;</span>取消激活中...<span class="hljs-variable">$&#123;NC&#125;</span>&quot;</span><br>  <span class="hljs-built_in">local</span> android_version=$(get_android_version)<br>  <br>  <span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$android_version</span>&quot;</span> == <span class="hljs-string">&quot;12L&quot;</span> ]] || [[ <span class="hljs-string">&quot;<span class="hljs-variable">$android_version</span>&quot;</span> == <span class="hljs-string">&quot;13&quot;</span> ]]; <span class="hljs-keyword">then</span><br>    settings delete global settings_enable_monitor_phantom_procs<br>  <span class="hljs-keyword">elif</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$android_version</span>&quot;</span> == <span class="hljs-string">&quot;12&quot;</span> ]]; <span class="hljs-keyword">then</span><br>    device_config delete activity_manager max_phantom_processes<br>    device_config delete activity_manager set_sync_disabled_for_tests<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;RED&#125;</span>不支持的 Android 版本: $android_version<span class="hljs-variable">$&#123;NC&#125;</span>&quot;</span><br>    <span class="hljs-built_in">return</span><br>  <span class="hljs-keyword">fi</span><br>  <br>  <span class="hljs-built_in">sleep</span> 1  <span class="hljs-comment"># 等待设置生效</span><br>  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;RED&#125;</span>取消激活成功。<span class="hljs-variable">$&#123;NC&#125;</span>&quot;</span><br>&#125;<br><br><span class="hljs-comment"># 查看当前值函数</span><br><span class="hljs-function"><span class="hljs-title">view_values</span></span>() &#123;<br>  <span class="hljs-built_in">local</span> android_version=$(get_android_version)<br>  <br>  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;BLUE&#125;</span>Android 版本: $android_version<span class="hljs-variable">$&#123;NC&#125;</span>&quot;</span><br>  <br>  <span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$android_version</span>&quot;</span> == <span class="hljs-string">&quot;12L&quot;</span> ]] || [[ <span class="hljs-string">&quot;<span class="hljs-variable">$android_version</span>&quot;</span> == <span class="hljs-string">&quot;13&quot;</span> ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;BLUE&#125;</span>settings_enable_monitor_phantom_procs 值：<span class="hljs-variable">$&#123;NC&#125;</span>&quot;</span><br>    settings get global settings_enable_monitor_phantom_procs<br>  <span class="hljs-keyword">elif</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$android_version</span>&quot;</span> == <span class="hljs-string">&quot;12&quot;</span> ]]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;BLUE&#125;</span>max_phantom_processes 值：<span class="hljs-variable">$&#123;NC&#125;</span>&quot;</span><br>    device_config get activity_manager max_phantom_processes<br>    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;BLUE&#125;</span>set_sync_disabled_for_tests 值：<span class="hljs-variable">$&#123;NC&#125;</span>&quot;</span><br>    device_config get activity_manager set_sync_disabled_for_tests<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;RED&#125;</span>不支持的 Android 版本: $android_version<span class="hljs-variable">$&#123;NC&#125;</span>&quot;</span><br>  <span class="hljs-keyword">fi</span><br>&#125;<br><br>view_values<br>activate<br>view_values<br></code></pre></td></tr></table></figure><ul><li>打开 <code>termux</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">adb connect localhost:35555<br><span class="hljs-comment"># 此时跳出允许调试，勾上始终允许，但此命令本身会失败</span><br>adb connect localhost:35555<br><span class="hljs-comment"># 再次执行，即可成功</span><br>adb shell sh sdcard/Download/AcBat.sh<br><span class="hljs-comment"># 即可起到和rish相同的效果</span><br></code></pre></td></tr></table></figure>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/termux/">termux</category>
      
      
      <comments>https://hexo.limour.top/force-enable-adb-wireless-debugging#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【记录】OpenWrt配置QoS规则</title>
      <link>https://hexo.limour.top/openwrt-qos-configuration</link>
      <guid>https://hexo.limour.top/openwrt-qos-configuration</guid>
      <pubDate>Mon, 16 Dec 2024 13:26:24 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;在宿舍环境下，QoS可以帮助优化带宽使用，确保关键应用（如视频通话、在线游戏等）获得足够的带宽支持，减少延迟和卡顿现象。其次，QoS还可以通过限制非关键应用的数据流，防止它们占用过多的带宽资源，从而保障其他重要服务的正常运行。此外，QoS还可以实现公平的带宽分配，避免单一用</description>
        
      
      
      
      <content:encoded><![CDATA[<p>在宿舍环境下，QoS可以帮助优化带宽使用，确保关键应用（如视频通话、在线游戏等）获得足够的带宽支持，减少延迟和卡顿现象。其次，QoS还可以通过限制非关键应用的数据流，防止它们占用过多的带宽资源，从而保障其他重要服务的正常运行。此外，QoS还可以实现公平的带宽分配，避免单一用户过度占用资源，影响其他用户的网络体验。因此，尽管会损失硬件转发性能， OpenWrt 仍然是非常有必要开启 QoS 的。</p><h2 id="更新-kernel">更新 kernel</h2><ul><li>根据版本打开对应的包下载地址：<a href="https://hexo.limour.top/go/#aHR0cHM6Ly9kb3dubG9hZHMuaW1tb3J0YWx3cnQub3JnL3JlbGVhc2VzLzIzLjA1LVNOQVBTSE9UL3RhcmdldHMvaXBxODA3eC9nZW5lcmljL3BhY2thZ2VzLw==" rel="noopener external nofollow noreferrer">ImmortalWrt</a> 和 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9hcmNoaXZlLm9wZW53cnQub3JnL3JlbGVhc2VzLzIzLjA1LjAvdGFyZ2V0cy9pcHE4MDd4L2dlbmVyaWMvcGFja2FnZXMv" rel="noopener external nofollow noreferrer">OpenWrt</a></li><li>找到对应的 kernel 更新包下载，比如 <code>kernel_5.15.171-1-dae069da9eaf18cbc98c1b58b15dc5c9_aarch64_cortex-a53.ipk</code></li><li>OpenWrt 的 <code>系统-软件包-操作-上传软件包</code> 上传更新包并安装</li></ul><h2 id="安装-QoS">安装 QoS</h2><ul><li>OpenWrt 的 <code>系统-软件包-筛选器</code> 搜索并安装 <code>luci-app-qos</code> 和 <code>luci-app-statistics</code></li></ul><h2 id="关闭硬件加速">关闭硬件加速</h2><ul><li>OpenWrt 的 <code>网络-防火墙-常用设置-路由/NAT 分载</code> 关闭 <code>软件流量分载</code> 和 <code>硬件流量分载</code></li><li>OpenWrt 的 <code>网络-接口-全局网络选项</code> 开启 <code>数据包引导</code></li><li>OpenWrt 的 <code>系统-重启</code> 执行重启</li></ul><h2 id="初步配置">初步配置</h2><ul><li>ssh 登录后台执行下面的命令</li><li>其中 <code>85000</code> 和 <code>4000</code> 分别表示下行和上行带宽，一般写真实带宽的 85%</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt; /etc/config/qos &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">config classgroup &#x27;Default&#x27;</span><br><span class="hljs-string">        option classes &#x27;Priority Express Normal Bulk&#x27;</span><br><span class="hljs-string">        option default &#x27;Normal&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">config class &#x27;Priority&#x27;</span><br><span class="hljs-string">        option packetsize &#x27;400&#x27;</span><br><span class="hljs-string">        option avgrate &#x27;10&#x27;</span><br><span class="hljs-string">        option priority &#x27;20&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">config class &#x27;Priority_down&#x27;</span><br><span class="hljs-string">        option packetsize &#x27;1000&#x27;</span><br><span class="hljs-string">        option avgrate &#x27;10&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">config class &#x27;Express&#x27;</span><br><span class="hljs-string">        option packetsize &#x27;1000&#x27;</span><br><span class="hljs-string">        option avgrate &#x27;50&#x27;</span><br><span class="hljs-string">        option priority &#x27;10&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">config class &#x27;Normal&#x27;</span><br><span class="hljs-string">        option packetsize &#x27;1500&#x27;</span><br><span class="hljs-string">        option packetdelay &#x27;100&#x27;</span><br><span class="hljs-string">        option avgrate &#x27;20&#x27;</span><br><span class="hljs-string">        option priority &#x27;5&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">config class &#x27;Normal_down&#x27;</span><br><span class="hljs-string">        option avgrate &#x27;20&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">config class &#x27;Bulk&#x27;</span><br><span class="hljs-string">        option avgrate &#x27;1&#x27;</span><br><span class="hljs-string">        option packetdelay &#x27;200&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">config interface &#x27;wan&#x27;                               </span><br><span class="hljs-string">        option classgroup &#x27;Default&#x27;                  </span><br><span class="hljs-string">        option enabled &#x27;1&#x27;                           </span><br><span class="hljs-string">        option upload &#x27;4000&#x27;                         </span><br><span class="hljs-string">        option download &#x27;85000&#x27; </span><br><span class="hljs-string"></span><br><span class="hljs-string">config interface &#x27;lan&#x27;</span><br><span class="hljs-string">        option enabled &#x27;1&#x27;</span><br><span class="hljs-string">        option classgroup &#x27;Default&#x27;</span><br><span class="hljs-string">        option download &#x27;4000&#x27;</span><br><span class="hljs-string">        option upload &#x27;85000&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">config reclassify</span><br><span class="hljs-string">        option target &#x27;Priority&#x27;</span><br><span class="hljs-string">        option proto &#x27;udp&#x27;</span><br><span class="hljs-string">        option ports &#x27;53&#x27;</span><br><span class="hljs-string">        option comment &#x27;DNS&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">config reclassify</span><br><span class="hljs-string">        option target &#x27;Priority&#x27;</span><br><span class="hljs-string">        option proto &#x27;icmp&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">config classify</span><br><span class="hljs-string">        option target &#x27;Express&#x27;</span><br><span class="hljs-string">        option pktsize &#x27;-500&#x27;</span><br><span class="hljs-string">        option comment &#x27;SDP&#x27;</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><p><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9vbGR3aWtpLmFyY2hpdmUub3BlbndydC5vcmcvZG9jL3VjaS9xb3M=" rel="noopener external nofollow noreferrer">wiki</a>: Another biggie was the exact meaning of each type. Types are necessary for connection tracking. By default, Classify is not run on a connection that had already been assigned a traffic class, so it is the initial connection-tracked classification. Reclassify can override the traffic class per packet, without altering the connection tracking mark. Default is a fall-back for everything that has not been marked by Classify/Reclassify. Rules get processed by type first (Classify gets processed first, then Reclassify and finally Default) and then based on the order in the configuration file (top to bottom).</p><h2 id="深入配置">深入配置</h2><ul><li>OpenWrt 的 <code>状态-实时信息-连接</code> 里 <code>启用DNS查找</code> 后观察游戏所在的目标地址的特征</li><li>OpenWrt 的 <code>网络-QoS-分类规则</code> 里根据特征添加更细节的规则</li></ul><h2 id="观察配置">观察配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /etc/config/qos <br>tc -s qdisc<br>/usr/lib/qos/generate.sh interface wan<br></code></pre></td></tr></table></figure><h2 id="附加-DSCP">附加 DSCP</h2><ul><li>手动给应用打上 DSCP 标记：<a href="./Windows-configuration-QoS-ensures-smooth-network-connectivity-for-important-applications">Windows配置QoS</a></li></ul><h2 id="附加-Wireshark">附加 Wireshark</h2><ul><li>下载 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly93d3cud2lyZXNoYXJrLm9yZy8jZG93bmxvYWRMaW5r" rel="noopener external nofollow noreferrer">Wireshark</a></li><li>安装时勾选上插件里的 <code>Sshdump</code></li><li>OpenWrt 的 <code>系统-软件包-筛选器</code> 搜索并安装 <code>tcpdump</code>（会同时捕获 udp）</li><li>打开 Wireshark，选择 <code>捕获—选项</code>：</li></ul><p><img src="https://img.limour.top/2024/12/20/67646241bc3c8.webp" alt=""></p><ul><li>点击 <code>SSH remote capture</code> 标签的前的图标，对远程抓包的参数进行配置</li></ul><p><img src="https://img.limour.top/2024/12/20/6764628b8bd6f.webp" alt=""></p><ul><li>输入路由器的ip地址和ssh端口号</li></ul><p><img src="https://img.limour.top/2024/12/20/676463c5a6c69.webp" alt=""></p><ul><li>输入路由器用户名和密码</li></ul><p><img src="https://img.limour.top/2024/12/20/676463fbc10a6.webp" alt=""></p><ul><li><code>tcpdump</code> 设置, <code>Remote capture filter</code> 写 <code>not (port 22)</code> 就好, 网卡写 <code>br-lan</code></li></ul><p><img src="https://img.limour.top/2024/12/20/67646455a1173.webp" alt=""></p><ul><li>选择 <code>SSH remote capture</code>，点击 <code>开始</code></li></ul><p><img src="https://img.limour.top/2024/12/20/6764621cb9cca.webp" alt=""></p><ul><li>捕获完成后点左上角的红色方块停止捕获</li></ul><p><img src="https://img.limour.top/2024/12/20/676464cd7938b.webp" alt=""></p>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/qos/">QoS</category>
      
      
      <comments>https://hexo.limour.top/openwrt-qos-configuration#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【记录】OpenWrt配置DNS解析</title>
      <link>https://hexo.limour.top/openwrt-dns-configuration</link>
      <guid>https://hexo.limour.top/openwrt-dns-configuration</guid>
      <pubDate>Sun, 15 Dec 2024 06:29:44 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;&lt;code&gt;锐捷雪豹BE50&lt;/code&gt; 的 &lt;code&gt;游戏加速 QoS&lt;/code&gt; 做得不错，但是没有办法正常的 &lt;code&gt;PPPoE 拨号&lt;/code&gt;，因此只能用来当二级路由接到 OpenWrt 上。上网设置里使用 &lt;code&gt;静态IP&lt;/code&gt;，Open</description>
        
      
      
      
      <content:encoded><![CDATA[<p><code>锐捷雪豹BE50</code> 的 <code>游戏加速 QoS</code> 做得不错，但是没有办法正常的 <code>PPPoE 拨号</code>，因此只能用来当二级路由接到 OpenWrt 上。上网设置里使用 <code>静态IP</code>，OpenWrt 的 <code>网络-DHCP/DNS-静态地址分配</code> 里给它分配了静态地址。但不知道为什么，锐捷的 DNS 解析总出错，因此这里记录一下解决的过程。</p><h2 id="开启SmartDNS">开启SmartDNS</h2><ul><li>OpenWrt 的 <code>服务-SmartDNS-设置-常规设置</code> 的 <code>启用</code> 打勾</li><li>OpenWrt 的 <code>服务-SmartDNS-设置-常规设置</code> 的 <code>自动设置Dnsmasq</code> 打勾</li><li>OpenWrt 的 <code>服务-SmartDNS-上游服务器</code> 的添加合适的 DNS 服务器</li><li>合适的 DNS 服务器可以看 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9pcHcuY24vZG9jL2Vsc2UvZG5zLmh0bWw=" rel="noopener external nofollow noreferrer">ipw.cn</a></li><li>也可以在 <code>状态-概览-网络-IPv4 上游</code> 里看下发的 <code>DNS 1</code> 和 <code>DNS 2</code></li></ul><h2 id="配置SmartDNS">配置SmartDNS</h2><ul><li>OpenWrt 的 <code>服务-SmartDNS-设置-高级设置</code> 的 <code>域名预加载</code> 打上勾</li><li>OpenWrt 的 <code>服务-SmartDNS-设置-高级设置</code> 的 <code>缓存过期服务</code> 去掉勾</li><li>OpenWrt 的 <code>服务-SmartDNS-设置-高级设置</code> 的 <code>持久化缓存</code> 去掉勾</li><li>OpenWrt 的 <code>服务-SmartDNS-设置-高级设置</code> 的 <code>双栈IP优选</code> 和 <code>停用IPv6地址解析</code> 看自己情况</li><li>OpenWrt 的 <code>服务-SmartDNS-设置-第二DNS服务器</code> 的 <code>启用</code> 去掉勾</li></ul><h2 id="DNS重定向">DNS重定向</h2><ul><li>OpenWrt 的 <code>网络-DHCP/DNS-常规设置</code> 的 <code>DNS 重定向</code> 打勾</li><li>OpenWrt 的 <code>网络-DHCP/DNS-常规设置</code> 的 <code>DNS 转发</code> 设置为 <code>SmartDNS</code> 的端口，比如 <code>127.0.0.1#6353</code>，一般都自动设置了</li></ul><h2 id="检查DNS配置">检查DNS配置</h2><ul><li>CN上游测试 <code>nslookup github.com 202.96.209.133</code></li></ul><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs txt">服务器:  ns-pd.online.sh.cn<br>Address:  202.96.209.133<br><br>非权威应答:<br>名称:    github.com<br>Address:  20.205.243.166<br></code></pre></td></tr></table></figure><ul><li>GW上游测试 <code>nslookup github.com 1.1.1.1</code></li></ul><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs txt">服务器:  one.one.one.one<br>Address:  1.1.1.1<br><br>非权威应答:<br>名称:    github.com<br>Address:  20.205.243.166<br></code></pre></td></tr></table></figure><ul><li>SmartDNS测试 <code>nslookup github.com 192.168.88.1</code></li></ul><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs txt">服务器:  ImmortalWrt.lan<br>Address:  192.168.88.1<br><br>非权威应答:<br>名称:    github.com<br>Address:  20.205.243.166<br></code></pre></td></tr></table></figure><ul><li>本地DNS测试 <code>nslookup github.com</code></li></ul><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs txt">服务器:  UnKnown<br>Address:  192.168.110.1<br><br>非权威应答:<br>名称:    github.com<br>Address:  20.205.243.166<br></code></pre></td></tr></table></figure><ul><li>关闭v6测试 <code>nslookup -type=AAAA github.com</code></li></ul><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs txt">服务器:  UnKnown<br>Address:  192.168.110.1<br><br>*** 没有 github.com 可以使用的 IPv6 address (AAAA)记录<br></code></pre></td></tr></table></figure><h2 id="附加-DoH">附加 DoH</h2><ul><li><a href="./Self-built-ad-blocking-DoH-server">自建DoH服务器</a></li><li><a href="./-Docker-bu-shu-easyconnect">SmartDNS 的 TCP 模式简直是神仙</a></li><li><a href="https://hexo.limour.top/go/#aHR0cHM6Ly9weW11bXUuZ2l0aHViLmlvL3NtYXJ0ZG5zL2NvbmZpZ3VyYXRpb24v" rel="noopener external nofollow noreferrer">SmartDNS 的配置项详解</a></li></ul><h2 id="附加-优选ip">附加 优选ip</h2><ul><li>OpenWrt 的 <code>系统-软件包-更新</code> 更新 <code>smartdns</code> 相关的所有包到最新版</li><li>OpenWrt 的 SSH 执行以下命令</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /etc/smartdns/<br><br><span class="hljs-built_in">cat</span> &gt; cloudflare.ipv4 &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">173.245.48.0/20</span><br><span class="hljs-string">103.21.244.0/22</span><br><span class="hljs-string">103.22.200.0/22</span><br><span class="hljs-string">103.31.4.0/22</span><br><span class="hljs-string">141.101.64.0/18</span><br><span class="hljs-string">108.162.192.0/18</span><br><span class="hljs-string">190.93.240.0/20</span><br><span class="hljs-string">188.114.96.0/20</span><br><span class="hljs-string">197.234.240.0/22</span><br><span class="hljs-string">198.41.128.0/17</span><br><span class="hljs-string">162.158.0.0/15</span><br><span class="hljs-string">104.16.0.0/13</span><br><span class="hljs-string">104.24.0.0/14</span><br><span class="hljs-string">172.64.0.0/13</span><br><span class="hljs-string">131.0.72.0/22</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><ul><li>OpenWrt 的 <code>服务-SmartDNS-域名规则-域名地址</code> 添加以下配置，保存，重启</li><li>其中 alias 的 ip 从 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL1hJVTIvQ2xvdWRmbGFyZVNwZWVkVGVzdC9yZWxlYXNlcw==" rel="noopener external nofollow noreferrer">CloudflareSpeedTest</a> 处获取</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs config">ip-set -name cloudflare -file /etc/smartdns/cloudflare.ipv4<br>ip-rules ip-set:cloudflare -ip-alias 104.18.47.223,104.16.97.145,173.245.58.79<br></code></pre></td></tr></table></figure><ul><li>电脑测试是否生效</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">nslookup img.limour.top<br></code></pre></td></tr></table></figure>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/doh/">DoH</category>
      
      
      <comments>https://hexo.limour.top/openwrt-dns-configuration#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【记录】移除Windows中不受信任的证书</title>
      <link>https://hexo.limour.top/remove-untrusted-certificates-windows</link>
      <guid>https://hexo.limour.top/remove-untrusted-certificates-windows</guid>
      <pubDate>Thu, 12 Dec 2024 13:27:24 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;今天逛知乎，有人提到 EasyConnect 会给系统加上自己的 CA 证书。在自己系统里查了一下，发现是真的，因此这里记录一下删除这些恶意证书的过程。&lt;/p&gt;
&lt;h2 id=&quot;查找恶意证书&quot;&gt;查找恶意证书&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;下载 &lt;a href=&quot;https:/</description>
        
      
      
      
      <content:encoded><![CDATA[<p>今天逛知乎，有人提到 EasyConnect 会给系统加上自己的 CA 证书。在自己系统里查了一下，发现是真的，因此这里记录一下删除这些恶意证书的过程。</p><h2 id="查找恶意证书">查找恶意证书</h2><ol><li>下载 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9sZWFybi5taWNyb3NvZnQuY29tL3poLWNuL3N5c2ludGVybmFscy9kb3dubG9hZHMvc2lnY2hlY2s=" rel="noopener external nofollow noreferrer">sigcheck</a></li><li>下载 <a href="https://hexo.limour.top/go/#aHR0cDovL2N0bGRsLndpbmRvd3N1cGRhdGUuY29tL21zZG93bmxvYWQvdXBkYXRlL3YzL3N0YXRpYy90cnVzdGVkci9lbi9hdXRocm9vdHN0bC5jYWI=" rel="noopener external nofollow noreferrer">authrootstl.cab</a></li><li>将 <code>authrootstl.cab</code> 放入 <code>sigcheck</code> 的根目录</li><li>断网执行下面的命令</li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">sigcheck64.exe <span class="hljs-literal">-tv</span><br>sigcheck64.exe <span class="hljs-literal">-tuv</span><br></code></pre></td></tr></table></figure><ul><li>得到了如下的结果</li></ul><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs txt">Machine\ROOT:<br>   Sangfor Technologies Inc.<br>        Cert Status:    Valid<br>        Valid Usage:    All<br>        Cert Issuer:    Sangfor Technologies Inc.<br>        Serial Number:  00 DE A4 D5 FA 33 CF 9E 9E<br>        Thumbprint:     A9062C5C1721FF87EBCBD89DF03719755560E7A0<br>        Algorithm:      sha256RSA<br>        Valid from:     23:27 2017/4/27<br>        Valid to:       23:27 2117/4/3<br>Machine\TrustedPublisher:<br>   Sangfor Technologies Inc.<br>        Cert Status:    Valid<br>        Valid Usage:    All<br>        Cert Issuer:    Sangfor Technologies Inc.<br>        Serial Number:  00 DE A4 D5 FA 33 CF 9E 9E<br>        Thumbprint:     A9062C5C1721FF87EBCBD89DF03719755560E7A0<br>        Algorithm:      sha256RSA<br>        Valid from:     23:27 2017/4/27<br>        Valid to:       23:27 2117/4/3<br></code></pre></td></tr></table></figure><h2 id="删除恶意证书">删除恶意证书</h2><ul><li>记录要删除证书的 <code>Thumbprint</code></li><li>将下面的文件保存成 <code>rm-ca.ps1</code></li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-keyword">param</span>(<br>[<span class="hljs-built_in">string</span>]<span class="hljs-variable">$Thumbprint</span>=<span class="hljs-variable">$</span>(<span class="hljs-keyword">throw</span> <span class="hljs-string">&quot;Parameter missing: -Thumbprint Thumbprint&quot;</span>)<br>)<br><br><span class="hljs-variable">$CAStores</span>=<span class="hljs-string">&quot;cert:\currentuser\root&quot;</span>, <span class="hljs-string">&quot;cert:\currentuser\authroot&quot;</span>, <span class="hljs-string">&quot;cert:\localmachine\root&quot;</span>, <span class="hljs-string">&quot;cert:\localmachine\authroot&quot;</span><br><br><span class="hljs-variable">$exist</span> = <span class="hljs-number">0</span><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$store</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$CAStores</span>) &#123;<br>    <span class="hljs-variable">$location</span> = <span class="hljs-variable">$store</span>+<span class="hljs-string">&quot;\&quot;</span>+<span class="hljs-variable">$Thumbprint</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Test-Path</span> <span class="hljs-literal">-Path</span> <span class="hljs-variable">$location</span>) &#123;<br>        <span class="hljs-variable">$exist</span> = <span class="hljs-number">1</span><br>        <span class="hljs-built_in">Remove-Item</span>  <span class="hljs-literal">-Path</span> <span class="hljs-variable">$location</span> <span class="hljs-literal">-Force</span><br>    &#125;    <br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$exist</span> <span class="hljs-operator">-eq</span> <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;Thumbprint does not exist.&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>运行 <code>.\rm-ca.ps1 -Thumbprint A9062C5C1721FF87EBCBD89DF03719755560E7A0</code> 删除对应的证书</li><li>再次 <code>查找恶意证书</code> 以确认成功</li></ul>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/doh/">DoH</category>
      
      
      <comments>https://hexo.limour.top/remove-untrusted-certificates-windows#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【记录】解决 win 笔记本 关机耗电问题</title>
      <link>https://hexo.limour.top/resolve-the-power-consumption-issue-of-windows-laptop-shutdown</link>
      <guid>https://hexo.limour.top/resolve-the-power-consumption-issue-of-windows-laptop-shutdown</guid>
      <pubDate>Thu, 28 Nov 2024 11:34:55 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;某鱼上淘的笔记本，因为恢复了出厂设置，因此一些修正异常耗电的设置都被还原了，一晚上能耗40%的电，这里记录一下搜集的各种解决措施，以免之后再次重置后忘了怎么操作。这些措施使用后现在确实不怎么耗电了。&lt;/p&gt;
&lt;figure class=&quot;highlight plaintex</description>
        
      
      
      
      <content:encoded><![CDATA[<p>某鱼上淘的笔记本，因为恢复了出厂设置，因此一些修正异常耗电的设置都被还原了，一晚上能耗40%的电，这里记录一下搜集的各种解决措施，以免之后再次重置后忘了怎么操作。这些措施使用后现在确实不怎么耗电了。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs regedit">Windows Registry Editor Version 5.00<br>[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Power\PowerSettings\F15576E8-98B7-4186-B944-EAFA664402D9]<br>&quot;Attributes&quot;=dword:00000002<br>[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Power\PowerSettings\238C9FA8-0AAD-41ED-83F4-97BE242C8F20\BD3B718A-0680-4D9D-8AB2-E1D2B4AC806D]<br>&quot;Attributes&quot;=dword:00000002<br></code></pre></td></tr></table></figure><ul><li>以上文件保存为 <code>power.reg</code>，并运行</li><li>右键电池打开电源选项，进入高级选项</li><li>将 <code>&#123;方案名&#125;-待机状态下的网络连接性</code> 改成禁用</li><li>将 <code>睡眠-允许使用唤醒定时器</code> 改成禁用</li><li>设备管理器里对网卡、鼠标等设置为允许计算机关闭此设备，并关闭唤醒功能</li><li>BIOS 里关闭 USB供电</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell">powercfg <span class="hljs-literal">-devicequery</span> wake_programmable  <span class="hljs-comment"># 查看会唤醒笔记本的设备</span><br>powercfg <span class="hljs-literal">-devicequery</span> wake_armed  <span class="hljs-comment"># 查看会唤醒笔记本的设备</span><br>powercfg <span class="hljs-literal">-devicedisablewake</span> <span class="hljs-string">&quot;Intel(R) Wireless-AC 9560 160MHz&quot;</span>  <span class="hljs-comment"># 禁用掉对应的设备</span><br>powercfg <span class="hljs-literal">-lastwake</span>  <span class="hljs-comment"># 查看上一次睡眠唤醒的设备，进行针对性禁用</span><br> <br>powercfg <span class="hljs-literal">-h</span> off  <span class="hljs-comment"># 关闭休眠</span><br>powercfg /a<br><span class="hljs-comment"># 确认是 S0低电量待机 网络已断开连接</span><br></code></pre></td></tr></table></figure>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/win/">win</category>
      
      
      <comments>https://hexo.limour.top/resolve-the-power-consumption-issue-of-windows-laptop-shutdown#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【探索】基于 Nginx 的免流方案</title>
      <link>https://hexo.limour.top/free-traffic-solution-based-on-nginx</link>
      <guid>https://hexo.limour.top/free-traffic-solution-based-on-nginx</guid>
      <pubDate>Mon, 18 Nov 2024 14:50:02 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;最近冲浪，看到了一种基于 Nginx 的免流方案，可以让 B 站的流量使用 QQ 的免流，这里测试一下是否真的可行。&lt;/p&gt;
&lt;h2 id=&quot;配置-Nginx&quot;&gt;配置 Nginx&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/Docker-bu-shu-Nginx-Pro</description>
        
      
      
      
      <content:encoded><![CDATA[<p>最近冲浪，看到了一种基于 Nginx 的免流方案，可以让 B 站的流量使用 QQ 的免流，这里测试一下是否真的可行。</p><h2 id="配置-Nginx">配置 Nginx</h2><ul><li><a href="/Docker-bu-shu-Nginx-Proxy-Manager">反向代理服务</a></li><li>新建一个服务，地址填入 <code>*.bilibili.com</code> 和 <code>im.qq.com</code></li></ul><p><img src="https://img.limour.top/2024/11/18/673b5504b772d.webp" alt=""></p><ul><li>在高级里写入下面的配置</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> / &#123;<br>  <span class="hljs-attribute">if</span> (<span class="hljs-variable">$http_limour</span> != <span class="hljs-string">&quot;123456&quot;</span>)&#123;<br>    <span class="hljs-attribute">return</span> <span class="hljs-number">404</span>;<br>  &#125;<br>  <span class="hljs-attribute">if</span> (<span class="hljs-variable">$http_host</span> <span class="hljs-regexp">~* ^(.+).bilibili.com$)</span> &#123;<br>    <span class="hljs-attribute">proxy_pass</span> https://<span class="hljs-variable">$1</span>.bilibili.com;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://img.limour.top/2024/11/18/673b557a54805.webp" alt=""></p><h2 id="浏览器插件">浏览器插件</h2><ul><li>访问 <code>chrome://version</code> 记录下自己浏览器的位置</li><li>按装插件 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9jaHJvbWV3ZWJzdG9yZS5nb29nbGUuY29tL2RldGFpbC9tb2RoZWFkZXItbW9kaWZ5LWh0dHAtaGVhL2lkZ3BubW9ua25qbm9qZGRma3Bna2xqcGZubmZja2xq" rel="noopener external nofollow noreferrer">ModHeader</a></li><li>插件里给要免流的域名加上自己设置的鉴权头</li></ul><p><img src="https://img.limour.top/2024/11/18/673b56081f820.webp" alt=""></p><h2 id="参数启动">参数启动</h2><ul><li><code>114.514.191.981</code> 需要改成自己服务器的 IP</li><li>两种启动方式任选一种，启动前需要完全关闭浏览器</li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmd">&quot;C:\Program Files\Google\Chrome\Application\chrome.exe&quot; --host-rules=&quot;MAP *.bilibili.com im.qq.com,&quot; --host-resolver-rules=&quot;MAP im.qq.com <span class="hljs-number">114</span>.<span class="hljs-number">514</span>.<span class="hljs-number">191</span>.<span class="hljs-number">981</span>,&quot; --test-<span class="hljs-built_in">type</span> --ignore-certificate-errors<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Start-Process</span> <span class="hljs-literal">-FilePath</span> <span class="hljs-string">&quot;C:\Program Files\Google\Chrome\Application\chrome.exe&quot;</span> <span class="hljs-literal">-ArgumentList</span> <span class="hljs-selector-tag">@</span>(<br>    <span class="hljs-string">&quot;-host-rules=`&quot;MAP *.bilibili.com im.qq.com,`&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;-host-resolver-rules=`&quot;MAP im.qq.com 114.514.191.981,`&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;-test-type&quot;</span>,<br>    <span class="hljs-string">&quot;-ignore-certificate-errors&quot;</span><br>)<br></code></pre></td></tr></table></figure><h2 id="测试结果">测试结果</h2><ul><li>显然是成功了，就是要小心中间人攻击，不输入敏感信息。</li></ul><p><img src="https://img.limour.top/2024/11/18/673b56fc2d99e.webp" alt=""></p>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/nginx/">nginx</category>
      
      
      <comments>https://hexo.limour.top/free-traffic-solution-based-on-nginx#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【想法】基于函数调用和 Agent 的分层 AI 系统构思</title>
      <link>https://hexo.limour.top/concept-of-hierarchical-ai-system-based-on-function-calling-and-agent</link>
      <guid>https://hexo.limour.top/concept-of-hierarchical-ai-system-based-on-function-calling-and-agent</guid>
      <pubDate>Sun, 17 Nov 2024 04:44:53 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;最近冲浪看到一篇&lt;a href=&quot;https://hexo.limour.top/go/#aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzI0MDIuMTI4NzU=&quot; rel=&quot;noopener external nofollow noreferrer&quot;&gt;有限</description>
        
      
      
      
      <content:encoded><![CDATA[<p>最近冲浪看到一篇<a href="https://hexo.limour.top/go/#aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzI0MDIuMTI4NzU=" rel="noopener external nofollow noreferrer">有限模型尺寸无限上下文可以实现图灵等价</a>的文章，结合 Openai 的 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL29wZW5haS9zd2FybQ==" rel="noopener external nofollow noreferrer">swarm</a> 使用  Function Calling 能高效优雅地实现多 Agents，以及 Function Calling 实现 <a href="develop-rag-plugin-for-next-web">RAG</a> 也非常简单，因此产生了这一想法。</p><p><img src="https://img.limour.top/2024/11/17/6739876cbe7a3.webp" alt=""></p><h2 id="需要的组件">需要的组件</h2><ol><li>一个超大尺寸有限上下文的模型，负责深入思考，记为 <code>M0(question, context)</code></li><li>一个中等尺寸较长上下文的模型，负责执行，记为 <code>M1(task, context)</code></li><li>一个较小尺寸超长上下文的模型，负责规划，记为 <code>M2(goal, context)</code></li><li>一个向量检索系统，具有召回、更新和睡眠三个方法，召回记为 <code>R(query)</code>，更新记为 <code>U(memory)</code>，睡眠记为 <code>S()</code></li><li>一个 Agent 框架，将以上四个系统串起来</li></ol><h2 id="向量检索系统">向量检索系统</h2><h3 id="更新方法">更新方法</h3><p><code>U(memory: str) -&gt; bool</code> 方法的描述为 <code>记住一段记忆</code>。</p><p><code>U(memory: str) -&gt; bool</code> 具有一个 <code>memory: str</code> 参数，其描述为 <code>一段需要记住的记忆，300词左右</code>，会返回一个 <code>ok</code>，表示记忆写入成功。</p><p>系统内部写入记忆时，会带上一个具有单向时间流动的时间标记 <code>time: int</code>；初始为写入的时间，同时有一个表示记忆强度的 <code>level: int</code>，初始为 <code>0</code>。</p><h3 id="召回方法">召回方法</h3><p><code>R(query：str) -&gt; List[str]</code> 方法的描述为 <code>回忆相关记忆</code>。</p><p><code>R(query：str) -&gt; List[str]</code> 具有一个 <code>query：str</code> 参数，其描述为 <code>需要在记忆中检索的句子</code>，返回一个相关记忆的列表，列表中的记忆均由 <code>U(memory)</code> 写入而来。</p><p>系统内部召回记忆时会做三件事情，第一是召回记忆，并对召回的记忆进行重排，取重排后的 <code>topn: int</code> 项，以 <code>List[str]</code> 的形式返回。</p><p>第二是对返回的 <code>List[str]</code> 中的记忆的 <code>time: int</code> 更新，值为成功召回的时间，同时判断时间差是否大于某个超参数，大于则 <code>level: int</code> 自增1，否则不变。<code>level: int</code> 为 <code>0</code> 时，必自增1。超参数相对于 <code>level: int</code> 以指数的形式增长，达到某上限后不再变化，同时记忆转为长期记忆，<code>level: int</code> 不再变化。</p><p>第三是对召回成功但未能在重排后进入 <code>List[str]</code> 的记忆，去掉其中属于长期记忆的部分，对余下的部分进行操作。判断 <code>time: int</code> 与当前时间差是否大于某个超参数，大于则 <code>level: int</code> 自减1。若 <code>level: int</code> 为 <code>-1</code>，从记忆中删去此记忆。</p><h3 id="睡眠方法">睡眠方法</h3><p><code>S() -&gt; str</code> 方法的描述为 <code>整理记忆、保持高效</code>。</p><p><code>S() -&gt; str</code> 没有参数，返回一个梦境。内部会随机选取 <code>n: int</code> 段记忆，判断每段记忆的 <code>time: int</code> 与当前时间差是否大于某个超参数，大于则 <code>level: int</code> 自减1。若 <code>level: int</code> 为 <code>-1</code>，从记忆中删去此记忆。被删除的记忆记为 <code>List[str]</code>，调用 <code>M1(task, context)</code>，其 <code>task</code> 为 <code>根据碎片的信息，生成一段梦境</code>，其 <code>context</code> 为被删除的记忆 <code>List[str]</code> 通过分割符连接而成的一段文字。</p><h2 id="M0模型">M0模型</h2><p><code>M0(question: str, context: str) -&gt; str</code> 方法的描述为 <code>针对具体问题进行深入思考</code>，<code>system prompt</code> 为 CoT 的模板。</p><p>其 <code>Function Calling</code> 仅连接了 <code>R(query)</code> 和 <code>U(memory)</code>。</p><p>其只返回最后的结果，以 <code>&lt;|thinking_start|&gt;...&lt;|thinking_end|&gt;</code> 包裹。</p><h2 id="M1模型">M1模型</h2><p><code>M1(task: str, context: str) -&gt; str</code> 方法的描述为 <code>执行具体明确的任务</code>，<code>system prompt</code> 为 <code>分解任务为具体问题，逐个解决问题</code>。</p><p>其 <code>Function Calling</code> 连接了 <code>R(query)</code>、 <code>U(memory)</code>、<code>M0(question, context)</code>，并动态连接其他必要的解决任务的工具。</p><p>其只返回最后的结果。</p><h2 id="M2模型">M2模型</h2><p><code>M2(goal: str, context: str) -&gt; str</code> 方法的描述为 <code>循环规划任务，在长期存活的前提下实现目标</code>，<code>system prompt</code> 为 <code>人生有梦、各自精彩，活下去、找到你的价值、实现你的目标</code>。</p><p>其 <code>Function Calling</code> 连接了 <code>R(query)</code>、<code>U(memory)</code>、<code>S()</code> 和 <code>M1(task, context)</code>。</p><p>其特别附加一个 <code>I(tip: str, timeout: int) -&gt; str</code>， 描述为 <code>请求用户输入</code>，<code>tip: str</code>的描述为 <code>输入提示信息</code>，<code>timeout: int</code>的描述为 <code>愿意等待用户的时间</code>，超时后将返回 <code>用户暂未回复</code>，否则返回用户输入的信息。</p><p>遇到 <code>&lt;|im_end|&gt;</code> 时循环会自动添加 <code>&lt;|im_start|&gt;</code>，继续进行循环，直到系统崩溃。</p>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/fc/">FC</category>
      
      <category domain="https://hexo.limour.top/tags/agent/">agent</category>
      
      
      <comments>https://hexo.limour.top/concept-of-hierarchical-ai-system-based-on-function-calling-and-agent#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>【探索】为Next-Web开发RAG插件</title>
      <link>https://hexo.limour.top/develop-rag-plugin-for-next-web</link>
      <guid>https://hexo.limour.top/develop-rag-plugin-for-next-web</guid>
      <pubDate>Fri, 15 Nov 2024 20:09:16 GMT</pubDate>
      
        
        
      <description>&lt;p&gt;Dify、FastGPT、LangChain之类的用来做知识库都太过笨重，难以在1C1G的服务器上流畅运行。而 ChatGPT-Next-Web 可以在 Vercel 上免费部署，并且 &lt;a href=&quot;https://hexo.limour.top/go/#aHR0cHM</description>
        
      
      
      
      <content:encoded><![CDATA[<p>Dify、FastGPT、LangChain之类的用来做知识库都太过笨重，难以在1C1G的服务器上流畅运行。而 ChatGPT-Next-Web 可以在 Vercel 上免费部署，并且 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL0NoYXRHUFROZXh0V2ViL05leHRDaGF0LUF3ZXNvbWUtUGx1Z2lucw==" rel="noopener external nofollow noreferrer">NextChat-Awesome-Plugins</a> 带来的插件功能支持 <code>RESTful</code> API 的调用。因此只要用 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL2Zhc3RhcGkvZmFzdGFwaQ==" rel="noopener external nofollow noreferrer">FastAPI</a> 将嵌入、重排、Qdrant向量检索包装到一起，就可以为 Next-Web 提供一个 RAG 插件。</p><h2 id="准备工作">准备工作</h2><ul><li>已经提前导入了知识库的 <a href="./using-qdrant-for-vector-retrieval">Qdrant</a></li></ul><p><img src="https://img.limour.top/2024/11/16/6737ad80213d2.webp" alt=""></p><ul><li>可以正常使用的 <a href="./Aggregating-Azure-and-OpenAI-APIs-with-OneAPI">Next-Web</a></li><li>一些相关的文件 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL0xpbW91ci1kZXYvZmFzdGFwaQ==" rel="noopener external nofollow noreferrer">Limour-dev/fastapi</a></li></ul><h3 id="FastAPI">FastAPI</h3><ul><li>部署 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL0xpbW91ci1kZXYvZmFzdGFwaS1sYXVuY2hlcg==" rel="noopener external nofollow noreferrer">fastapi-launcher</a></li></ul>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-dfca4d5a" role="button" aria-expanded="false" aria-controls="collapse-dfca4d5a">        <div class="fold-arrow">▶</div>点开查看调试过程      </div>      <div class="fold-collapse collapse" id="collapse-dfca4d5a">        <div class="fold-content">          <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p ~/app/fastapi &amp;&amp; <span class="hljs-built_in">cd</span> ~/app/fastapi &amp;&amp; <span class="hljs-built_in">touch</span> Dockerfile &amp;&amp; <span class="hljs-built_in">touch</span> docker-compose.yml &amp;&amp; <span class="hljs-built_in">touch</span> .<span class="hljs-built_in">env</span><br><span class="hljs-built_in">mkdir</span> -p ~/app/fastapi/app &amp;&amp; <span class="hljs-built_in">mkdir</span> -p ~/app/fastapi/app/Plugins<br></code></pre></td></tr></table></figure><ul><li><code>nano Dockerfile</code> 编辑 <code>Dockerfile</code>，写入下面的文件</li><li><code>docker build -t limour/fastapi .</code> 构建镜像</li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Dockerfile"><span class="hljs-keyword">FROM</span> python:<span class="hljs-number">3.9</span>-alpine<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> pip3 install --no-cache-dir <span class="hljs-string">&quot;fastapi[standard]&quot;</span> httpx</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;fastapi&quot;</span>, <span class="hljs-string">&quot;dev&quot;</span>, <span class="hljs-string">&quot;main.py&quot;</span>, <span class="hljs-string">&quot;--host&quot;</span>, <span class="hljs-string">&quot;0.0.0.0&quot;</span>]</span><br></code></pre></td></tr></table></figure><ul><li><code>nano ./app/main.py</code> 编辑 <code>main.py</code>，写入下面的文件</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os, importlib<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br>app = FastAPI()<br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_root</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;Hello&quot;</span>: <span class="hljs-string">&quot;World&quot;</span>&#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_all_files_in_directory</span>(<span class="hljs-params">directory, ext=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>    all_files = []<br>    <span class="hljs-keyword">for</span> root, dirs, files <span class="hljs-keyword">in</span> os.walk(directory):<br>        root: <span class="hljs-built_in">str</span> = root[<span class="hljs-built_in">len</span>(directory):]<br>        root.replace(os.path.sep, <span class="hljs-string">&#x27;.&#x27;</span>)<br>        <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:<br>            <span class="hljs-keyword">if</span> file.endswith(ext):<br>                file_path = root + <span class="hljs-string">&#x27;.&#x27;</span> + file[:-<span class="hljs-built_in">len</span>(ext)]<br>                all_files.append(file_path)<br>    <span class="hljs-keyword">return</span> all_files<br><br><span class="hljs-keyword">for</span> _path <span class="hljs-keyword">in</span> get_all_files_in_directory(<span class="hljs-string">&#x27;Plugins&#x27;</span>, <span class="hljs-string">&#x27;.py&#x27;</span>):<br>    plugin = importlib.import_module(_path, <span class="hljs-string">&#x27;Plugins&#x27;</span>)<br>    plugin.callback(app)<br></code></pre></td></tr></table></figure><ul><li><code>nano docker-compose.yml</code> 编辑 <code>docker-compose.yml</code>，写入下面的文件</li><li><code>sudo docker compose up -d</code> 测试是否正常</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">fastapi:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">limour/fastapi</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">env_file:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">.env</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./app:/app</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/localtime:/etc/localtime:ro</span><br> <br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">default:</span><br>    <span class="hljs-attr">external:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">ngpm</span><br></code></pre></td></tr></table></figure><ul><li>反代 <code>FastAPI</code>， 访问可以看到 <code>&quot;Hello&quot;: &quot;World&quot;</code></li></ul><p><img src="https://img.limour.top/2024/11/16/6737b54c2a573.webp" alt=""></p>        </div>      </div>    </div><h2 id="包装API">包装API</h2><ul><li><code>wget -O ./app/Plugins/qdrant.py https://raw.githubusercontent.com/Limour-dev/fastapi/refs/heads/main/Plugins/qdrant.py</code></li></ul><h3 id="配置环境变量">配置环境变量</h3><ul><li><code>nano .env</code> 编辑 <code>.env</code>，写入下面的文件</li><li>依次配置好嵌入、重排和Qdrant数据库</li><li><code>docker compose down &amp;&amp; docker compose up -d</code> 重启</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">QDRANT_EMBD_URL=http://localhost:8080/v1/embeddings<br>QDRANT_EMBD_KEY=no-key<br>QDRANT_EMBD_MODEL=text-embedding-3-small<br>QDRANT_RERANK_URL=http://localhost:8081/v1/rerank<br>QDRANT_RERANK_KEY=no-key<br>QDRANT_RERANK_MODEL=BAAI/bge-reranker-v2-m3<br>QDRANT_URL=http://qdrant:6333<br>QDRANT_KEY=no-key<br>FASTAPI_KEY=123456<br></code></pre></td></tr></table></figure>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-5e836f54" role="button" aria-expanded="false" aria-controls="collapse-5e836f54">        <div class="fold-arrow">▶</div>点开查看调试过程      </div>      <div class="fold-collapse collapse" id="collapse-5e836f54">        <div class="fold-content">          <h3 id="测试环境">测试环境</h3><ul><li>在测试环境编写好脚本后，再转移脚本到 <code>app/Plugins</code> 目录下</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">conda create -n fastapi conda-forge::fastapi conda-forge::httpx conda-forge::python==3.9<br></code></pre></td></tr></table></figure><h3 id="编写脚本">编写脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget -O app/Plugins/qdrant.py https://raw.githubusercontent.com/Limour-dev/fastapi/refs/heads/main/Plugins/qdrant.py<br></code></pre></td></tr></table></figure><h3 id="测试脚本">测试脚本</h3><ul><li>填入自己的信息后，运行 <a href="https://hexo.limour.top/go/#aHR0cHM6Ly9naXRodWIuY29tL0xpbW91ci1kZXYvZmFzdGFwaS9ibG9iL21haW4vVGVzdFFkcmFudC5weQ==" rel="noopener external nofollow noreferrer">TestQdrant.py</a></li></ul>        </div>      </div>    </div><h2 id="配置插件">配置插件</h2><ul><li>获取 <code>openapi.json</code> ，例如访问 <code>https://fastapi.limour.top/openapi.json</code></li><li>将其修改成下面的格式</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;openapi&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3.1.0&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;qdrant&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;使用 Qdrant 检索知识库进行 RAG&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;v1.0.0&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;servers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://fastapi.limour.top&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;paths&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;/qdrant/v1&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;post&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;operationId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;qdrant&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;summary&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;使用 Qdrant 检索知识库进行 RAG&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;requestBody&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;required&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;content&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;application/json&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>              <span class="hljs-attr">&quot;schema&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;object&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;required&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;input&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                  <span class="hljs-attr">&quot;input&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;string&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;需要在知识库中检索的句子&quot;</span><br>                  <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">&#125;</span><br>              <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ul><li>将修改后的 json，填入 next-web 的插件中，并设置好 Authoritarian</li></ul><p><img src="https://img.limour.top/2024/11/16/67384ce3a26aa.webp" alt=""></p><h2 id="测试插件">测试插件</h2><p><img src="https://img.limour.top/2024/11/16/67384c8ff29e6.webp" alt=""></p>]]></content:encoded>
      
      
      
      <category domain="https://hexo.limour.top/tags/docker/">docker</category>
      
      <category domain="https://hexo.limour.top/tags/rag/">rag</category>
      
      <category domain="https://hexo.limour.top/tags/openai/">openai</category>
      
      
      <comments>https://hexo.limour.top/develop-rag-plugin-for-next-web#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
